23:11:18.770 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/pydantic/v2_validated_func.py:51: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  class DecoratorBaseModel(BaseModel):

23:11:18.794 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas_datareader/compat/__init__.py:11: DeprecationWarning: distutils Version classes are deprecated. Use packaging.version instead.
  PANDAS_VERSION = LooseVersion(pd.__version__)

23:11:18.795 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas_datareader/compat/__init__.py:13: DeprecationWarning: distutils Version classes are deprecated. Use packaging.version instead.
  PANDAS_0210 = PANDAS_VERSION >= LooseVersion("0.21.0")

23:11:18.795 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas_datareader/compat/__init__.py:14: DeprecationWarning: distutils Version classes are deprecated. Use packaging.version instead.
  PANDAS_0220 = PANDAS_VERSION >= LooseVersion("0.22.0")

23:11:18.795 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas_datareader/compat/__init__.py:15: DeprecationWarning: distutils Version classes are deprecated. Use packaging.version instead.
  PANDAS_0230 = PANDAS_VERSION >= LooseVersion("0.23.0")

2025-12-22 23:11:18 | INFO     | __main__:backfill_data:79 - Starting backfill for target date 2024-12-01
2025-12-22 23:11:18 | INFO     | __main__:backfill_data:80 - Will fetch up to 120 days of historical data
2025-12-22 23:11:18 | INFO     | __main__:backfill_data:86 - ============================================================
2025-12-22 23:11:18 | INFO     | __main__:backfill_data:87 - Step 1: Running ingestion
2025-12-22 23:11:18 | INFO     | __main__:backfill_data:88 - ============================================================
23:11:19.328 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/alembic/config.py:598: DeprecationWarning: No path_separator found in configuration; falling back to legacy splitting on spaces, commas, and colons for prepend_sys_path.  Consider adding path_separator=os to Alembic config.
  util.warn_deprecated(

23:11:19.365 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/pydantic/v2_validated_func.py:51: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  class DecoratorBaseModel(BaseModel):

23:11:19.366 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:157: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for name, field in self.model.__fields__.items()

23:11:19.367 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:160: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  non_var_fields = set(self.model.__fields__) - {self.v_args_name, self.v_kwargs_name}

23:11:19.369 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:536: PydanticDeprecatedSince20: The private method `_iter` will be removed and should no longer be used. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for k, v in model._iter()

23:11:19.370 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields_set__` attribute is deprecated, use `model_fields_set` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:19.370 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:19.402 | INFO    | prefect.engine - Created flow run 'diligent-tapir' for flow 'ingest_prices'
2025-12-22 23:11:19 | INFO     | flows.ingest_prices:ingest_prices:35 - Starting price ingestion for 26 tickers on 2024-12-01
23:11:19.459 | INFO    | Flow run 'diligent-tapir' - Created task run 'fetch_and_store_price-0' for task 'fetch_and_store_price'
23:11:19.460 | INFO    | Flow run 'diligent-tapir' - Submitted task run 'fetch_and_store_price-0' for execution.
23:11:19.471 | INFO    | Flow run 'diligent-tapir' - Created task run 'fetch_and_store_price-1' for task 'fetch_and_store_price'
23:11:19.471 | INFO    | Flow run 'diligent-tapir' - Submitted task run 'fetch_and_store_price-1' for execution.
23:11:19.475 | INFO    | Flow run 'diligent-tapir' - Created task run 'fetch_and_store_price-14' for task 'fetch_and_store_price'
23:11:19.475 | INFO    | Flow run 'diligent-tapir' - Submitted task run 'fetch_and_store_price-14' for execution.
23:11:19.481 | INFO    | Flow run 'diligent-tapir' - Created task run 'fetch_and_store_price-7' for task 'fetch_and_store_price'
23:11:19.481 | INFO    | Flow run 'diligent-tapir' - Submitted task run 'fetch_and_store_price-7' for execution.
23:11:19.486 | INFO    | Flow run 'diligent-tapir' - Created task run 'fetch_and_store_price-17' for task 'fetch_and_store_price'
23:11:19.486 | INFO    | Flow run 'diligent-tapir' - Submitted task run 'fetch_and_store_price-17' for execution.
23:11:19.491 | INFO    | Flow run 'diligent-tapir' - Created task run 'fetch_and_store_price-5' for task 'fetch_and_store_price'
23:11:19.491 | INFO    | Flow run 'diligent-tapir' - Submitted task run 'fetch_and_store_price-5' for execution.
23:11:19.495 | INFO    | Flow run 'diligent-tapir' - Created task run 'fetch_and_store_price-11' for task 'fetch_and_store_price'
23:11:19.495 | INFO    | Flow run 'diligent-tapir' - Submitted task run 'fetch_and_store_price-11' for execution.
23:11:19.500 | INFO    | Flow run 'diligent-tapir' - Created task run 'fetch_and_store_price-20' for task 'fetch_and_store_price'
23:11:19.500 | INFO    | Flow run 'diligent-tapir' - Submitted task run 'fetch_and_store_price-20' for execution.
23:11:19.506 | INFO    | Flow run 'diligent-tapir' - Created task run 'fetch_and_store_price-3' for task 'fetch_and_store_price'
23:11:19.506 | INFO    | Flow run 'diligent-tapir' - Submitted task run 'fetch_and_store_price-3' for execution.
23:11:19.510 | INFO    | Flow run 'diligent-tapir' - Created task run 'fetch_and_store_price-23' for task 'fetch_and_store_price'
23:11:19.511 | INFO    | Flow run 'diligent-tapir' - Submitted task run 'fetch_and_store_price-23' for execution.
23:11:19.514 | INFO    | Flow run 'diligent-tapir' - Created task run 'fetch_and_store_price-22' for task 'fetch_and_store_price'
23:11:19.515 | INFO    | Flow run 'diligent-tapir' - Submitted task run 'fetch_and_store_price-22' for execution.
23:11:19.519 | INFO    | Flow run 'diligent-tapir' - Created task run 'fetch_and_store_price-24' for task 'fetch_and_store_price'
23:11:19.519 | INFO    | Flow run 'diligent-tapir' - Submitted task run 'fetch_and_store_price-24' for execution.
23:11:19.524 | INFO    | Flow run 'diligent-tapir' - Created task run 'fetch_and_store_price-25' for task 'fetch_and_store_price'
23:11:19.524 | INFO    | Flow run 'diligent-tapir' - Submitted task run 'fetch_and_store_price-25' for execution.
23:11:19.529 | INFO    | Flow run 'diligent-tapir' - Created task run 'fetch_and_store_price-4' for task 'fetch_and_store_price'
23:11:19.529 | INFO    | Flow run 'diligent-tapir' - Submitted task run 'fetch_and_store_price-4' for execution.
23:11:19.544 | INFO    | Flow run 'diligent-tapir' - Created task run 'fetch_and_store_price-18' for task 'fetch_and_store_price'
23:11:19.545 | INFO    | Flow run 'diligent-tapir' - Submitted task run 'fetch_and_store_price-18' for execution.
23:11:19.554 | INFO    | Flow run 'diligent-tapir' - Created task run 'fetch_and_store_price-12' for task 'fetch_and_store_price'
23:11:19.554 | INFO    | Flow run 'diligent-tapir' - Submitted task run 'fetch_and_store_price-12' for execution.
23:11:19.558 | INFO    | Flow run 'diligent-tapir' - Created task run 'fetch_and_store_price-21' for task 'fetch_and_store_price'
23:11:19.558 | INFO    | Flow run 'diligent-tapir' - Submitted task run 'fetch_and_store_price-21' for execution.
23:11:19.610 | INFO    | Flow run 'diligent-tapir' - Created task run 'fetch_and_store_price-6' for task 'fetch_and_store_price'
23:11:19.610 | INFO    | Flow run 'diligent-tapir' - Submitted task run 'fetch_and_store_price-6' for execution.
23:11:19.623 | INFO    | Flow run 'diligent-tapir' - Created task run 'fetch_and_store_price-13' for task 'fetch_and_store_price'
23:11:19.624 | INFO    | Flow run 'diligent-tapir' - Submitted task run 'fetch_and_store_price-13' for execution.
23:11:19.632 | INFO    | Flow run 'diligent-tapir' - Created task run 'fetch_and_store_price-19' for task 'fetch_and_store_price'
23:11:19.633 | INFO    | Flow run 'diligent-tapir' - Submitted task run 'fetch_and_store_price-19' for execution.
23:11:19.706 | INFO    | Flow run 'diligent-tapir' - Created task run 'fetch_and_store_price-2' for task 'fetch_and_store_price'
23:11:19.706 | INFO    | Flow run 'diligent-tapir' - Submitted task run 'fetch_and_store_price-2' for execution.
23:11:19.709 | INFO    | Flow run 'diligent-tapir' - Created task run 'fetch_and_store_price-8' for task 'fetch_and_store_price'
23:11:19.710 | INFO    | Flow run 'diligent-tapir' - Submitted task run 'fetch_and_store_price-8' for execution.
23:11:19.813 | INFO    | Flow run 'diligent-tapir' - Created task run 'fetch_and_store_price-15' for task 'fetch_and_store_price'
23:11:19.813 | INFO    | Flow run 'diligent-tapir' - Submitted task run 'fetch_and_store_price-15' for execution.
23:11:19.922 | INFO    | Flow run 'diligent-tapir' - Created task run 'fetch_and_store_price-9' for task 'fetch_and_store_price'
23:11:19.922 | INFO    | Flow run 'diligent-tapir' - Submitted task run 'fetch_and_store_price-9' for execution.
23:11:20.030 | INFO    | Flow run 'diligent-tapir' - Created task run 'fetch_and_store_price-10' for task 'fetch_and_store_price'
23:11:20.031 | INFO    | Flow run 'diligent-tapir' - Submitted task run 'fetch_and_store_price-10' for execution.
23:11:20.131 | INFO    | Flow run 'diligent-tapir' - Created task run 'fetch_and_store_price-16' for task 'fetch_and_store_price'
23:11:20.132 | INFO    | Flow run 'diligent-tapir' - Submitted task run 'fetch_and_store_price-16' for execution.
2025-12-22 23:11:20 | WARNING  | data_sources.stooq:fetch_stooq_prices:43 - Empty DataFrame returned from Stooq for BRK.B
23:11:20.352 | INFO    | Task run 'fetch_and_store_price-7' - Finished in state Completed()
2025-12-22 23:11:20 | WARNING  | data_sources.stooq:fetch_stooq_prices:89 - No exact match for PG on 2024-12-01, using latest prior date 2024-11-29
2025-12-22 23:11:20 | INFO     | data_sources.stooq:fetch_stooq_prices:93 - Saved Stooq prices for PG (83 days of history) to /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq
2025-12-22 23:11:20 | WARNING  | data_sources.stooq:fetch_stooq_prices:89 - No exact match for AMZN on 2024-12-01, using latest prior date 2024-11-29
2025-12-22 23:11:20 | INFO     | data_sources.stooq:fetch_stooq_prices:93 - Saved Stooq prices for AMZN (83 days of history) to /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq
2025-12-22 23:11:20 | WARNING  | data_sources.stooq:fetch_stooq_prices:89 - No exact match for KO on 2024-12-01, using latest prior date 2024-11-29
2025-12-22 23:11:20 | INFO     | data_sources.stooq:fetch_stooq_prices:93 - Saved Stooq prices for KO (83 days of history) to /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq
2025-12-22 23:11:20 | WARNING  | data_sources.stooq:fetch_stooq_prices:89 - No exact match for GOOGL on 2024-12-01, using latest prior date 2024-11-29
2025-12-22 23:11:20 | INFO     | data_sources.stooq:fetch_stooq_prices:93 - Saved Stooq prices for GOOGL (83 days of history) to /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq
2025-12-22 23:11:20 | WARNING  | data_sources.stooq:fetch_stooq_prices:89 - No exact match for HD on 2024-12-01, using latest prior date 2024-11-29
2025-12-22 23:11:20 | INFO     | data_sources.stooq:fetch_stooq_prices:93 - Saved Stooq prices for HD (83 days of history) to /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq
2025-12-22 23:11:20 | WARNING  | data_sources.stooq:fetch_stooq_prices:89 - No exact match for META on 2024-12-01, using latest prior date 2024-11-29
2025-12-22 23:11:20 | INFO     | data_sources.stooq:fetch_stooq_prices:93 - Saved Stooq prices for META (83 days of history) to /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq
2025-12-22 23:11:20 | WARNING  | data_sources.stooq:fetch_stooq_prices:89 - No exact match for CSCO on 2024-12-01, using latest prior date 2024-11-29
2025-12-22 23:11:20 | INFO     | data_sources.stooq:fetch_stooq_prices:93 - Saved Stooq prices for CSCO (83 days of history) to /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq
2025-12-22 23:11:20 | WARNING  | data_sources.stooq:fetch_stooq_prices:89 - No exact match for MA on 2024-12-01, using latest prior date 2024-11-29
2025-12-22 23:11:20 | INFO     | data_sources.stooq:fetch_stooq_prices:93 - Saved Stooq prices for MA (83 days of history) to /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq
2025-12-22 23:11:20 | WARNING  | data_sources.stooq:fetch_stooq_prices:89 - No exact match for MSFT on 2024-12-01, using latest prior date 2024-11-29
2025-12-22 23:11:20 | INFO     | data_sources.stooq:fetch_stooq_prices:93 - Saved Stooq prices for MSFT (83 days of history) to /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq
23:11:20.743 | INFO    | Task run 'fetch_and_store_price-11' - Finished in state Completed()
23:11:20.749 | INFO    | Task run 'fetch_and_store_price-5' - Finished in state Completed()
23:11:20.755 | INFO    | Task run 'fetch_and_store_price-1' - Finished in state Completed()
23:11:20.766 | INFO    | Task run 'fetch_and_store_price-24' - Finished in state Completed()
23:11:20.786 | INFO    | Task run 'fetch_and_store_price-13' - Finished in state Completed()
23:11:20.818 | INFO    | Task run 'fetch_and_store_price-18' - Finished in state Completed()
23:11:20.847 | INFO    | Task run 'fetch_and_store_price-14' - Finished in state Completed()
23:11:20.884 | INFO    | Task run 'fetch_and_store_price-2' - Finished in state Completed()
23:11:20.930 | INFO    | Task run 'fetch_and_store_price-4' - Finished in state Completed()
2025-12-22 23:11:22 | WARNING  | data_sources.stooq:fetch_stooq_prices:89 - No exact match for BAC on 2024-12-01, using latest prior date 2024-11-29
2025-12-22 23:11:22 | INFO     | data_sources.stooq:fetch_stooq_prices:93 - Saved Stooq prices for BAC (83 days of history) to /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq
2025-12-22 23:11:22 | WARNING  | data_sources.stooq:fetch_stooq_prices:89 - No exact match for WMT on 2024-12-01, using latest prior date 2024-11-29
2025-12-22 23:11:22 | INFO     | data_sources.stooq:fetch_stooq_prices:93 - Saved Stooq prices for WMT (83 days of history) to /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq
2025-12-22 23:11:22 | WARNING  | data_sources.stooq:fetch_stooq_prices:89 - No exact match for GOOG on 2024-12-01, using latest prior date 2024-11-29
2025-12-22 23:11:22 | INFO     | data_sources.stooq:fetch_stooq_prices:93 - Saved Stooq prices for GOOG (83 days of history) to /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq
2025-12-22 23:11:22 | WARNING  | data_sources.stooq:fetch_stooq_prices:89 - No exact match for ADBE on 2024-12-01, using latest prior date 2024-11-29
2025-12-22 23:11:22 | INFO     | data_sources.stooq:fetch_stooq_prices:93 - Saved Stooq prices for ADBE (83 days of history) to /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq
2025-12-22 23:11:22 | WARNING  | data_sources.stooq:fetch_stooq_prices:89 - No exact match for JPM on 2024-12-01, using latest prior date 2024-11-29
2025-12-22 23:11:22 | INFO     | data_sources.stooq:fetch_stooq_prices:93 - Saved Stooq prices for JPM (83 days of history) to /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq
2025-12-22 23:11:22 | WARNING  | data_sources.stooq:fetch_stooq_prices:89 - No exact match for PEP on 2024-12-01, using latest prior date 2024-11-29
2025-12-22 23:11:22 | INFO     | data_sources.stooq:fetch_stooq_prices:93 - Saved Stooq prices for PEP (83 days of history) to /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq
2025-12-22 23:11:22 | WARNING  | data_sources.stooq:fetch_stooq_prices:89 - No exact match for COST on 2024-12-01, using latest prior date 2024-11-29
2025-12-22 23:11:22 | INFO     | data_sources.stooq:fetch_stooq_prices:93 - Saved Stooq prices for COST (83 days of history) to /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq
2025-12-22 23:11:22 | WARNING  | data_sources.stooq:fetch_stooq_prices:89 - No exact match for UNH on 2024-12-01, using latest prior date 2024-11-29
2025-12-22 23:11:22 | INFO     | data_sources.stooq:fetch_stooq_prices:93 - Saved Stooq prices for UNH (83 days of history) to /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq
2025-12-22 23:11:22 | WARNING  | data_sources.stooq:fetch_stooq_prices:89 - No exact match for NVDA on 2024-12-01, using latest prior date 2024-11-29
2025-12-22 23:11:22 | INFO     | data_sources.stooq:fetch_stooq_prices:93 - Saved Stooq prices for NVDA (83 days of history) to /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq
2025-12-22 23:11:22 | WARNING  | data_sources.stooq:fetch_stooq_prices:89 - No exact match for AAPL on 2024-12-01, using latest prior date 2024-11-29
2025-12-22 23:11:22 | INFO     | data_sources.stooq:fetch_stooq_prices:93 - Saved Stooq prices for AAPL (83 days of history) to /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq
23:11:22.182 | INFO    | Task run 'fetch_and_store_price-20' - Finished in state Completed()
23:11:22.193 | INFO    | Task run 'fetch_and_store_price-12' - Finished in state Completed()
23:11:22.200 | INFO    | Task run 'fetch_and_store_price-6' - Finished in state Completed()
23:11:22.206 | INFO    | Task run 'fetch_and_store_price-3' - Finished in state Completed()
23:11:22.229 | INFO    | Task run 'fetch_and_store_price-0' - Finished in state Completed()
23:11:22.256 | INFO    | Task run 'fetch_and_store_price-25' - Finished in state Completed()
23:11:22.289 | INFO    | Task run 'fetch_and_store_price-21' - Finished in state Completed()
23:11:22.320 | INFO    | Task run 'fetch_and_store_price-8' - Finished in state Completed()
23:11:22.353 | INFO    | Task run 'fetch_and_store_price-19' - Finished in state Completed()
23:11:22.377 | INFO    | Task run 'fetch_and_store_price-23' - Finished in state Completed()
2025-12-22 23:11:22 | WARNING  | data_sources.stooq:fetch_stooq_prices:89 - No exact match for ABBV on 2024-12-01, using latest prior date 2024-11-29
2025-12-22 23:11:22 | INFO     | data_sources.stooq:fetch_stooq_prices:93 - Saved Stooq prices for ABBV (83 days of history) to /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq
23:11:22.413 | INFO    | Task run 'fetch_and_store_price-22' - Finished in state Completed()
2025-12-22 23:11:22 | WARNING  | data_sources.stooq:fetch_stooq_prices:89 - No exact match for PFE on 2024-12-01, using latest prior date 2024-11-29
2025-12-22 23:11:22 | INFO     | data_sources.stooq:fetch_stooq_prices:93 - Saved Stooq prices for PFE (83 days of history) to /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq
2025-12-22 23:11:22 | WARNING  | data_sources.stooq:fetch_stooq_prices:89 - No exact match for XOM on 2024-12-01, using latest prior date 2024-11-29
2025-12-22 23:11:22 | INFO     | data_sources.stooq:fetch_stooq_prices:93 - Saved Stooq prices for XOM (83 days of history) to /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq
23:11:22.457 | INFO    | Task run 'fetch_and_store_price-17' - Finished in state Completed()
23:11:22.468 | INFO    | Task run 'fetch_and_store_price-15' - Finished in state Completed()
2025-12-22 23:11:22 | WARNING  | data_sources.stooq:fetch_stooq_prices:89 - No exact match for JNJ on 2024-12-01, using latest prior date 2024-11-29
2025-12-22 23:11:22 | INFO     | data_sources.stooq:fetch_stooq_prices:93 - Saved Stooq prices for JNJ (83 days of history) to /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq
23:11:22.528 | INFO    | Task run 'fetch_and_store_price-9' - Finished in state Completed()
2025-12-22 23:11:22 | WARNING  | data_sources.stooq:fetch_stooq_prices:89 - No exact match for V on 2024-12-01, using latest prior date 2024-11-29
2025-12-22 23:11:22 | INFO     | data_sources.stooq:fetch_stooq_prices:93 - Saved Stooq prices for V (83 days of history) to /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq
23:11:22.620 | INFO    | Task run 'fetch_and_store_price-10' - Finished in state Completed()
2025-12-22 23:11:22 | WARNING  | data_sources.stooq:fetch_stooq_prices:89 - No exact match for CVX on 2024-12-01, using latest prior date 2024-11-29
2025-12-22 23:11:22 | INFO     | data_sources.stooq:fetch_stooq_prices:93 - Saved Stooq prices for CVX (83 days of history) to /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq
23:11:22.695 | INFO    | Task run 'fetch_and_store_price-16' - Finished in state Completed()
23:11:22.707 | INFO    | Flow run 'diligent-tapir' - Finished in state Completed('All states completed.')
2025-12-22 23:11:22 | INFO     | __main__:backfill_data:92 - ============================================================
2025-12-22 23:11:22 | INFO     | __main__:backfill_data:93 - Step 2: Finding available dates in raw data
2025-12-22 23:11:22 | INFO     | __main__:backfill_data:94 - ============================================================
2025-12-22 23:11:22 | INFO     | __main__:backfill_data:96 - Found 85 dates with raw price data
2025-12-22 23:11:22 | INFO     | __main__:backfill_data:97 - Date range: 2024-08-05 to 2025-12-22
2025-12-22 23:11:22 | INFO     | __main__:backfill_data:105 - ============================================================
2025-12-22 23:11:22 | INFO     | __main__:backfill_data:106 - Step 3: Running curation for all dates
2025-12-22 23:11:22 | INFO     | __main__:backfill_data:107 - ============================================================
2025-12-22 23:11:22 | INFO     | __main__:backfill_data:110 - Curating date 2024-08-05 (1/85)
23:11:22.727 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/alembic/config.py:598: DeprecationWarning: No path_separator found in configuration; falling back to legacy splitting on spaces, commas, and colons for prepend_sys_path.  Consider adding path_separator=os to Alembic config.
  util.warn_deprecated(

23:11:22.764 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/pydantic/v2_validated_func.py:51: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  class DecoratorBaseModel(BaseModel):

23:11:22.766 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:157: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for name, field in self.model.__fields__.items()

23:11:22.766 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:160: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  non_var_fields = set(self.model.__fields__) - {self.v_args_name, self.v_kwargs_name}

23:11:22.767 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:536: PydanticDeprecatedSince20: The private method `_iter` will be removed and should no longer be used. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for k, v in model._iter()

23:11:22.767 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields_set__` attribute is deprecated, use `model_fields_set` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:22.767 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:22.776 | INFO    | prefect.engine - Created flow run 'magic-falcon' for flow 'curate_data'
2025-12-22 23:11:22 | INFO     | flows.curate_data:curate_data:84 - Starting curation flow for 2024-08-05
23:11:22.790 | INFO    | Flow run 'magic-falcon' - Created task run 'curate_and_validate_prices-0' for task 'curate_and_validate_prices'
23:11:22.790 | INFO    | Flow run 'magic-falcon' - Executing 'curate_and_validate_prices-0' immediately...
2025-12-22 23:11:22 | INFO     | flows.curate_data:curate_and_validate_prices:24 - Starting price curation for 2024-08-05
2025-12-22 23:11:22 | INFO     | curation.curate_prices:curate_daily_prices:52 - Reading 25 ticker files from /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq/2024/08/05
2025-12-22 23:11:22 | INFO     | curation.curate_prices:curate_daily_prices:70 - Combined 25 rows from 25 tickers
23:11:22.880 | ERROR   | Task run 'curate_and_validate_prices-0' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:22.894 | ERROR   | Task run 'curate_and_validate_prices-0' - Finished in state Failed('Task run encountered an exception TypeError: cannot safely cast non-equivalent float64 to int64')
23:11:22.894 | ERROR   | Flow run 'magic-falcon' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 864, in orchestrate_flow_run
    result = await flow_call.aresult()
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 87, in curate_data
    curate_and_validate_prices(run_date_str)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/tasks.py", line 569, in __call__
    return enter_task_run_engine(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1414, in enter_task_run_engine
    return from_sync.wait_for_call_in_loop_thread(begin_run)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/api.py", line 243, in wait_for_call_in_loop_thread
    return call.result()
           ^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 284, in result
    return self.future.result(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 168, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.14_1/Frameworks/Python.framework/Versions/3.11/lib/python3.11/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 355, in _run_async
    result = await coro
             ^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1582, in get_task_call_return_value
    return await future._result()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/futures.py", line 237, in _result
    return await final_state.result(raise_on_failure=raise_on_failure, fetch=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/states.py", line 91, in _get_state_result
    raise await get_state_exception(state)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:22.904 | ERROR   | Flow run 'magic-falcon' - Finished in state Failed('Flow run encountered an exception. TypeError: cannot safely cast non-equivalent float64 to int64')
2025-12-22 23:11:22 | ERROR    | __main__:backfill_data:114 - Failed to curate 2024-08-05: cannot safely cast non-equivalent float64 to int64
2025-12-22 23:11:22 | INFO     | __main__:backfill_data:110 - Curating date 2024-08-06 (2/85)
23:11:22.914 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/alembic/config.py:598: DeprecationWarning: No path_separator found in configuration; falling back to legacy splitting on spaces, commas, and colons for prepend_sys_path.  Consider adding path_separator=os to Alembic config.
  util.warn_deprecated(

23:11:22.930 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/pydantic/v2_validated_func.py:51: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  class DecoratorBaseModel(BaseModel):

23:11:22.931 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:157: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for name, field in self.model.__fields__.items()

23:11:22.931 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:160: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  non_var_fields = set(self.model.__fields__) - {self.v_args_name, self.v_kwargs_name}

23:11:22.931 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:536: PydanticDeprecatedSince20: The private method `_iter` will be removed and should no longer be used. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for k, v in model._iter()

23:11:22.931 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields_set__` attribute is deprecated, use `model_fields_set` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:22.931 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:22.941 | INFO    | prefect.engine - Created flow run 'nifty-husky' for flow 'curate_data'
2025-12-22 23:11:22 | INFO     | flows.curate_data:curate_data:84 - Starting curation flow for 2024-08-06
23:11:22.953 | INFO    | Flow run 'nifty-husky' - Created task run 'curate_and_validate_prices-0' for task 'curate_and_validate_prices'
23:11:22.953 | INFO    | Flow run 'nifty-husky' - Executing 'curate_and_validate_prices-0' immediately...
2025-12-22 23:11:22 | INFO     | flows.curate_data:curate_and_validate_prices:24 - Starting price curation for 2024-08-06
2025-12-22 23:11:22 | INFO     | curation.curate_prices:curate_daily_prices:52 - Reading 25 ticker files from /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq/2024/08/06
2025-12-22 23:11:22 | INFO     | curation.curate_prices:curate_daily_prices:70 - Combined 25 rows from 25 tickers
23:11:22.976 | ERROR   | Task run 'curate_and_validate_prices-0' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:22.984 | ERROR   | Task run 'curate_and_validate_prices-0' - Finished in state Failed('Task run encountered an exception TypeError: cannot safely cast non-equivalent float64 to int64')
23:11:22.984 | ERROR   | Flow run 'nifty-husky' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 864, in orchestrate_flow_run
    result = await flow_call.aresult()
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 87, in curate_data
    curate_and_validate_prices(run_date_str)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/tasks.py", line 569, in __call__
    return enter_task_run_engine(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1414, in enter_task_run_engine
    return from_sync.wait_for_call_in_loop_thread(begin_run)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/api.py", line 243, in wait_for_call_in_loop_thread
    return call.result()
           ^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 284, in result
    return self.future.result(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 168, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.14_1/Frameworks/Python.framework/Versions/3.11/lib/python3.11/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 355, in _run_async
    result = await coro
             ^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1582, in get_task_call_return_value
    return await future._result()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/futures.py", line 237, in _result
    return await final_state.result(raise_on_failure=raise_on_failure, fetch=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/states.py", line 91, in _get_state_result
    raise await get_state_exception(state)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:22.993 | ERROR   | Flow run 'nifty-husky' - Finished in state Failed('Flow run encountered an exception. TypeError: cannot safely cast non-equivalent float64 to int64')
2025-12-22 23:11:22 | ERROR    | __main__:backfill_data:114 - Failed to curate 2024-08-06: cannot safely cast non-equivalent float64 to int64
2025-12-22 23:11:22 | INFO     | __main__:backfill_data:110 - Curating date 2024-08-07 (3/85)
23:11:23.003 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/alembic/config.py:598: DeprecationWarning: No path_separator found in configuration; falling back to legacy splitting on spaces, commas, and colons for prepend_sys_path.  Consider adding path_separator=os to Alembic config.
  util.warn_deprecated(

23:11:23.019 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/pydantic/v2_validated_func.py:51: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  class DecoratorBaseModel(BaseModel):

23:11:23.020 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:157: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for name, field in self.model.__fields__.items()

23:11:23.020 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:160: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  non_var_fields = set(self.model.__fields__) - {self.v_args_name, self.v_kwargs_name}

23:11:23.020 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:536: PydanticDeprecatedSince20: The private method `_iter` will be removed and should no longer be used. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for k, v in model._iter()

23:11:23.020 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields_set__` attribute is deprecated, use `model_fields_set` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:23.021 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:23.029 | INFO    | prefect.engine - Created flow run 'fanatic-stork' for flow 'curate_data'
2025-12-22 23:11:23 | INFO     | flows.curate_data:curate_data:84 - Starting curation flow for 2024-08-07
23:11:23.044 | INFO    | Flow run 'fanatic-stork' - Created task run 'curate_and_validate_prices-0' for task 'curate_and_validate_prices'
23:11:23.045 | INFO    | Flow run 'fanatic-stork' - Executing 'curate_and_validate_prices-0' immediately...
2025-12-22 23:11:23 | INFO     | flows.curate_data:curate_and_validate_prices:24 - Starting price curation for 2024-08-07
2025-12-22 23:11:23 | INFO     | curation.curate_prices:curate_daily_prices:52 - Reading 25 ticker files from /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq/2024/08/07
2025-12-22 23:11:23 | INFO     | curation.curate_prices:curate_daily_prices:70 - Combined 25 rows from 25 tickers
23:11:23.069 | ERROR   | Task run 'curate_and_validate_prices-0' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:23.077 | ERROR   | Task run 'curate_and_validate_prices-0' - Finished in state Failed('Task run encountered an exception TypeError: cannot safely cast non-equivalent float64 to int64')
23:11:23.077 | ERROR   | Flow run 'fanatic-stork' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 864, in orchestrate_flow_run
    result = await flow_call.aresult()
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 87, in curate_data
    curate_and_validate_prices(run_date_str)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/tasks.py", line 569, in __call__
    return enter_task_run_engine(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1414, in enter_task_run_engine
    return from_sync.wait_for_call_in_loop_thread(begin_run)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/api.py", line 243, in wait_for_call_in_loop_thread
    return call.result()
           ^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 284, in result
    return self.future.result(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 168, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.14_1/Frameworks/Python.framework/Versions/3.11/lib/python3.11/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 355, in _run_async
    result = await coro
             ^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1582, in get_task_call_return_value
    return await future._result()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/futures.py", line 237, in _result
    return await final_state.result(raise_on_failure=raise_on_failure, fetch=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/states.py", line 91, in _get_state_result
    raise await get_state_exception(state)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:23.085 | ERROR   | Flow run 'fanatic-stork' - Finished in state Failed('Flow run encountered an exception. TypeError: cannot safely cast non-equivalent float64 to int64')
2025-12-22 23:11:23 | ERROR    | __main__:backfill_data:114 - Failed to curate 2024-08-07: cannot safely cast non-equivalent float64 to int64
2025-12-22 23:11:23 | INFO     | __main__:backfill_data:110 - Curating date 2024-08-08 (4/85)
23:11:23.095 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/alembic/config.py:598: DeprecationWarning: No path_separator found in configuration; falling back to legacy splitting on spaces, commas, and colons for prepend_sys_path.  Consider adding path_separator=os to Alembic config.
  util.warn_deprecated(

23:11:23.114 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/pydantic/v2_validated_func.py:51: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  class DecoratorBaseModel(BaseModel):

23:11:23.114 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:157: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for name, field in self.model.__fields__.items()

23:11:23.115 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:160: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  non_var_fields = set(self.model.__fields__) - {self.v_args_name, self.v_kwargs_name}

23:11:23.115 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:536: PydanticDeprecatedSince20: The private method `_iter` will be removed and should no longer be used. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for k, v in model._iter()

23:11:23.115 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields_set__` attribute is deprecated, use `model_fields_set` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:23.115 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:23.125 | INFO    | prefect.engine - Created flow run 'opal-hippo' for flow 'curate_data'
2025-12-22 23:11:23 | INFO     | flows.curate_data:curate_data:84 - Starting curation flow for 2024-08-08
23:11:23.301 | INFO    | Flow run 'opal-hippo' - Created task run 'curate_and_validate_prices-0' for task 'curate_and_validate_prices'
23:11:23.301 | INFO    | Flow run 'opal-hippo' - Executing 'curate_and_validate_prices-0' immediately...
2025-12-22 23:11:23 | INFO     | flows.curate_data:curate_and_validate_prices:24 - Starting price curation for 2024-08-08
2025-12-22 23:11:23 | INFO     | curation.curate_prices:curate_daily_prices:52 - Reading 25 ticker files from /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq/2024/08/08
2025-12-22 23:11:23 | INFO     | curation.curate_prices:curate_daily_prices:70 - Combined 25 rows from 25 tickers
23:11:23.326 | ERROR   | Task run 'curate_and_validate_prices-0' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:23.335 | ERROR   | Task run 'curate_and_validate_prices-0' - Finished in state Failed('Task run encountered an exception TypeError: cannot safely cast non-equivalent float64 to int64')
23:11:23.335 | ERROR   | Flow run 'opal-hippo' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 864, in orchestrate_flow_run
    result = await flow_call.aresult()
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 87, in curate_data
    curate_and_validate_prices(run_date_str)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/tasks.py", line 569, in __call__
    return enter_task_run_engine(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1414, in enter_task_run_engine
    return from_sync.wait_for_call_in_loop_thread(begin_run)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/api.py", line 243, in wait_for_call_in_loop_thread
    return call.result()
           ^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 284, in result
    return self.future.result(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 168, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.14_1/Frameworks/Python.framework/Versions/3.11/lib/python3.11/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 355, in _run_async
    result = await coro
             ^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1582, in get_task_call_return_value
    return await future._result()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/futures.py", line 237, in _result
    return await final_state.result(raise_on_failure=raise_on_failure, fetch=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/states.py", line 91, in _get_state_result
    raise await get_state_exception(state)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:23.343 | ERROR   | Flow run 'opal-hippo' - Finished in state Failed('Flow run encountered an exception. TypeError: cannot safely cast non-equivalent float64 to int64')
2025-12-22 23:11:23 | ERROR    | __main__:backfill_data:114 - Failed to curate 2024-08-08: cannot safely cast non-equivalent float64 to int64
2025-12-22 23:11:23 | INFO     | __main__:backfill_data:110 - Curating date 2024-08-09 (5/85)
23:11:23.353 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/alembic/config.py:598: DeprecationWarning: No path_separator found in configuration; falling back to legacy splitting on spaces, commas, and colons for prepend_sys_path.  Consider adding path_separator=os to Alembic config.
  util.warn_deprecated(

23:11:23.370 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/pydantic/v2_validated_func.py:51: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  class DecoratorBaseModel(BaseModel):

23:11:23.370 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:157: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for name, field in self.model.__fields__.items()

23:11:23.370 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:160: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  non_var_fields = set(self.model.__fields__) - {self.v_args_name, self.v_kwargs_name}

23:11:23.370 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:536: PydanticDeprecatedSince20: The private method `_iter` will be removed and should no longer be used. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for k, v in model._iter()

23:11:23.371 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields_set__` attribute is deprecated, use `model_fields_set` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:23.371 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:23.379 | INFO    | prefect.engine - Created flow run 'prudent-macaw' for flow 'curate_data'
2025-12-22 23:11:23 | INFO     | flows.curate_data:curate_data:84 - Starting curation flow for 2024-08-09
23:11:23.393 | INFO    | Flow run 'prudent-macaw' - Created task run 'curate_and_validate_prices-0' for task 'curate_and_validate_prices'
23:11:23.394 | INFO    | Flow run 'prudent-macaw' - Executing 'curate_and_validate_prices-0' immediately...
2025-12-22 23:11:23 | INFO     | flows.curate_data:curate_and_validate_prices:24 - Starting price curation for 2024-08-09
2025-12-22 23:11:23 | INFO     | curation.curate_prices:curate_daily_prices:52 - Reading 25 ticker files from /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq/2024/08/09
2025-12-22 23:11:23 | INFO     | curation.curate_prices:curate_daily_prices:70 - Combined 25 rows from 25 tickers
23:11:23.419 | ERROR   | Task run 'curate_and_validate_prices-0' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:23.428 | ERROR   | Task run 'curate_and_validate_prices-0' - Finished in state Failed('Task run encountered an exception TypeError: cannot safely cast non-equivalent float64 to int64')
23:11:23.428 | ERROR   | Flow run 'prudent-macaw' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 864, in orchestrate_flow_run
    result = await flow_call.aresult()
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 87, in curate_data
    curate_and_validate_prices(run_date_str)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/tasks.py", line 569, in __call__
    return enter_task_run_engine(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1414, in enter_task_run_engine
    return from_sync.wait_for_call_in_loop_thread(begin_run)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/api.py", line 243, in wait_for_call_in_loop_thread
    return call.result()
           ^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 284, in result
    return self.future.result(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 168, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.14_1/Frameworks/Python.framework/Versions/3.11/lib/python3.11/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 355, in _run_async
    result = await coro
             ^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1582, in get_task_call_return_value
    return await future._result()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/futures.py", line 237, in _result
    return await final_state.result(raise_on_failure=raise_on_failure, fetch=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/states.py", line 91, in _get_state_result
    raise await get_state_exception(state)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:23.436 | ERROR   | Flow run 'prudent-macaw' - Finished in state Failed('Flow run encountered an exception. TypeError: cannot safely cast non-equivalent float64 to int64')
2025-12-22 23:11:23 | ERROR    | __main__:backfill_data:114 - Failed to curate 2024-08-09: cannot safely cast non-equivalent float64 to int64
2025-12-22 23:11:23 | INFO     | __main__:backfill_data:110 - Curating date 2024-08-12 (6/85)
23:11:23.445 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/alembic/config.py:598: DeprecationWarning: No path_separator found in configuration; falling back to legacy splitting on spaces, commas, and colons for prepend_sys_path.  Consider adding path_separator=os to Alembic config.
  util.warn_deprecated(

23:11:23.461 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/pydantic/v2_validated_func.py:51: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  class DecoratorBaseModel(BaseModel):

23:11:23.462 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:157: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for name, field in self.model.__fields__.items()

23:11:23.462 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:160: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  non_var_fields = set(self.model.__fields__) - {self.v_args_name, self.v_kwargs_name}

23:11:23.462 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:536: PydanticDeprecatedSince20: The private method `_iter` will be removed and should no longer be used. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for k, v in model._iter()

23:11:23.462 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields_set__` attribute is deprecated, use `model_fields_set` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:23.463 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:23.472 | INFO    | prefect.engine - Created flow run 'apricot-seriema' for flow 'curate_data'
2025-12-22 23:11:23 | INFO     | flows.curate_data:curate_data:84 - Starting curation flow for 2024-08-12
23:11:23.486 | INFO    | Flow run 'apricot-seriema' - Created task run 'curate_and_validate_prices-0' for task 'curate_and_validate_prices'
23:11:23.486 | INFO    | Flow run 'apricot-seriema' - Executing 'curate_and_validate_prices-0' immediately...
2025-12-22 23:11:23 | INFO     | flows.curate_data:curate_and_validate_prices:24 - Starting price curation for 2024-08-12
2025-12-22 23:11:23 | INFO     | curation.curate_prices:curate_daily_prices:52 - Reading 25 ticker files from /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq/2024/08/12
2025-12-22 23:11:23 | INFO     | curation.curate_prices:curate_daily_prices:70 - Combined 25 rows from 25 tickers
23:11:23.511 | ERROR   | Task run 'curate_and_validate_prices-0' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:23.520 | ERROR   | Task run 'curate_and_validate_prices-0' - Finished in state Failed('Task run encountered an exception TypeError: cannot safely cast non-equivalent float64 to int64')
23:11:23.520 | ERROR   | Flow run 'apricot-seriema' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 864, in orchestrate_flow_run
    result = await flow_call.aresult()
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 87, in curate_data
    curate_and_validate_prices(run_date_str)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/tasks.py", line 569, in __call__
    return enter_task_run_engine(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1414, in enter_task_run_engine
    return from_sync.wait_for_call_in_loop_thread(begin_run)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/api.py", line 243, in wait_for_call_in_loop_thread
    return call.result()
           ^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 284, in result
    return self.future.result(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 168, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.14_1/Frameworks/Python.framework/Versions/3.11/lib/python3.11/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 355, in _run_async
    result = await coro
             ^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1582, in get_task_call_return_value
    return await future._result()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/futures.py", line 237, in _result
    return await final_state.result(raise_on_failure=raise_on_failure, fetch=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/states.py", line 91, in _get_state_result
    raise await get_state_exception(state)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:23.529 | ERROR   | Flow run 'apricot-seriema' - Finished in state Failed('Flow run encountered an exception. TypeError: cannot safely cast non-equivalent float64 to int64')
2025-12-22 23:11:23 | ERROR    | __main__:backfill_data:114 - Failed to curate 2024-08-12: cannot safely cast non-equivalent float64 to int64
2025-12-22 23:11:23 | INFO     | __main__:backfill_data:110 - Curating date 2024-08-13 (7/85)
23:11:23.538 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/alembic/config.py:598: DeprecationWarning: No path_separator found in configuration; falling back to legacy splitting on spaces, commas, and colons for prepend_sys_path.  Consider adding path_separator=os to Alembic config.
  util.warn_deprecated(

23:11:23.554 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/pydantic/v2_validated_func.py:51: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  class DecoratorBaseModel(BaseModel):

23:11:23.555 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:157: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for name, field in self.model.__fields__.items()

23:11:23.555 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:160: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  non_var_fields = set(self.model.__fields__) - {self.v_args_name, self.v_kwargs_name}

23:11:23.555 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:536: PydanticDeprecatedSince20: The private method `_iter` will be removed and should no longer be used. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for k, v in model._iter()

23:11:23.555 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields_set__` attribute is deprecated, use `model_fields_set` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:23.555 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:23.563 | INFO    | prefect.engine - Created flow run 'aromatic-toucanet' for flow 'curate_data'
2025-12-22 23:11:23 | INFO     | flows.curate_data:curate_data:84 - Starting curation flow for 2024-08-13
23:11:23.576 | INFO    | Flow run 'aromatic-toucanet' - Created task run 'curate_and_validate_prices-0' for task 'curate_and_validate_prices'
23:11:23.577 | INFO    | Flow run 'aromatic-toucanet' - Executing 'curate_and_validate_prices-0' immediately...
2025-12-22 23:11:23 | INFO     | flows.curate_data:curate_and_validate_prices:24 - Starting price curation for 2024-08-13
2025-12-22 23:11:23 | INFO     | curation.curate_prices:curate_daily_prices:52 - Reading 25 ticker files from /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq/2024/08/13
2025-12-22 23:11:23 | INFO     | curation.curate_prices:curate_daily_prices:70 - Combined 25 rows from 25 tickers
23:11:23.601 | ERROR   | Task run 'curate_and_validate_prices-0' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:23.609 | ERROR   | Task run 'curate_and_validate_prices-0' - Finished in state Failed('Task run encountered an exception TypeError: cannot safely cast non-equivalent float64 to int64')
23:11:23.609 | ERROR   | Flow run 'aromatic-toucanet' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 864, in orchestrate_flow_run
    result = await flow_call.aresult()
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 87, in curate_data
    curate_and_validate_prices(run_date_str)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/tasks.py", line 569, in __call__
    return enter_task_run_engine(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1414, in enter_task_run_engine
    return from_sync.wait_for_call_in_loop_thread(begin_run)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/api.py", line 243, in wait_for_call_in_loop_thread
    return call.result()
           ^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 284, in result
    return self.future.result(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 168, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.14_1/Frameworks/Python.framework/Versions/3.11/lib/python3.11/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 355, in _run_async
    result = await coro
             ^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1582, in get_task_call_return_value
    return await future._result()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/futures.py", line 237, in _result
    return await final_state.result(raise_on_failure=raise_on_failure, fetch=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/states.py", line 91, in _get_state_result
    raise await get_state_exception(state)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:23.616 | ERROR   | Flow run 'aromatic-toucanet' - Finished in state Failed('Flow run encountered an exception. TypeError: cannot safely cast non-equivalent float64 to int64')
2025-12-22 23:11:23 | ERROR    | __main__:backfill_data:114 - Failed to curate 2024-08-13: cannot safely cast non-equivalent float64 to int64
2025-12-22 23:11:23 | INFO     | __main__:backfill_data:110 - Curating date 2024-08-14 (8/85)
23:11:23.625 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/alembic/config.py:598: DeprecationWarning: No path_separator found in configuration; falling back to legacy splitting on spaces, commas, and colons for prepend_sys_path.  Consider adding path_separator=os to Alembic config.
  util.warn_deprecated(

23:11:23.641 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/pydantic/v2_validated_func.py:51: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  class DecoratorBaseModel(BaseModel):

23:11:23.642 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:157: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for name, field in self.model.__fields__.items()

23:11:23.642 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:160: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  non_var_fields = set(self.model.__fields__) - {self.v_args_name, self.v_kwargs_name}

23:11:23.642 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:536: PydanticDeprecatedSince20: The private method `_iter` will be removed and should no longer be used. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for k, v in model._iter()

23:11:23.642 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields_set__` attribute is deprecated, use `model_fields_set` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:23.642 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:23.652 | INFO    | prefect.engine - Created flow run 'quirky-mammoth' for flow 'curate_data'
2025-12-22 23:11:23 | INFO     | flows.curate_data:curate_data:84 - Starting curation flow for 2024-08-14
23:11:23.664 | INFO    | Flow run 'quirky-mammoth' - Created task run 'curate_and_validate_prices-0' for task 'curate_and_validate_prices'
23:11:23.664 | INFO    | Flow run 'quirky-mammoth' - Executing 'curate_and_validate_prices-0' immediately...
2025-12-22 23:11:23 | INFO     | flows.curate_data:curate_and_validate_prices:24 - Starting price curation for 2024-08-14
2025-12-22 23:11:23 | INFO     | curation.curate_prices:curate_daily_prices:52 - Reading 25 ticker files from /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq/2024/08/14
2025-12-22 23:11:23 | INFO     | curation.curate_prices:curate_daily_prices:70 - Combined 25 rows from 25 tickers
23:11:23.687 | ERROR   | Task run 'curate_and_validate_prices-0' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:23.696 | ERROR   | Task run 'curate_and_validate_prices-0' - Finished in state Failed('Task run encountered an exception TypeError: cannot safely cast non-equivalent float64 to int64')
23:11:23.696 | ERROR   | Flow run 'quirky-mammoth' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 864, in orchestrate_flow_run
    result = await flow_call.aresult()
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 87, in curate_data
    curate_and_validate_prices(run_date_str)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/tasks.py", line 569, in __call__
    return enter_task_run_engine(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1414, in enter_task_run_engine
    return from_sync.wait_for_call_in_loop_thread(begin_run)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/api.py", line 243, in wait_for_call_in_loop_thread
    return call.result()
           ^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 284, in result
    return self.future.result(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 168, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.14_1/Frameworks/Python.framework/Versions/3.11/lib/python3.11/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 355, in _run_async
    result = await coro
             ^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1582, in get_task_call_return_value
    return await future._result()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/futures.py", line 237, in _result
    return await final_state.result(raise_on_failure=raise_on_failure, fetch=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/states.py", line 91, in _get_state_result
    raise await get_state_exception(state)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:23.704 | ERROR   | Flow run 'quirky-mammoth' - Finished in state Failed('Flow run encountered an exception. TypeError: cannot safely cast non-equivalent float64 to int64')
2025-12-22 23:11:23 | ERROR    | __main__:backfill_data:114 - Failed to curate 2024-08-14: cannot safely cast non-equivalent float64 to int64
2025-12-22 23:11:23 | INFO     | __main__:backfill_data:110 - Curating date 2024-08-15 (9/85)
23:11:23.712 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/alembic/config.py:598: DeprecationWarning: No path_separator found in configuration; falling back to legacy splitting on spaces, commas, and colons for prepend_sys_path.  Consider adding path_separator=os to Alembic config.
  util.warn_deprecated(

23:11:23.728 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/pydantic/v2_validated_func.py:51: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  class DecoratorBaseModel(BaseModel):

23:11:23.729 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:157: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for name, field in self.model.__fields__.items()

23:11:23.729 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:160: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  non_var_fields = set(self.model.__fields__) - {self.v_args_name, self.v_kwargs_name}

23:11:23.729 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:536: PydanticDeprecatedSince20: The private method `_iter` will be removed and should no longer be used. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for k, v in model._iter()

23:11:23.729 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields_set__` attribute is deprecated, use `model_fields_set` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:23.729 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:23.738 | INFO    | prefect.engine - Created flow run 'tangible-scallop' for flow 'curate_data'
2025-12-22 23:11:23 | INFO     | flows.curate_data:curate_data:84 - Starting curation flow for 2024-08-15
23:11:23.752 | INFO    | Flow run 'tangible-scallop' - Created task run 'curate_and_validate_prices-0' for task 'curate_and_validate_prices'
23:11:23.752 | INFO    | Flow run 'tangible-scallop' - Executing 'curate_and_validate_prices-0' immediately...
2025-12-22 23:11:23 | INFO     | flows.curate_data:curate_and_validate_prices:24 - Starting price curation for 2024-08-15
2025-12-22 23:11:23 | INFO     | curation.curate_prices:curate_daily_prices:52 - Reading 25 ticker files from /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq/2024/08/15
2025-12-22 23:11:23 | INFO     | curation.curate_prices:curate_daily_prices:70 - Combined 25 rows from 25 tickers
23:11:23.775 | ERROR   | Task run 'curate_and_validate_prices-0' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:23.783 | ERROR   | Task run 'curate_and_validate_prices-0' - Finished in state Failed('Task run encountered an exception TypeError: cannot safely cast non-equivalent float64 to int64')
23:11:23.783 | ERROR   | Flow run 'tangible-scallop' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 864, in orchestrate_flow_run
    result = await flow_call.aresult()
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 87, in curate_data
    curate_and_validate_prices(run_date_str)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/tasks.py", line 569, in __call__
    return enter_task_run_engine(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1414, in enter_task_run_engine
    return from_sync.wait_for_call_in_loop_thread(begin_run)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/api.py", line 243, in wait_for_call_in_loop_thread
    return call.result()
           ^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 284, in result
    return self.future.result(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 168, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.14_1/Frameworks/Python.framework/Versions/3.11/lib/python3.11/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 355, in _run_async
    result = await coro
             ^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1582, in get_task_call_return_value
    return await future._result()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/futures.py", line 237, in _result
    return await final_state.result(raise_on_failure=raise_on_failure, fetch=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/states.py", line 91, in _get_state_result
    raise await get_state_exception(state)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:23.791 | ERROR   | Flow run 'tangible-scallop' - Finished in state Failed('Flow run encountered an exception. TypeError: cannot safely cast non-equivalent float64 to int64')
2025-12-22 23:11:23 | ERROR    | __main__:backfill_data:114 - Failed to curate 2024-08-15: cannot safely cast non-equivalent float64 to int64
2025-12-22 23:11:23 | INFO     | __main__:backfill_data:110 - Curating date 2024-08-16 (10/85)
23:11:23.799 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/alembic/config.py:598: DeprecationWarning: No path_separator found in configuration; falling back to legacy splitting on spaces, commas, and colons for prepend_sys_path.  Consider adding path_separator=os to Alembic config.
  util.warn_deprecated(

23:11:23.815 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/pydantic/v2_validated_func.py:51: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  class DecoratorBaseModel(BaseModel):

23:11:23.816 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:157: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for name, field in self.model.__fields__.items()

23:11:23.816 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:160: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  non_var_fields = set(self.model.__fields__) - {self.v_args_name, self.v_kwargs_name}

23:11:23.816 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:536: PydanticDeprecatedSince20: The private method `_iter` will be removed and should no longer be used. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for k, v in model._iter()

23:11:23.816 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields_set__` attribute is deprecated, use `model_fields_set` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:23.816 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:23.825 | INFO    | prefect.engine - Created flow run 'prophetic-skink' for flow 'curate_data'
2025-12-22 23:11:23 | INFO     | flows.curate_data:curate_data:84 - Starting curation flow for 2024-08-16
23:11:23.838 | INFO    | Flow run 'prophetic-skink' - Created task run 'curate_and_validate_prices-0' for task 'curate_and_validate_prices'
23:11:23.839 | INFO    | Flow run 'prophetic-skink' - Executing 'curate_and_validate_prices-0' immediately...
2025-12-22 23:11:23 | INFO     | flows.curate_data:curate_and_validate_prices:24 - Starting price curation for 2024-08-16
2025-12-22 23:11:23 | INFO     | curation.curate_prices:curate_daily_prices:52 - Reading 25 ticker files from /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq/2024/08/16
2025-12-22 23:11:23 | INFO     | curation.curate_prices:curate_daily_prices:70 - Combined 25 rows from 25 tickers
23:11:23.866 | ERROR   | Task run 'curate_and_validate_prices-0' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:23.877 | ERROR   | Task run 'curate_and_validate_prices-0' - Finished in state Failed('Task run encountered an exception TypeError: cannot safely cast non-equivalent float64 to int64')
23:11:23.878 | ERROR   | Flow run 'prophetic-skink' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 864, in orchestrate_flow_run
    result = await flow_call.aresult()
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 87, in curate_data
    curate_and_validate_prices(run_date_str)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/tasks.py", line 569, in __call__
    return enter_task_run_engine(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1414, in enter_task_run_engine
    return from_sync.wait_for_call_in_loop_thread(begin_run)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/api.py", line 243, in wait_for_call_in_loop_thread
    return call.result()
           ^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 284, in result
    return self.future.result(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 168, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.14_1/Frameworks/Python.framework/Versions/3.11/lib/python3.11/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 355, in _run_async
    result = await coro
             ^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1582, in get_task_call_return_value
    return await future._result()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/futures.py", line 237, in _result
    return await final_state.result(raise_on_failure=raise_on_failure, fetch=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/states.py", line 91, in _get_state_result
    raise await get_state_exception(state)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:23.887 | ERROR   | Flow run 'prophetic-skink' - Finished in state Failed('Flow run encountered an exception. TypeError: cannot safely cast non-equivalent float64 to int64')
2025-12-22 23:11:23 | ERROR    | __main__:backfill_data:114 - Failed to curate 2024-08-16: cannot safely cast non-equivalent float64 to int64
2025-12-22 23:11:23 | INFO     | __main__:backfill_data:110 - Curating date 2024-08-19 (11/85)
23:11:23.897 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/alembic/config.py:598: DeprecationWarning: No path_separator found in configuration; falling back to legacy splitting on spaces, commas, and colons for prepend_sys_path.  Consider adding path_separator=os to Alembic config.
  util.warn_deprecated(

23:11:23.916 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/pydantic/v2_validated_func.py:51: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  class DecoratorBaseModel(BaseModel):

23:11:23.917 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:157: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for name, field in self.model.__fields__.items()

23:11:23.917 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:160: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  non_var_fields = set(self.model.__fields__) - {self.v_args_name, self.v_kwargs_name}

23:11:23.917 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:536: PydanticDeprecatedSince20: The private method `_iter` will be removed and should no longer be used. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for k, v in model._iter()

23:11:23.917 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields_set__` attribute is deprecated, use `model_fields_set` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:23.917 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:23.926 | INFO    | prefect.engine - Created flow run 'big-porcupine' for flow 'curate_data'
2025-12-22 23:11:23 | INFO     | flows.curate_data:curate_data:84 - Starting curation flow for 2024-08-19
23:11:23.939 | INFO    | Flow run 'big-porcupine' - Created task run 'curate_and_validate_prices-0' for task 'curate_and_validate_prices'
23:11:23.939 | INFO    | Flow run 'big-porcupine' - Executing 'curate_and_validate_prices-0' immediately...
2025-12-22 23:11:23 | INFO     | flows.curate_data:curate_and_validate_prices:24 - Starting price curation for 2024-08-19
2025-12-22 23:11:23 | INFO     | curation.curate_prices:curate_daily_prices:52 - Reading 25 ticker files from /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq/2024/08/19
2025-12-22 23:11:23 | INFO     | curation.curate_prices:curate_daily_prices:70 - Combined 25 rows from 25 tickers
23:11:23.962 | ERROR   | Task run 'curate_and_validate_prices-0' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:23.970 | ERROR   | Task run 'curate_and_validate_prices-0' - Finished in state Failed('Task run encountered an exception TypeError: cannot safely cast non-equivalent float64 to int64')
23:11:23.971 | ERROR   | Flow run 'big-porcupine' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 864, in orchestrate_flow_run
    result = await flow_call.aresult()
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 87, in curate_data
    curate_and_validate_prices(run_date_str)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/tasks.py", line 569, in __call__
    return enter_task_run_engine(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1414, in enter_task_run_engine
    return from_sync.wait_for_call_in_loop_thread(begin_run)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/api.py", line 243, in wait_for_call_in_loop_thread
    return call.result()
           ^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 284, in result
    return self.future.result(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 168, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.14_1/Frameworks/Python.framework/Versions/3.11/lib/python3.11/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 355, in _run_async
    result = await coro
             ^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1582, in get_task_call_return_value
    return await future._result()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/futures.py", line 237, in _result
    return await final_state.result(raise_on_failure=raise_on_failure, fetch=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/states.py", line 91, in _get_state_result
    raise await get_state_exception(state)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:23.978 | ERROR   | Flow run 'big-porcupine' - Finished in state Failed('Flow run encountered an exception. TypeError: cannot safely cast non-equivalent float64 to int64')
2025-12-22 23:11:23 | ERROR    | __main__:backfill_data:114 - Failed to curate 2024-08-19: cannot safely cast non-equivalent float64 to int64
2025-12-22 23:11:23 | INFO     | __main__:backfill_data:110 - Curating date 2024-08-20 (12/85)
23:11:23.987 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/alembic/config.py:598: DeprecationWarning: No path_separator found in configuration; falling back to legacy splitting on spaces, commas, and colons for prepend_sys_path.  Consider adding path_separator=os to Alembic config.
  util.warn_deprecated(

23:11:24.005 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/pydantic/v2_validated_func.py:51: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  class DecoratorBaseModel(BaseModel):

23:11:24.005 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:157: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for name, field in self.model.__fields__.items()

23:11:24.006 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:160: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  non_var_fields = set(self.model.__fields__) - {self.v_args_name, self.v_kwargs_name}

23:11:24.006 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:536: PydanticDeprecatedSince20: The private method `_iter` will be removed and should no longer be used. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for k, v in model._iter()

23:11:24.006 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields_set__` attribute is deprecated, use `model_fields_set` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:24.006 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:24.015 | INFO    | prefect.engine - Created flow run 'beautiful-tuatara' for flow 'curate_data'
2025-12-22 23:11:24 | INFO     | flows.curate_data:curate_data:84 - Starting curation flow for 2024-08-20
23:11:24.029 | INFO    | Flow run 'beautiful-tuatara' - Created task run 'curate_and_validate_prices-0' for task 'curate_and_validate_prices'
23:11:24.029 | INFO    | Flow run 'beautiful-tuatara' - Executing 'curate_and_validate_prices-0' immediately...
2025-12-22 23:11:24 | INFO     | flows.curate_data:curate_and_validate_prices:24 - Starting price curation for 2024-08-20
2025-12-22 23:11:24 | INFO     | curation.curate_prices:curate_daily_prices:52 - Reading 25 ticker files from /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq/2024/08/20
2025-12-22 23:11:24 | INFO     | curation.curate_prices:curate_daily_prices:70 - Combined 25 rows from 25 tickers
23:11:24.053 | ERROR   | Task run 'curate_and_validate_prices-0' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:24.060 | ERROR   | Task run 'curate_and_validate_prices-0' - Finished in state Failed('Task run encountered an exception TypeError: cannot safely cast non-equivalent float64 to int64')
23:11:24.061 | ERROR   | Flow run 'beautiful-tuatara' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 864, in orchestrate_flow_run
    result = await flow_call.aresult()
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 87, in curate_data
    curate_and_validate_prices(run_date_str)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/tasks.py", line 569, in __call__
    return enter_task_run_engine(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1414, in enter_task_run_engine
    return from_sync.wait_for_call_in_loop_thread(begin_run)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/api.py", line 243, in wait_for_call_in_loop_thread
    return call.result()
           ^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 284, in result
    return self.future.result(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 168, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.14_1/Frameworks/Python.framework/Versions/3.11/lib/python3.11/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 355, in _run_async
    result = await coro
             ^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1582, in get_task_call_return_value
    return await future._result()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/futures.py", line 237, in _result
    return await final_state.result(raise_on_failure=raise_on_failure, fetch=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/states.py", line 91, in _get_state_result
    raise await get_state_exception(state)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:24.068 | ERROR   | Flow run 'beautiful-tuatara' - Finished in state Failed('Flow run encountered an exception. TypeError: cannot safely cast non-equivalent float64 to int64')
2025-12-22 23:11:24 | ERROR    | __main__:backfill_data:114 - Failed to curate 2024-08-20: cannot safely cast non-equivalent float64 to int64
2025-12-22 23:11:24 | INFO     | __main__:backfill_data:110 - Curating date 2024-08-21 (13/85)
23:11:24.077 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/alembic/config.py:598: DeprecationWarning: No path_separator found in configuration; falling back to legacy splitting on spaces, commas, and colons for prepend_sys_path.  Consider adding path_separator=os to Alembic config.
  util.warn_deprecated(

23:11:24.092 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/pydantic/v2_validated_func.py:51: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  class DecoratorBaseModel(BaseModel):

23:11:24.093 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:157: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for name, field in self.model.__fields__.items()

23:11:24.093 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:160: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  non_var_fields = set(self.model.__fields__) - {self.v_args_name, self.v_kwargs_name}

23:11:24.093 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:536: PydanticDeprecatedSince20: The private method `_iter` will be removed and should no longer be used. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for k, v in model._iter()

23:11:24.093 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields_set__` attribute is deprecated, use `model_fields_set` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:24.093 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:24.103 | INFO    | prefect.engine - Created flow run 'greedy-tench' for flow 'curate_data'
2025-12-22 23:11:24 | INFO     | flows.curate_data:curate_data:84 - Starting curation flow for 2024-08-21
23:11:24.114 | INFO    | Flow run 'greedy-tench' - Created task run 'curate_and_validate_prices-0' for task 'curate_and_validate_prices'
23:11:24.115 | INFO    | Flow run 'greedy-tench' - Executing 'curate_and_validate_prices-0' immediately...
2025-12-22 23:11:24 | INFO     | flows.curate_data:curate_and_validate_prices:24 - Starting price curation for 2024-08-21
2025-12-22 23:11:24 | INFO     | curation.curate_prices:curate_daily_prices:52 - Reading 25 ticker files from /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq/2024/08/21
2025-12-22 23:11:24 | INFO     | curation.curate_prices:curate_daily_prices:70 - Combined 25 rows from 25 tickers
23:11:24.139 | ERROR   | Task run 'curate_and_validate_prices-0' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:24.148 | ERROR   | Task run 'curate_and_validate_prices-0' - Finished in state Failed('Task run encountered an exception TypeError: cannot safely cast non-equivalent float64 to int64')
23:11:24.148 | ERROR   | Flow run 'greedy-tench' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 864, in orchestrate_flow_run
    result = await flow_call.aresult()
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 87, in curate_data
    curate_and_validate_prices(run_date_str)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/tasks.py", line 569, in __call__
    return enter_task_run_engine(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1414, in enter_task_run_engine
    return from_sync.wait_for_call_in_loop_thread(begin_run)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/api.py", line 243, in wait_for_call_in_loop_thread
    return call.result()
           ^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 284, in result
    return self.future.result(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 168, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.14_1/Frameworks/Python.framework/Versions/3.11/lib/python3.11/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 355, in _run_async
    result = await coro
             ^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1582, in get_task_call_return_value
    return await future._result()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/futures.py", line 237, in _result
    return await final_state.result(raise_on_failure=raise_on_failure, fetch=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/states.py", line 91, in _get_state_result
    raise await get_state_exception(state)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:24.156 | ERROR   | Flow run 'greedy-tench' - Finished in state Failed('Flow run encountered an exception. TypeError: cannot safely cast non-equivalent float64 to int64')
2025-12-22 23:11:24 | ERROR    | __main__:backfill_data:114 - Failed to curate 2024-08-21: cannot safely cast non-equivalent float64 to int64
2025-12-22 23:11:24 | INFO     | __main__:backfill_data:110 - Curating date 2024-08-22 (14/85)
23:11:24.165 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/alembic/config.py:598: DeprecationWarning: No path_separator found in configuration; falling back to legacy splitting on spaces, commas, and colons for prepend_sys_path.  Consider adding path_separator=os to Alembic config.
  util.warn_deprecated(

23:11:24.181 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/pydantic/v2_validated_func.py:51: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  class DecoratorBaseModel(BaseModel):

23:11:24.181 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:157: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for name, field in self.model.__fields__.items()

23:11:24.181 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:160: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  non_var_fields = set(self.model.__fields__) - {self.v_args_name, self.v_kwargs_name}

23:11:24.181 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:536: PydanticDeprecatedSince20: The private method `_iter` will be removed and should no longer be used. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for k, v in model._iter()

23:11:24.182 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields_set__` attribute is deprecated, use `model_fields_set` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:24.182 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:24.190 | INFO    | prefect.engine - Created flow run 'unique-sheep' for flow 'curate_data'
2025-12-22 23:11:24 | INFO     | flows.curate_data:curate_data:84 - Starting curation flow for 2024-08-22
23:11:24.203 | INFO    | Flow run 'unique-sheep' - Created task run 'curate_and_validate_prices-0' for task 'curate_and_validate_prices'
23:11:24.203 | INFO    | Flow run 'unique-sheep' - Executing 'curate_and_validate_prices-0' immediately...
2025-12-22 23:11:24 | INFO     | flows.curate_data:curate_and_validate_prices:24 - Starting price curation for 2024-08-22
2025-12-22 23:11:24 | INFO     | curation.curate_prices:curate_daily_prices:52 - Reading 25 ticker files from /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq/2024/08/22
2025-12-22 23:11:24 | INFO     | curation.curate_prices:curate_daily_prices:70 - Combined 25 rows from 25 tickers
23:11:24.227 | ERROR   | Task run 'curate_and_validate_prices-0' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:24.236 | ERROR   | Task run 'curate_and_validate_prices-0' - Finished in state Failed('Task run encountered an exception TypeError: cannot safely cast non-equivalent float64 to int64')
23:11:24.236 | ERROR   | Flow run 'unique-sheep' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 864, in orchestrate_flow_run
    result = await flow_call.aresult()
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 87, in curate_data
    curate_and_validate_prices(run_date_str)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/tasks.py", line 569, in __call__
    return enter_task_run_engine(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1414, in enter_task_run_engine
    return from_sync.wait_for_call_in_loop_thread(begin_run)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/api.py", line 243, in wait_for_call_in_loop_thread
    return call.result()
           ^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 284, in result
    return self.future.result(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 168, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.14_1/Frameworks/Python.framework/Versions/3.11/lib/python3.11/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 355, in _run_async
    result = await coro
             ^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1582, in get_task_call_return_value
    return await future._result()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/futures.py", line 237, in _result
    return await final_state.result(raise_on_failure=raise_on_failure, fetch=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/states.py", line 91, in _get_state_result
    raise await get_state_exception(state)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:24.243 | ERROR   | Flow run 'unique-sheep' - Finished in state Failed('Flow run encountered an exception. TypeError: cannot safely cast non-equivalent float64 to int64')
2025-12-22 23:11:24 | ERROR    | __main__:backfill_data:114 - Failed to curate 2024-08-22: cannot safely cast non-equivalent float64 to int64
2025-12-22 23:11:24 | INFO     | __main__:backfill_data:110 - Curating date 2024-08-23 (15/85)
23:11:24.253 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/alembic/config.py:598: DeprecationWarning: No path_separator found in configuration; falling back to legacy splitting on spaces, commas, and colons for prepend_sys_path.  Consider adding path_separator=os to Alembic config.
  util.warn_deprecated(

23:11:24.268 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/pydantic/v2_validated_func.py:51: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  class DecoratorBaseModel(BaseModel):

23:11:24.269 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:157: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for name, field in self.model.__fields__.items()

23:11:24.269 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:160: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  non_var_fields = set(self.model.__fields__) - {self.v_args_name, self.v_kwargs_name}

23:11:24.269 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:536: PydanticDeprecatedSince20: The private method `_iter` will be removed and should no longer be used. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for k, v in model._iter()

23:11:24.269 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields_set__` attribute is deprecated, use `model_fields_set` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:24.269 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:24.277 | INFO    | prefect.engine - Created flow run 'large-dogfish' for flow 'curate_data'
2025-12-22 23:11:24 | INFO     | flows.curate_data:curate_data:84 - Starting curation flow for 2024-08-23
23:11:24.290 | INFO    | Flow run 'large-dogfish' - Created task run 'curate_and_validate_prices-0' for task 'curate_and_validate_prices'
23:11:24.290 | INFO    | Flow run 'large-dogfish' - Executing 'curate_and_validate_prices-0' immediately...
2025-12-22 23:11:24 | INFO     | flows.curate_data:curate_and_validate_prices:24 - Starting price curation for 2024-08-23
2025-12-22 23:11:24 | INFO     | curation.curate_prices:curate_daily_prices:52 - Reading 25 ticker files from /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq/2024/08/23
2025-12-22 23:11:24 | INFO     | curation.curate_prices:curate_daily_prices:70 - Combined 25 rows from 25 tickers
23:11:24.313 | ERROR   | Task run 'curate_and_validate_prices-0' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:24.322 | ERROR   | Task run 'curate_and_validate_prices-0' - Finished in state Failed('Task run encountered an exception TypeError: cannot safely cast non-equivalent float64 to int64')
23:11:24.322 | ERROR   | Flow run 'large-dogfish' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 864, in orchestrate_flow_run
    result = await flow_call.aresult()
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 87, in curate_data
    curate_and_validate_prices(run_date_str)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/tasks.py", line 569, in __call__
    return enter_task_run_engine(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1414, in enter_task_run_engine
    return from_sync.wait_for_call_in_loop_thread(begin_run)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/api.py", line 243, in wait_for_call_in_loop_thread
    return call.result()
           ^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 284, in result
    return self.future.result(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 168, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.14_1/Frameworks/Python.framework/Versions/3.11/lib/python3.11/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 355, in _run_async
    result = await coro
             ^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1582, in get_task_call_return_value
    return await future._result()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/futures.py", line 237, in _result
    return await final_state.result(raise_on_failure=raise_on_failure, fetch=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/states.py", line 91, in _get_state_result
    raise await get_state_exception(state)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:24.329 | ERROR   | Flow run 'large-dogfish' - Finished in state Failed('Flow run encountered an exception. TypeError: cannot safely cast non-equivalent float64 to int64')
2025-12-22 23:11:24 | ERROR    | __main__:backfill_data:114 - Failed to curate 2024-08-23: cannot safely cast non-equivalent float64 to int64
2025-12-22 23:11:24 | INFO     | __main__:backfill_data:110 - Curating date 2024-08-26 (16/85)
23:11:24.338 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/alembic/config.py:598: DeprecationWarning: No path_separator found in configuration; falling back to legacy splitting on spaces, commas, and colons for prepend_sys_path.  Consider adding path_separator=os to Alembic config.
  util.warn_deprecated(

23:11:24.353 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/pydantic/v2_validated_func.py:51: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  class DecoratorBaseModel(BaseModel):

23:11:24.353 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:157: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for name, field in self.model.__fields__.items()

23:11:24.353 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:160: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  non_var_fields = set(self.model.__fields__) - {self.v_args_name, self.v_kwargs_name}

23:11:24.354 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:536: PydanticDeprecatedSince20: The private method `_iter` will be removed and should no longer be used. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for k, v in model._iter()

23:11:24.354 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields_set__` attribute is deprecated, use `model_fields_set` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:24.354 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:24.362 | INFO    | prefect.engine - Created flow run 'natural-squid' for flow 'curate_data'
2025-12-22 23:11:24 | INFO     | flows.curate_data:curate_data:84 - Starting curation flow for 2024-08-26
23:11:24.375 | INFO    | Flow run 'natural-squid' - Created task run 'curate_and_validate_prices-0' for task 'curate_and_validate_prices'
23:11:24.375 | INFO    | Flow run 'natural-squid' - Executing 'curate_and_validate_prices-0' immediately...
2025-12-22 23:11:24 | INFO     | flows.curate_data:curate_and_validate_prices:24 - Starting price curation for 2024-08-26
2025-12-22 23:11:24 | INFO     | curation.curate_prices:curate_daily_prices:52 - Reading 25 ticker files from /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq/2024/08/26
2025-12-22 23:11:24 | INFO     | curation.curate_prices:curate_daily_prices:70 - Combined 25 rows from 25 tickers
23:11:24.398 | ERROR   | Task run 'curate_and_validate_prices-0' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:24.406 | ERROR   | Task run 'curate_and_validate_prices-0' - Finished in state Failed('Task run encountered an exception TypeError: cannot safely cast non-equivalent float64 to int64')
23:11:24.406 | ERROR   | Flow run 'natural-squid' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 864, in orchestrate_flow_run
    result = await flow_call.aresult()
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 87, in curate_data
    curate_and_validate_prices(run_date_str)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/tasks.py", line 569, in __call__
    return enter_task_run_engine(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1414, in enter_task_run_engine
    return from_sync.wait_for_call_in_loop_thread(begin_run)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/api.py", line 243, in wait_for_call_in_loop_thread
    return call.result()
           ^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 284, in result
    return self.future.result(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 168, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.14_1/Frameworks/Python.framework/Versions/3.11/lib/python3.11/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 355, in _run_async
    result = await coro
             ^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1582, in get_task_call_return_value
    return await future._result()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/futures.py", line 237, in _result
    return await final_state.result(raise_on_failure=raise_on_failure, fetch=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/states.py", line 91, in _get_state_result
    raise await get_state_exception(state)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:24.413 | ERROR   | Flow run 'natural-squid' - Finished in state Failed('Flow run encountered an exception. TypeError: cannot safely cast non-equivalent float64 to int64')
2025-12-22 23:11:24 | ERROR    | __main__:backfill_data:114 - Failed to curate 2024-08-26: cannot safely cast non-equivalent float64 to int64
2025-12-22 23:11:24 | INFO     | __main__:backfill_data:110 - Curating date 2024-08-27 (17/85)
23:11:24.422 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/alembic/config.py:598: DeprecationWarning: No path_separator found in configuration; falling back to legacy splitting on spaces, commas, and colons for prepend_sys_path.  Consider adding path_separator=os to Alembic config.
  util.warn_deprecated(

23:11:24.437 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/pydantic/v2_validated_func.py:51: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  class DecoratorBaseModel(BaseModel):

23:11:24.438 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:157: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for name, field in self.model.__fields__.items()

23:11:24.438 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:160: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  non_var_fields = set(self.model.__fields__) - {self.v_args_name, self.v_kwargs_name}

23:11:24.438 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:536: PydanticDeprecatedSince20: The private method `_iter` will be removed and should no longer be used. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for k, v in model._iter()

23:11:24.438 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields_set__` attribute is deprecated, use `model_fields_set` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:24.438 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:24.447 | INFO    | prefect.engine - Created flow run 'visionary-goldfish' for flow 'curate_data'
2025-12-22 23:11:24 | INFO     | flows.curate_data:curate_data:84 - Starting curation flow for 2024-08-27
23:11:24.459 | INFO    | Flow run 'visionary-goldfish' - Created task run 'curate_and_validate_prices-0' for task 'curate_and_validate_prices'
23:11:24.459 | INFO    | Flow run 'visionary-goldfish' - Executing 'curate_and_validate_prices-0' immediately...
2025-12-22 23:11:24 | INFO     | flows.curate_data:curate_and_validate_prices:24 - Starting price curation for 2024-08-27
2025-12-22 23:11:24 | INFO     | curation.curate_prices:curate_daily_prices:52 - Reading 25 ticker files from /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq/2024/08/27
2025-12-22 23:11:24 | INFO     | curation.curate_prices:curate_daily_prices:70 - Combined 25 rows from 25 tickers
23:11:24.483 | ERROR   | Task run 'curate_and_validate_prices-0' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:24.492 | ERROR   | Task run 'curate_and_validate_prices-0' - Finished in state Failed('Task run encountered an exception TypeError: cannot safely cast non-equivalent float64 to int64')
23:11:24.492 | ERROR   | Flow run 'visionary-goldfish' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 864, in orchestrate_flow_run
    result = await flow_call.aresult()
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 87, in curate_data
    curate_and_validate_prices(run_date_str)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/tasks.py", line 569, in __call__
    return enter_task_run_engine(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1414, in enter_task_run_engine
    return from_sync.wait_for_call_in_loop_thread(begin_run)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/api.py", line 243, in wait_for_call_in_loop_thread
    return call.result()
           ^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 284, in result
    return self.future.result(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 168, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.14_1/Frameworks/Python.framework/Versions/3.11/lib/python3.11/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 355, in _run_async
    result = await coro
             ^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1582, in get_task_call_return_value
    return await future._result()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/futures.py", line 237, in _result
    return await final_state.result(raise_on_failure=raise_on_failure, fetch=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/states.py", line 91, in _get_state_result
    raise await get_state_exception(state)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:24.499 | ERROR   | Flow run 'visionary-goldfish' - Finished in state Failed('Flow run encountered an exception. TypeError: cannot safely cast non-equivalent float64 to int64')
2025-12-22 23:11:24 | ERROR    | __main__:backfill_data:114 - Failed to curate 2024-08-27: cannot safely cast non-equivalent float64 to int64
2025-12-22 23:11:24 | INFO     | __main__:backfill_data:110 - Curating date 2024-08-28 (18/85)
23:11:24.508 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/alembic/config.py:598: DeprecationWarning: No path_separator found in configuration; falling back to legacy splitting on spaces, commas, and colons for prepend_sys_path.  Consider adding path_separator=os to Alembic config.
  util.warn_deprecated(

23:11:24.523 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/pydantic/v2_validated_func.py:51: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  class DecoratorBaseModel(BaseModel):

23:11:24.524 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:157: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for name, field in self.model.__fields__.items()

23:11:24.524 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:160: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  non_var_fields = set(self.model.__fields__) - {self.v_args_name, self.v_kwargs_name}

23:11:24.524 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:536: PydanticDeprecatedSince20: The private method `_iter` will be removed and should no longer be used. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for k, v in model._iter()

23:11:24.524 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields_set__` attribute is deprecated, use `model_fields_set` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:24.524 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:24.535 | INFO    | prefect.engine - Created flow run 'cuddly-seriema' for flow 'curate_data'
2025-12-22 23:11:24 | INFO     | flows.curate_data:curate_data:84 - Starting curation flow for 2024-08-28
23:11:24.547 | INFO    | Flow run 'cuddly-seriema' - Created task run 'curate_and_validate_prices-0' for task 'curate_and_validate_prices'
23:11:24.548 | INFO    | Flow run 'cuddly-seriema' - Executing 'curate_and_validate_prices-0' immediately...
2025-12-22 23:11:24 | INFO     | flows.curate_data:curate_and_validate_prices:24 - Starting price curation for 2024-08-28
2025-12-22 23:11:24 | INFO     | curation.curate_prices:curate_daily_prices:52 - Reading 25 ticker files from /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq/2024/08/28
2025-12-22 23:11:24 | INFO     | curation.curate_prices:curate_daily_prices:70 - Combined 25 rows from 25 tickers
23:11:24.572 | ERROR   | Task run 'curate_and_validate_prices-0' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:24.579 | ERROR   | Task run 'curate_and_validate_prices-0' - Finished in state Failed('Task run encountered an exception TypeError: cannot safely cast non-equivalent float64 to int64')
23:11:24.580 | ERROR   | Flow run 'cuddly-seriema' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 864, in orchestrate_flow_run
    result = await flow_call.aresult()
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 87, in curate_data
    curate_and_validate_prices(run_date_str)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/tasks.py", line 569, in __call__
    return enter_task_run_engine(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1414, in enter_task_run_engine
    return from_sync.wait_for_call_in_loop_thread(begin_run)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/api.py", line 243, in wait_for_call_in_loop_thread
    return call.result()
           ^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 284, in result
    return self.future.result(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 168, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.14_1/Frameworks/Python.framework/Versions/3.11/lib/python3.11/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 355, in _run_async
    result = await coro
             ^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1582, in get_task_call_return_value
    return await future._result()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/futures.py", line 237, in _result
    return await final_state.result(raise_on_failure=raise_on_failure, fetch=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/states.py", line 91, in _get_state_result
    raise await get_state_exception(state)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:24.588 | ERROR   | Flow run 'cuddly-seriema' - Finished in state Failed('Flow run encountered an exception. TypeError: cannot safely cast non-equivalent float64 to int64')
2025-12-22 23:11:24 | ERROR    | __main__:backfill_data:114 - Failed to curate 2024-08-28: cannot safely cast non-equivalent float64 to int64
2025-12-22 23:11:24 | INFO     | __main__:backfill_data:110 - Curating date 2024-08-29 (19/85)
23:11:24.596 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/alembic/config.py:598: DeprecationWarning: No path_separator found in configuration; falling back to legacy splitting on spaces, commas, and colons for prepend_sys_path.  Consider adding path_separator=os to Alembic config.
  util.warn_deprecated(

23:11:24.611 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/pydantic/v2_validated_func.py:51: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  class DecoratorBaseModel(BaseModel):

23:11:24.612 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:157: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for name, field in self.model.__fields__.items()

23:11:24.612 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:160: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  non_var_fields = set(self.model.__fields__) - {self.v_args_name, self.v_kwargs_name}

23:11:24.612 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:536: PydanticDeprecatedSince20: The private method `_iter` will be removed and should no longer be used. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for k, v in model._iter()

23:11:24.612 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields_set__` attribute is deprecated, use `model_fields_set` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:24.612 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:24.620 | INFO    | prefect.engine - Created flow run 'steel-bison' for flow 'curate_data'
2025-12-22 23:11:24 | INFO     | flows.curate_data:curate_data:84 - Starting curation flow for 2024-08-29
23:11:24.633 | INFO    | Flow run 'steel-bison' - Created task run 'curate_and_validate_prices-0' for task 'curate_and_validate_prices'
23:11:24.633 | INFO    | Flow run 'steel-bison' - Executing 'curate_and_validate_prices-0' immediately...
2025-12-22 23:11:24 | INFO     | flows.curate_data:curate_and_validate_prices:24 - Starting price curation for 2024-08-29
2025-12-22 23:11:24 | INFO     | curation.curate_prices:curate_daily_prices:52 - Reading 25 ticker files from /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq/2024/08/29
2025-12-22 23:11:24 | INFO     | curation.curate_prices:curate_daily_prices:70 - Combined 25 rows from 25 tickers
23:11:24.657 | ERROR   | Task run 'curate_and_validate_prices-0' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:24.665 | ERROR   | Task run 'curate_and_validate_prices-0' - Finished in state Failed('Task run encountered an exception TypeError: cannot safely cast non-equivalent float64 to int64')
23:11:24.665 | ERROR   | Flow run 'steel-bison' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 864, in orchestrate_flow_run
    result = await flow_call.aresult()
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 87, in curate_data
    curate_and_validate_prices(run_date_str)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/tasks.py", line 569, in __call__
    return enter_task_run_engine(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1414, in enter_task_run_engine
    return from_sync.wait_for_call_in_loop_thread(begin_run)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/api.py", line 243, in wait_for_call_in_loop_thread
    return call.result()
           ^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 284, in result
    return self.future.result(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 168, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.14_1/Frameworks/Python.framework/Versions/3.11/lib/python3.11/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 355, in _run_async
    result = await coro
             ^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1582, in get_task_call_return_value
    return await future._result()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/futures.py", line 237, in _result
    return await final_state.result(raise_on_failure=raise_on_failure, fetch=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/states.py", line 91, in _get_state_result
    raise await get_state_exception(state)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:24.673 | ERROR   | Flow run 'steel-bison' - Finished in state Failed('Flow run encountered an exception. TypeError: cannot safely cast non-equivalent float64 to int64')
2025-12-22 23:11:24 | ERROR    | __main__:backfill_data:114 - Failed to curate 2024-08-29: cannot safely cast non-equivalent float64 to int64
2025-12-22 23:11:24 | INFO     | __main__:backfill_data:110 - Curating date 2024-08-30 (20/85)
23:11:24.681 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/alembic/config.py:598: DeprecationWarning: No path_separator found in configuration; falling back to legacy splitting on spaces, commas, and colons for prepend_sys_path.  Consider adding path_separator=os to Alembic config.
  util.warn_deprecated(

23:11:24.696 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/pydantic/v2_validated_func.py:51: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  class DecoratorBaseModel(BaseModel):

23:11:24.697 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:157: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for name, field in self.model.__fields__.items()

23:11:24.697 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:160: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  non_var_fields = set(self.model.__fields__) - {self.v_args_name, self.v_kwargs_name}

23:11:24.697 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:536: PydanticDeprecatedSince20: The private method `_iter` will be removed and should no longer be used. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for k, v in model._iter()

23:11:24.697 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields_set__` attribute is deprecated, use `model_fields_set` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:24.697 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:24.706 | INFO    | prefect.engine - Created flow run 'beryl-armadillo' for flow 'curate_data'
2025-12-22 23:11:24 | INFO     | flows.curate_data:curate_data:84 - Starting curation flow for 2024-08-30
23:11:24.718 | INFO    | Flow run 'beryl-armadillo' - Created task run 'curate_and_validate_prices-0' for task 'curate_and_validate_prices'
23:11:24.718 | INFO    | Flow run 'beryl-armadillo' - Executing 'curate_and_validate_prices-0' immediately...
2025-12-22 23:11:24 | INFO     | flows.curate_data:curate_and_validate_prices:24 - Starting price curation for 2024-08-30
2025-12-22 23:11:24 | INFO     | curation.curate_prices:curate_daily_prices:52 - Reading 25 ticker files from /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq/2024/08/30
2025-12-22 23:11:24 | INFO     | curation.curate_prices:curate_daily_prices:70 - Combined 25 rows from 25 tickers
23:11:24.742 | ERROR   | Task run 'curate_and_validate_prices-0' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:24.751 | ERROR   | Task run 'curate_and_validate_prices-0' - Finished in state Failed('Task run encountered an exception TypeError: cannot safely cast non-equivalent float64 to int64')
23:11:24.751 | ERROR   | Flow run 'beryl-armadillo' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 864, in orchestrate_flow_run
    result = await flow_call.aresult()
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 87, in curate_data
    curate_and_validate_prices(run_date_str)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/tasks.py", line 569, in __call__
    return enter_task_run_engine(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1414, in enter_task_run_engine
    return from_sync.wait_for_call_in_loop_thread(begin_run)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/api.py", line 243, in wait_for_call_in_loop_thread
    return call.result()
           ^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 284, in result
    return self.future.result(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 168, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.14_1/Frameworks/Python.framework/Versions/3.11/lib/python3.11/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 355, in _run_async
    result = await coro
             ^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1582, in get_task_call_return_value
    return await future._result()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/futures.py", line 237, in _result
    return await final_state.result(raise_on_failure=raise_on_failure, fetch=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/states.py", line 91, in _get_state_result
    raise await get_state_exception(state)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:24.758 | ERROR   | Flow run 'beryl-armadillo' - Finished in state Failed('Flow run encountered an exception. TypeError: cannot safely cast non-equivalent float64 to int64')
2025-12-22 23:11:24 | ERROR    | __main__:backfill_data:114 - Failed to curate 2024-08-30: cannot safely cast non-equivalent float64 to int64
2025-12-22 23:11:24 | INFO     | __main__:backfill_data:110 - Curating date 2024-09-03 (21/85)
23:11:24.767 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/alembic/config.py:598: DeprecationWarning: No path_separator found in configuration; falling back to legacy splitting on spaces, commas, and colons for prepend_sys_path.  Consider adding path_separator=os to Alembic config.
  util.warn_deprecated(

23:11:24.783 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/pydantic/v2_validated_func.py:51: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  class DecoratorBaseModel(BaseModel):

23:11:24.784 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:157: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for name, field in self.model.__fields__.items()

23:11:24.784 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:160: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  non_var_fields = set(self.model.__fields__) - {self.v_args_name, self.v_kwargs_name}

23:11:24.784 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:536: PydanticDeprecatedSince20: The private method `_iter` will be removed and should no longer be used. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for k, v in model._iter()

23:11:24.784 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields_set__` attribute is deprecated, use `model_fields_set` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:24.785 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:24.793 | INFO    | prefect.engine - Created flow run 'brass-cormorant' for flow 'curate_data'
2025-12-22 23:11:24 | INFO     | flows.curate_data:curate_data:84 - Starting curation flow for 2024-09-03
23:11:24.808 | INFO    | Flow run 'brass-cormorant' - Created task run 'curate_and_validate_prices-0' for task 'curate_and_validate_prices'
23:11:24.808 | INFO    | Flow run 'brass-cormorant' - Executing 'curate_and_validate_prices-0' immediately...
2025-12-22 23:11:24 | INFO     | flows.curate_data:curate_and_validate_prices:24 - Starting price curation for 2024-09-03
2025-12-22 23:11:24 | INFO     | curation.curate_prices:curate_daily_prices:52 - Reading 25 ticker files from /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq/2024/09/03
2025-12-22 23:11:24 | INFO     | curation.curate_prices:curate_daily_prices:70 - Combined 25 rows from 25 tickers
23:11:24.832 | ERROR   | Task run 'curate_and_validate_prices-0' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:24.840 | ERROR   | Task run 'curate_and_validate_prices-0' - Finished in state Failed('Task run encountered an exception TypeError: cannot safely cast non-equivalent float64 to int64')
23:11:24.840 | ERROR   | Flow run 'brass-cormorant' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 864, in orchestrate_flow_run
    result = await flow_call.aresult()
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 87, in curate_data
    curate_and_validate_prices(run_date_str)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/tasks.py", line 569, in __call__
    return enter_task_run_engine(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1414, in enter_task_run_engine
    return from_sync.wait_for_call_in_loop_thread(begin_run)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/api.py", line 243, in wait_for_call_in_loop_thread
    return call.result()
           ^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 284, in result
    return self.future.result(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 168, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.14_1/Frameworks/Python.framework/Versions/3.11/lib/python3.11/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 355, in _run_async
    result = await coro
             ^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1582, in get_task_call_return_value
    return await future._result()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/futures.py", line 237, in _result
    return await final_state.result(raise_on_failure=raise_on_failure, fetch=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/states.py", line 91, in _get_state_result
    raise await get_state_exception(state)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:24.847 | ERROR   | Flow run 'brass-cormorant' - Finished in state Failed('Flow run encountered an exception. TypeError: cannot safely cast non-equivalent float64 to int64')
2025-12-22 23:11:24 | ERROR    | __main__:backfill_data:114 - Failed to curate 2024-09-03: cannot safely cast non-equivalent float64 to int64
2025-12-22 23:11:24 | INFO     | __main__:backfill_data:110 - Curating date 2024-09-04 (22/85)
23:11:24.856 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/alembic/config.py:598: DeprecationWarning: No path_separator found in configuration; falling back to legacy splitting on spaces, commas, and colons for prepend_sys_path.  Consider adding path_separator=os to Alembic config.
  util.warn_deprecated(

23:11:24.872 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/pydantic/v2_validated_func.py:51: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  class DecoratorBaseModel(BaseModel):

23:11:24.873 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:157: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for name, field in self.model.__fields__.items()

23:11:24.873 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:160: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  non_var_fields = set(self.model.__fields__) - {self.v_args_name, self.v_kwargs_name}

23:11:24.873 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:536: PydanticDeprecatedSince20: The private method `_iter` will be removed and should no longer be used. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for k, v in model._iter()

23:11:24.873 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields_set__` attribute is deprecated, use `model_fields_set` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:24.873 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:24.881 | INFO    | prefect.engine - Created flow run 'brawny-carp' for flow 'curate_data'
2025-12-22 23:11:24 | INFO     | flows.curate_data:curate_data:84 - Starting curation flow for 2024-09-04
23:11:24.894 | INFO    | Flow run 'brawny-carp' - Created task run 'curate_and_validate_prices-0' for task 'curate_and_validate_prices'
23:11:24.894 | INFO    | Flow run 'brawny-carp' - Executing 'curate_and_validate_prices-0' immediately...
2025-12-22 23:11:24 | INFO     | flows.curate_data:curate_and_validate_prices:24 - Starting price curation for 2024-09-04
2025-12-22 23:11:24 | INFO     | curation.curate_prices:curate_daily_prices:52 - Reading 25 ticker files from /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq/2024/09/04
2025-12-22 23:11:24 | INFO     | curation.curate_prices:curate_daily_prices:70 - Combined 25 rows from 25 tickers
23:11:24.918 | ERROR   | Task run 'curate_and_validate_prices-0' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:24.926 | ERROR   | Task run 'curate_and_validate_prices-0' - Finished in state Failed('Task run encountered an exception TypeError: cannot safely cast non-equivalent float64 to int64')
23:11:24.926 | ERROR   | Flow run 'brawny-carp' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 864, in orchestrate_flow_run
    result = await flow_call.aresult()
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 87, in curate_data
    curate_and_validate_prices(run_date_str)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/tasks.py", line 569, in __call__
    return enter_task_run_engine(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1414, in enter_task_run_engine
    return from_sync.wait_for_call_in_loop_thread(begin_run)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/api.py", line 243, in wait_for_call_in_loop_thread
    return call.result()
           ^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 284, in result
    return self.future.result(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 168, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.14_1/Frameworks/Python.framework/Versions/3.11/lib/python3.11/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 355, in _run_async
    result = await coro
             ^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1582, in get_task_call_return_value
    return await future._result()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/futures.py", line 237, in _result
    return await final_state.result(raise_on_failure=raise_on_failure, fetch=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/states.py", line 91, in _get_state_result
    raise await get_state_exception(state)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:24.933 | ERROR   | Flow run 'brawny-carp' - Finished in state Failed('Flow run encountered an exception. TypeError: cannot safely cast non-equivalent float64 to int64')
2025-12-22 23:11:24 | ERROR    | __main__:backfill_data:114 - Failed to curate 2024-09-04: cannot safely cast non-equivalent float64 to int64
2025-12-22 23:11:24 | INFO     | __main__:backfill_data:110 - Curating date 2024-09-05 (23/85)
23:11:24.942 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/alembic/config.py:598: DeprecationWarning: No path_separator found in configuration; falling back to legacy splitting on spaces, commas, and colons for prepend_sys_path.  Consider adding path_separator=os to Alembic config.
  util.warn_deprecated(

23:11:24.957 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/pydantic/v2_validated_func.py:51: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  class DecoratorBaseModel(BaseModel):

23:11:24.957 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:157: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for name, field in self.model.__fields__.items()

23:11:24.957 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:160: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  non_var_fields = set(self.model.__fields__) - {self.v_args_name, self.v_kwargs_name}

23:11:24.957 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:536: PydanticDeprecatedSince20: The private method `_iter` will be removed and should no longer be used. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for k, v in model._iter()

23:11:24.958 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields_set__` attribute is deprecated, use `model_fields_set` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:24.958 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:24.966 | INFO    | prefect.engine - Created flow run 'real-reindeer' for flow 'curate_data'
2025-12-22 23:11:24 | INFO     | flows.curate_data:curate_data:84 - Starting curation flow for 2024-09-05
23:11:24.979 | INFO    | Flow run 'real-reindeer' - Created task run 'curate_and_validate_prices-0' for task 'curate_and_validate_prices'
23:11:24.979 | INFO    | Flow run 'real-reindeer' - Executing 'curate_and_validate_prices-0' immediately...
2025-12-22 23:11:24 | INFO     | flows.curate_data:curate_and_validate_prices:24 - Starting price curation for 2024-09-05
2025-12-22 23:11:24 | INFO     | curation.curate_prices:curate_daily_prices:52 - Reading 25 ticker files from /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq/2024/09/05
2025-12-22 23:11:25 | INFO     | curation.curate_prices:curate_daily_prices:70 - Combined 25 rows from 25 tickers
23:11:25.003 | ERROR   | Task run 'curate_and_validate_prices-0' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:25.010 | ERROR   | Task run 'curate_and_validate_prices-0' - Finished in state Failed('Task run encountered an exception TypeError: cannot safely cast non-equivalent float64 to int64')
23:11:25.011 | ERROR   | Flow run 'real-reindeer' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 864, in orchestrate_flow_run
    result = await flow_call.aresult()
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 87, in curate_data
    curate_and_validate_prices(run_date_str)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/tasks.py", line 569, in __call__
    return enter_task_run_engine(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1414, in enter_task_run_engine
    return from_sync.wait_for_call_in_loop_thread(begin_run)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/api.py", line 243, in wait_for_call_in_loop_thread
    return call.result()
           ^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 284, in result
    return self.future.result(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 168, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.14_1/Frameworks/Python.framework/Versions/3.11/lib/python3.11/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 355, in _run_async
    result = await coro
             ^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1582, in get_task_call_return_value
    return await future._result()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/futures.py", line 237, in _result
    return await final_state.result(raise_on_failure=raise_on_failure, fetch=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/states.py", line 91, in _get_state_result
    raise await get_state_exception(state)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:25.019 | ERROR   | Flow run 'real-reindeer' - Finished in state Failed('Flow run encountered an exception. TypeError: cannot safely cast non-equivalent float64 to int64')
2025-12-22 23:11:25 | ERROR    | __main__:backfill_data:114 - Failed to curate 2024-09-05: cannot safely cast non-equivalent float64 to int64
2025-12-22 23:11:25 | INFO     | __main__:backfill_data:110 - Curating date 2024-09-06 (24/85)
23:11:25.028 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/alembic/config.py:598: DeprecationWarning: No path_separator found in configuration; falling back to legacy splitting on spaces, commas, and colons for prepend_sys_path.  Consider adding path_separator=os to Alembic config.
  util.warn_deprecated(

23:11:25.042 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/pydantic/v2_validated_func.py:51: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  class DecoratorBaseModel(BaseModel):

23:11:25.043 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:157: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for name, field in self.model.__fields__.items()

23:11:25.043 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:160: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  non_var_fields = set(self.model.__fields__) - {self.v_args_name, self.v_kwargs_name}

23:11:25.043 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:536: PydanticDeprecatedSince20: The private method `_iter` will be removed and should no longer be used. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for k, v in model._iter()

23:11:25.043 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields_set__` attribute is deprecated, use `model_fields_set` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:25.043 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:25.052 | INFO    | prefect.engine - Created flow run 'defiant-parakeet' for flow 'curate_data'
2025-12-22 23:11:25 | INFO     | flows.curate_data:curate_data:84 - Starting curation flow for 2024-09-06
23:11:25.065 | INFO    | Flow run 'defiant-parakeet' - Created task run 'curate_and_validate_prices-0' for task 'curate_and_validate_prices'
23:11:25.065 | INFO    | Flow run 'defiant-parakeet' - Executing 'curate_and_validate_prices-0' immediately...
2025-12-22 23:11:25 | INFO     | flows.curate_data:curate_and_validate_prices:24 - Starting price curation for 2024-09-06
2025-12-22 23:11:25 | INFO     | curation.curate_prices:curate_daily_prices:52 - Reading 25 ticker files from /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq/2024/09/06
2025-12-22 23:11:25 | INFO     | curation.curate_prices:curate_daily_prices:70 - Combined 25 rows from 25 tickers
23:11:25.089 | ERROR   | Task run 'curate_and_validate_prices-0' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:25.096 | ERROR   | Task run 'curate_and_validate_prices-0' - Finished in state Failed('Task run encountered an exception TypeError: cannot safely cast non-equivalent float64 to int64')
23:11:25.097 | ERROR   | Flow run 'defiant-parakeet' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 864, in orchestrate_flow_run
    result = await flow_call.aresult()
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 87, in curate_data
    curate_and_validate_prices(run_date_str)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/tasks.py", line 569, in __call__
    return enter_task_run_engine(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1414, in enter_task_run_engine
    return from_sync.wait_for_call_in_loop_thread(begin_run)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/api.py", line 243, in wait_for_call_in_loop_thread
    return call.result()
           ^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 284, in result
    return self.future.result(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 168, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.14_1/Frameworks/Python.framework/Versions/3.11/lib/python3.11/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 355, in _run_async
    result = await coro
             ^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1582, in get_task_call_return_value
    return await future._result()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/futures.py", line 237, in _result
    return await final_state.result(raise_on_failure=raise_on_failure, fetch=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/states.py", line 91, in _get_state_result
    raise await get_state_exception(state)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:25.104 | ERROR   | Flow run 'defiant-parakeet' - Finished in state Failed('Flow run encountered an exception. TypeError: cannot safely cast non-equivalent float64 to int64')
2025-12-22 23:11:25 | ERROR    | __main__:backfill_data:114 - Failed to curate 2024-09-06: cannot safely cast non-equivalent float64 to int64
2025-12-22 23:11:25 | INFO     | __main__:backfill_data:110 - Curating date 2024-09-09 (25/85)
23:11:25.113 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/alembic/config.py:598: DeprecationWarning: No path_separator found in configuration; falling back to legacy splitting on spaces, commas, and colons for prepend_sys_path.  Consider adding path_separator=os to Alembic config.
  util.warn_deprecated(

23:11:25.128 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/pydantic/v2_validated_func.py:51: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  class DecoratorBaseModel(BaseModel):

23:11:25.129 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:157: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for name, field in self.model.__fields__.items()

23:11:25.129 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:160: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  non_var_fields = set(self.model.__fields__) - {self.v_args_name, self.v_kwargs_name}

23:11:25.129 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:536: PydanticDeprecatedSince20: The private method `_iter` will be removed and should no longer be used. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for k, v in model._iter()

23:11:25.129 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields_set__` attribute is deprecated, use `model_fields_set` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:25.129 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:25.271 | INFO    | prefect.engine - Created flow run 'rich-pegasus' for flow 'curate_data'
2025-12-22 23:11:25 | INFO     | flows.curate_data:curate_data:84 - Starting curation flow for 2024-09-09
23:11:25.283 | INFO    | Flow run 'rich-pegasus' - Created task run 'curate_and_validate_prices-0' for task 'curate_and_validate_prices'
23:11:25.283 | INFO    | Flow run 'rich-pegasus' - Executing 'curate_and_validate_prices-0' immediately...
2025-12-22 23:11:25 | INFO     | flows.curate_data:curate_and_validate_prices:24 - Starting price curation for 2024-09-09
2025-12-22 23:11:25 | INFO     | curation.curate_prices:curate_daily_prices:52 - Reading 25 ticker files from /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq/2024/09/09
2025-12-22 23:11:25 | INFO     | curation.curate_prices:curate_daily_prices:70 - Combined 25 rows from 25 tickers
23:11:25.306 | ERROR   | Task run 'curate_and_validate_prices-0' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:25.315 | ERROR   | Task run 'curate_and_validate_prices-0' - Finished in state Failed('Task run encountered an exception TypeError: cannot safely cast non-equivalent float64 to int64')
23:11:25.315 | ERROR   | Flow run 'rich-pegasus' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 864, in orchestrate_flow_run
    result = await flow_call.aresult()
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 87, in curate_data
    curate_and_validate_prices(run_date_str)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/tasks.py", line 569, in __call__
    return enter_task_run_engine(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1414, in enter_task_run_engine
    return from_sync.wait_for_call_in_loop_thread(begin_run)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/api.py", line 243, in wait_for_call_in_loop_thread
    return call.result()
           ^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 284, in result
    return self.future.result(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 168, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.14_1/Frameworks/Python.framework/Versions/3.11/lib/python3.11/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 355, in _run_async
    result = await coro
             ^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1582, in get_task_call_return_value
    return await future._result()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/futures.py", line 237, in _result
    return await final_state.result(raise_on_failure=raise_on_failure, fetch=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/states.py", line 91, in _get_state_result
    raise await get_state_exception(state)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:25.323 | ERROR   | Flow run 'rich-pegasus' - Finished in state Failed('Flow run encountered an exception. TypeError: cannot safely cast non-equivalent float64 to int64')
2025-12-22 23:11:25 | ERROR    | __main__:backfill_data:114 - Failed to curate 2024-09-09: cannot safely cast non-equivalent float64 to int64
2025-12-22 23:11:25 | INFO     | __main__:backfill_data:110 - Curating date 2024-09-10 (26/85)
23:11:25.331 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/alembic/config.py:598: DeprecationWarning: No path_separator found in configuration; falling back to legacy splitting on spaces, commas, and colons for prepend_sys_path.  Consider adding path_separator=os to Alembic config.
  util.warn_deprecated(

23:11:25.346 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/pydantic/v2_validated_func.py:51: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  class DecoratorBaseModel(BaseModel):

23:11:25.347 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:157: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for name, field in self.model.__fields__.items()

23:11:25.347 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:160: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  non_var_fields = set(self.model.__fields__) - {self.v_args_name, self.v_kwargs_name}

23:11:25.347 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:536: PydanticDeprecatedSince20: The private method `_iter` will be removed and should no longer be used. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for k, v in model._iter()

23:11:25.347 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields_set__` attribute is deprecated, use `model_fields_set` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:25.347 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:25.356 | INFO    | prefect.engine - Created flow run 'almond-rhino' for flow 'curate_data'
2025-12-22 23:11:25 | INFO     | flows.curate_data:curate_data:84 - Starting curation flow for 2024-09-10
23:11:25.369 | INFO    | Flow run 'almond-rhino' - Created task run 'curate_and_validate_prices-0' for task 'curate_and_validate_prices'
23:11:25.369 | INFO    | Flow run 'almond-rhino' - Executing 'curate_and_validate_prices-0' immediately...
2025-12-22 23:11:25 | INFO     | flows.curate_data:curate_and_validate_prices:24 - Starting price curation for 2024-09-10
2025-12-22 23:11:25 | INFO     | curation.curate_prices:curate_daily_prices:52 - Reading 25 ticker files from /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq/2024/09/10
2025-12-22 23:11:25 | INFO     | curation.curate_prices:curate_daily_prices:70 - Combined 25 rows from 25 tickers
23:11:25.394 | ERROR   | Task run 'curate_and_validate_prices-0' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:25.402 | ERROR   | Task run 'curate_and_validate_prices-0' - Finished in state Failed('Task run encountered an exception TypeError: cannot safely cast non-equivalent float64 to int64')
23:11:25.402 | ERROR   | Flow run 'almond-rhino' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 864, in orchestrate_flow_run
    result = await flow_call.aresult()
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 87, in curate_data
    curate_and_validate_prices(run_date_str)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/tasks.py", line 569, in __call__
    return enter_task_run_engine(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1414, in enter_task_run_engine
    return from_sync.wait_for_call_in_loop_thread(begin_run)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/api.py", line 243, in wait_for_call_in_loop_thread
    return call.result()
           ^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 284, in result
    return self.future.result(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 168, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.14_1/Frameworks/Python.framework/Versions/3.11/lib/python3.11/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 355, in _run_async
    result = await coro
             ^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1582, in get_task_call_return_value
    return await future._result()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/futures.py", line 237, in _result
    return await final_state.result(raise_on_failure=raise_on_failure, fetch=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/states.py", line 91, in _get_state_result
    raise await get_state_exception(state)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:25.409 | ERROR   | Flow run 'almond-rhino' - Finished in state Failed('Flow run encountered an exception. TypeError: cannot safely cast non-equivalent float64 to int64')
2025-12-22 23:11:25 | ERROR    | __main__:backfill_data:114 - Failed to curate 2024-09-10: cannot safely cast non-equivalent float64 to int64
2025-12-22 23:11:25 | INFO     | __main__:backfill_data:110 - Curating date 2024-09-11 (27/85)
23:11:25.418 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/alembic/config.py:598: DeprecationWarning: No path_separator found in configuration; falling back to legacy splitting on spaces, commas, and colons for prepend_sys_path.  Consider adding path_separator=os to Alembic config.
  util.warn_deprecated(

23:11:25.433 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/pydantic/v2_validated_func.py:51: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  class DecoratorBaseModel(BaseModel):

23:11:25.434 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:157: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for name, field in self.model.__fields__.items()

23:11:25.434 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:160: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  non_var_fields = set(self.model.__fields__) - {self.v_args_name, self.v_kwargs_name}

23:11:25.434 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:536: PydanticDeprecatedSince20: The private method `_iter` will be removed and should no longer be used. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for k, v in model._iter()

23:11:25.434 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields_set__` attribute is deprecated, use `model_fields_set` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:25.435 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:25.443 | INFO    | prefect.engine - Created flow run 'discerning-frog' for flow 'curate_data'
2025-12-22 23:11:25 | INFO     | flows.curate_data:curate_data:84 - Starting curation flow for 2024-09-11
23:11:25.455 | INFO    | Flow run 'discerning-frog' - Created task run 'curate_and_validate_prices-0' for task 'curate_and_validate_prices'
23:11:25.455 | INFO    | Flow run 'discerning-frog' - Executing 'curate_and_validate_prices-0' immediately...
2025-12-22 23:11:25 | INFO     | flows.curate_data:curate_and_validate_prices:24 - Starting price curation for 2024-09-11
2025-12-22 23:11:25 | INFO     | curation.curate_prices:curate_daily_prices:52 - Reading 25 ticker files from /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq/2024/09/11
2025-12-22 23:11:25 | INFO     | curation.curate_prices:curate_daily_prices:70 - Combined 25 rows from 25 tickers
23:11:25.480 | ERROR   | Task run 'curate_and_validate_prices-0' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:25.489 | ERROR   | Task run 'curate_and_validate_prices-0' - Finished in state Failed('Task run encountered an exception TypeError: cannot safely cast non-equivalent float64 to int64')
23:11:25.489 | ERROR   | Flow run 'discerning-frog' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 864, in orchestrate_flow_run
    result = await flow_call.aresult()
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 87, in curate_data
    curate_and_validate_prices(run_date_str)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/tasks.py", line 569, in __call__
    return enter_task_run_engine(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1414, in enter_task_run_engine
    return from_sync.wait_for_call_in_loop_thread(begin_run)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/api.py", line 243, in wait_for_call_in_loop_thread
    return call.result()
           ^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 284, in result
    return self.future.result(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 168, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.14_1/Frameworks/Python.framework/Versions/3.11/lib/python3.11/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 355, in _run_async
    result = await coro
             ^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1582, in get_task_call_return_value
    return await future._result()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/futures.py", line 237, in _result
    return await final_state.result(raise_on_failure=raise_on_failure, fetch=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/states.py", line 91, in _get_state_result
    raise await get_state_exception(state)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:25.497 | ERROR   | Flow run 'discerning-frog' - Finished in state Failed('Flow run encountered an exception. TypeError: cannot safely cast non-equivalent float64 to int64')
2025-12-22 23:11:25 | ERROR    | __main__:backfill_data:114 - Failed to curate 2024-09-11: cannot safely cast non-equivalent float64 to int64
2025-12-22 23:11:25 | INFO     | __main__:backfill_data:110 - Curating date 2024-09-12 (28/85)
23:11:25.505 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/alembic/config.py:598: DeprecationWarning: No path_separator found in configuration; falling back to legacy splitting on spaces, commas, and colons for prepend_sys_path.  Consider adding path_separator=os to Alembic config.
  util.warn_deprecated(

23:11:25.520 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/pydantic/v2_validated_func.py:51: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  class DecoratorBaseModel(BaseModel):

23:11:25.521 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:157: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for name, field in self.model.__fields__.items()

23:11:25.521 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:160: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  non_var_fields = set(self.model.__fields__) - {self.v_args_name, self.v_kwargs_name}

23:11:25.521 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:536: PydanticDeprecatedSince20: The private method `_iter` will be removed and should no longer be used. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for k, v in model._iter()

23:11:25.521 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields_set__` attribute is deprecated, use `model_fields_set` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:25.521 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:25.531 | INFO    | prefect.engine - Created flow run 'portable-asp' for flow 'curate_data'
2025-12-22 23:11:25 | INFO     | flows.curate_data:curate_data:84 - Starting curation flow for 2024-09-12
23:11:25.543 | INFO    | Flow run 'portable-asp' - Created task run 'curate_and_validate_prices-0' for task 'curate_and_validate_prices'
23:11:25.543 | INFO    | Flow run 'portable-asp' - Executing 'curate_and_validate_prices-0' immediately...
2025-12-22 23:11:25 | INFO     | flows.curate_data:curate_and_validate_prices:24 - Starting price curation for 2024-09-12
2025-12-22 23:11:25 | INFO     | curation.curate_prices:curate_daily_prices:52 - Reading 25 ticker files from /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq/2024/09/12
2025-12-22 23:11:25 | INFO     | curation.curate_prices:curate_daily_prices:70 - Combined 25 rows from 25 tickers
23:11:25.567 | ERROR   | Task run 'curate_and_validate_prices-0' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:25.575 | ERROR   | Task run 'curate_and_validate_prices-0' - Finished in state Failed('Task run encountered an exception TypeError: cannot safely cast non-equivalent float64 to int64')
23:11:25.575 | ERROR   | Flow run 'portable-asp' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 864, in orchestrate_flow_run
    result = await flow_call.aresult()
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 87, in curate_data
    curate_and_validate_prices(run_date_str)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/tasks.py", line 569, in __call__
    return enter_task_run_engine(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1414, in enter_task_run_engine
    return from_sync.wait_for_call_in_loop_thread(begin_run)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/api.py", line 243, in wait_for_call_in_loop_thread
    return call.result()
           ^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 284, in result
    return self.future.result(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 168, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.14_1/Frameworks/Python.framework/Versions/3.11/lib/python3.11/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 355, in _run_async
    result = await coro
             ^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1582, in get_task_call_return_value
    return await future._result()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/futures.py", line 237, in _result
    return await final_state.result(raise_on_failure=raise_on_failure, fetch=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/states.py", line 91, in _get_state_result
    raise await get_state_exception(state)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:25.583 | ERROR   | Flow run 'portable-asp' - Finished in state Failed('Flow run encountered an exception. TypeError: cannot safely cast non-equivalent float64 to int64')
2025-12-22 23:11:25 | ERROR    | __main__:backfill_data:114 - Failed to curate 2024-09-12: cannot safely cast non-equivalent float64 to int64
2025-12-22 23:11:25 | INFO     | __main__:backfill_data:110 - Curating date 2024-09-13 (29/85)
23:11:25.592 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/alembic/config.py:598: DeprecationWarning: No path_separator found in configuration; falling back to legacy splitting on spaces, commas, and colons for prepend_sys_path.  Consider adding path_separator=os to Alembic config.
  util.warn_deprecated(

23:11:25.607 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/pydantic/v2_validated_func.py:51: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  class DecoratorBaseModel(BaseModel):

23:11:25.608 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:157: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for name, field in self.model.__fields__.items()

23:11:25.608 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:160: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  non_var_fields = set(self.model.__fields__) - {self.v_args_name, self.v_kwargs_name}

23:11:25.608 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:536: PydanticDeprecatedSince20: The private method `_iter` will be removed and should no longer be used. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for k, v in model._iter()

23:11:25.608 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields_set__` attribute is deprecated, use `model_fields_set` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:25.608 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:25.617 | INFO    | prefect.engine - Created flow run 'real-goldfish' for flow 'curate_data'
2025-12-22 23:11:25 | INFO     | flows.curate_data:curate_data:84 - Starting curation flow for 2024-09-13
23:11:25.630 | INFO    | Flow run 'real-goldfish' - Created task run 'curate_and_validate_prices-0' for task 'curate_and_validate_prices'
23:11:25.630 | INFO    | Flow run 'real-goldfish' - Executing 'curate_and_validate_prices-0' immediately...
2025-12-22 23:11:25 | INFO     | flows.curate_data:curate_and_validate_prices:24 - Starting price curation for 2024-09-13
2025-12-22 23:11:25 | INFO     | curation.curate_prices:curate_daily_prices:52 - Reading 25 ticker files from /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq/2024/09/13
2025-12-22 23:11:25 | INFO     | curation.curate_prices:curate_daily_prices:70 - Combined 25 rows from 25 tickers
23:11:25.654 | ERROR   | Task run 'curate_and_validate_prices-0' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:25.662 | ERROR   | Task run 'curate_and_validate_prices-0' - Finished in state Failed('Task run encountered an exception TypeError: cannot safely cast non-equivalent float64 to int64')
23:11:25.662 | ERROR   | Flow run 'real-goldfish' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 864, in orchestrate_flow_run
    result = await flow_call.aresult()
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 87, in curate_data
    curate_and_validate_prices(run_date_str)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/tasks.py", line 569, in __call__
    return enter_task_run_engine(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1414, in enter_task_run_engine
    return from_sync.wait_for_call_in_loop_thread(begin_run)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/api.py", line 243, in wait_for_call_in_loop_thread
    return call.result()
           ^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 284, in result
    return self.future.result(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 168, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.14_1/Frameworks/Python.framework/Versions/3.11/lib/python3.11/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 355, in _run_async
    result = await coro
             ^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1582, in get_task_call_return_value
    return await future._result()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/futures.py", line 237, in _result
    return await final_state.result(raise_on_failure=raise_on_failure, fetch=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/states.py", line 91, in _get_state_result
    raise await get_state_exception(state)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:25.670 | ERROR   | Flow run 'real-goldfish' - Finished in state Failed('Flow run encountered an exception. TypeError: cannot safely cast non-equivalent float64 to int64')
2025-12-22 23:11:25 | ERROR    | __main__:backfill_data:114 - Failed to curate 2024-09-13: cannot safely cast non-equivalent float64 to int64
2025-12-22 23:11:25 | INFO     | __main__:backfill_data:110 - Curating date 2024-09-16 (30/85)
23:11:25.679 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/alembic/config.py:598: DeprecationWarning: No path_separator found in configuration; falling back to legacy splitting on spaces, commas, and colons for prepend_sys_path.  Consider adding path_separator=os to Alembic config.
  util.warn_deprecated(

23:11:25.694 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/pydantic/v2_validated_func.py:51: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  class DecoratorBaseModel(BaseModel):

23:11:25.695 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:157: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for name, field in self.model.__fields__.items()

23:11:25.695 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:160: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  non_var_fields = set(self.model.__fields__) - {self.v_args_name, self.v_kwargs_name}

23:11:25.695 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:536: PydanticDeprecatedSince20: The private method `_iter` will be removed and should no longer be used. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for k, v in model._iter()

23:11:25.695 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields_set__` attribute is deprecated, use `model_fields_set` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:25.696 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:25.704 | INFO    | prefect.engine - Created flow run 'nifty-manatee' for flow 'curate_data'
2025-12-22 23:11:25 | INFO     | flows.curate_data:curate_data:84 - Starting curation flow for 2024-09-16
23:11:25.717 | INFO    | Flow run 'nifty-manatee' - Created task run 'curate_and_validate_prices-0' for task 'curate_and_validate_prices'
23:11:25.717 | INFO    | Flow run 'nifty-manatee' - Executing 'curate_and_validate_prices-0' immediately...
2025-12-22 23:11:25 | INFO     | flows.curate_data:curate_and_validate_prices:24 - Starting price curation for 2024-09-16
2025-12-22 23:11:25 | INFO     | curation.curate_prices:curate_daily_prices:52 - Reading 25 ticker files from /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq/2024/09/16
2025-12-22 23:11:25 | INFO     | curation.curate_prices:curate_daily_prices:70 - Combined 25 rows from 25 tickers
23:11:25.741 | ERROR   | Task run 'curate_and_validate_prices-0' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:25.749 | ERROR   | Task run 'curate_and_validate_prices-0' - Finished in state Failed('Task run encountered an exception TypeError: cannot safely cast non-equivalent float64 to int64')
23:11:25.749 | ERROR   | Flow run 'nifty-manatee' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 864, in orchestrate_flow_run
    result = await flow_call.aresult()
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 87, in curate_data
    curate_and_validate_prices(run_date_str)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/tasks.py", line 569, in __call__
    return enter_task_run_engine(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1414, in enter_task_run_engine
    return from_sync.wait_for_call_in_loop_thread(begin_run)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/api.py", line 243, in wait_for_call_in_loop_thread
    return call.result()
           ^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 284, in result
    return self.future.result(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 168, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.14_1/Frameworks/Python.framework/Versions/3.11/lib/python3.11/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 355, in _run_async
    result = await coro
             ^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1582, in get_task_call_return_value
    return await future._result()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/futures.py", line 237, in _result
    return await final_state.result(raise_on_failure=raise_on_failure, fetch=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/states.py", line 91, in _get_state_result
    raise await get_state_exception(state)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:25.758 | ERROR   | Flow run 'nifty-manatee' - Finished in state Failed('Flow run encountered an exception. TypeError: cannot safely cast non-equivalent float64 to int64')
2025-12-22 23:11:25 | ERROR    | __main__:backfill_data:114 - Failed to curate 2024-09-16: cannot safely cast non-equivalent float64 to int64
2025-12-22 23:11:25 | INFO     | __main__:backfill_data:110 - Curating date 2024-09-17 (31/85)
23:11:25.766 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/alembic/config.py:598: DeprecationWarning: No path_separator found in configuration; falling back to legacy splitting on spaces, commas, and colons for prepend_sys_path.  Consider adding path_separator=os to Alembic config.
  util.warn_deprecated(

23:11:25.782 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/pydantic/v2_validated_func.py:51: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  class DecoratorBaseModel(BaseModel):

23:11:25.782 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:157: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for name, field in self.model.__fields__.items()

23:11:25.782 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:160: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  non_var_fields = set(self.model.__fields__) - {self.v_args_name, self.v_kwargs_name}

23:11:25.782 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:536: PydanticDeprecatedSince20: The private method `_iter` will be removed and should no longer be used. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for k, v in model._iter()

23:11:25.782 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields_set__` attribute is deprecated, use `model_fields_set` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:25.783 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:25.791 | INFO    | prefect.engine - Created flow run 'rapid-rhino' for flow 'curate_data'
2025-12-22 23:11:25 | INFO     | flows.curate_data:curate_data:84 - Starting curation flow for 2024-09-17
23:11:25.803 | INFO    | Flow run 'rapid-rhino' - Created task run 'curate_and_validate_prices-0' for task 'curate_and_validate_prices'
23:11:25.804 | INFO    | Flow run 'rapid-rhino' - Executing 'curate_and_validate_prices-0' immediately...
2025-12-22 23:11:25 | INFO     | flows.curate_data:curate_and_validate_prices:24 - Starting price curation for 2024-09-17
2025-12-22 23:11:25 | INFO     | curation.curate_prices:curate_daily_prices:52 - Reading 25 ticker files from /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq/2024/09/17
2025-12-22 23:11:25 | INFO     | curation.curate_prices:curate_daily_prices:70 - Combined 25 rows from 25 tickers
23:11:25.830 | ERROR   | Task run 'curate_and_validate_prices-0' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:25.838 | ERROR   | Task run 'curate_and_validate_prices-0' - Finished in state Failed('Task run encountered an exception TypeError: cannot safely cast non-equivalent float64 to int64')
23:11:25.838 | ERROR   | Flow run 'rapid-rhino' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 864, in orchestrate_flow_run
    result = await flow_call.aresult()
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 87, in curate_data
    curate_and_validate_prices(run_date_str)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/tasks.py", line 569, in __call__
    return enter_task_run_engine(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1414, in enter_task_run_engine
    return from_sync.wait_for_call_in_loop_thread(begin_run)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/api.py", line 243, in wait_for_call_in_loop_thread
    return call.result()
           ^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 284, in result
    return self.future.result(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 168, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.14_1/Frameworks/Python.framework/Versions/3.11/lib/python3.11/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 355, in _run_async
    result = await coro
             ^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1582, in get_task_call_return_value
    return await future._result()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/futures.py", line 237, in _result
    return await final_state.result(raise_on_failure=raise_on_failure, fetch=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/states.py", line 91, in _get_state_result
    raise await get_state_exception(state)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:25.845 | ERROR   | Flow run 'rapid-rhino' - Finished in state Failed('Flow run encountered an exception. TypeError: cannot safely cast non-equivalent float64 to int64')
2025-12-22 23:11:25 | ERROR    | __main__:backfill_data:114 - Failed to curate 2024-09-17: cannot safely cast non-equivalent float64 to int64
2025-12-22 23:11:25 | INFO     | __main__:backfill_data:110 - Curating date 2024-09-18 (32/85)
23:11:25.854 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/alembic/config.py:598: DeprecationWarning: No path_separator found in configuration; falling back to legacy splitting on spaces, commas, and colons for prepend_sys_path.  Consider adding path_separator=os to Alembic config.
  util.warn_deprecated(

23:11:25.869 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/pydantic/v2_validated_func.py:51: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  class DecoratorBaseModel(BaseModel):

23:11:25.870 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:157: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for name, field in self.model.__fields__.items()

23:11:25.870 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:160: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  non_var_fields = set(self.model.__fields__) - {self.v_args_name, self.v_kwargs_name}

23:11:25.870 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:536: PydanticDeprecatedSince20: The private method `_iter` will be removed and should no longer be used. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for k, v in model._iter()

23:11:25.870 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields_set__` attribute is deprecated, use `model_fields_set` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:25.870 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:25.879 | INFO    | prefect.engine - Created flow run 'magnetic-mastodon' for flow 'curate_data'
2025-12-22 23:11:25 | INFO     | flows.curate_data:curate_data:84 - Starting curation flow for 2024-09-18
23:11:25.891 | INFO    | Flow run 'magnetic-mastodon' - Created task run 'curate_and_validate_prices-0' for task 'curate_and_validate_prices'
23:11:25.891 | INFO    | Flow run 'magnetic-mastodon' - Executing 'curate_and_validate_prices-0' immediately...
2025-12-22 23:11:25 | INFO     | flows.curate_data:curate_and_validate_prices:24 - Starting price curation for 2024-09-18
2025-12-22 23:11:25 | INFO     | curation.curate_prices:curate_daily_prices:52 - Reading 25 ticker files from /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq/2024/09/18
2025-12-22 23:11:25 | INFO     | curation.curate_prices:curate_daily_prices:70 - Combined 25 rows from 25 tickers
23:11:25.915 | ERROR   | Task run 'curate_and_validate_prices-0' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:25.923 | ERROR   | Task run 'curate_and_validate_prices-0' - Finished in state Failed('Task run encountered an exception TypeError: cannot safely cast non-equivalent float64 to int64')
23:11:25.923 | ERROR   | Flow run 'magnetic-mastodon' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 864, in orchestrate_flow_run
    result = await flow_call.aresult()
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 87, in curate_data
    curate_and_validate_prices(run_date_str)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/tasks.py", line 569, in __call__
    return enter_task_run_engine(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1414, in enter_task_run_engine
    return from_sync.wait_for_call_in_loop_thread(begin_run)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/api.py", line 243, in wait_for_call_in_loop_thread
    return call.result()
           ^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 284, in result
    return self.future.result(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 168, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.14_1/Frameworks/Python.framework/Versions/3.11/lib/python3.11/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 355, in _run_async
    result = await coro
             ^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1582, in get_task_call_return_value
    return await future._result()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/futures.py", line 237, in _result
    return await final_state.result(raise_on_failure=raise_on_failure, fetch=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/states.py", line 91, in _get_state_result
    raise await get_state_exception(state)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:25.930 | ERROR   | Flow run 'magnetic-mastodon' - Finished in state Failed('Flow run encountered an exception. TypeError: cannot safely cast non-equivalent float64 to int64')
2025-12-22 23:11:25 | ERROR    | __main__:backfill_data:114 - Failed to curate 2024-09-18: cannot safely cast non-equivalent float64 to int64
2025-12-22 23:11:25 | INFO     | __main__:backfill_data:110 - Curating date 2024-09-19 (33/85)
23:11:25.939 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/alembic/config.py:598: DeprecationWarning: No path_separator found in configuration; falling back to legacy splitting on spaces, commas, and colons for prepend_sys_path.  Consider adding path_separator=os to Alembic config.
  util.warn_deprecated(

23:11:25.954 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/pydantic/v2_validated_func.py:51: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  class DecoratorBaseModel(BaseModel):

23:11:25.955 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:157: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for name, field in self.model.__fields__.items()

23:11:25.955 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:160: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  non_var_fields = set(self.model.__fields__) - {self.v_args_name, self.v_kwargs_name}

23:11:25.955 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:536: PydanticDeprecatedSince20: The private method `_iter` will be removed and should no longer be used. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for k, v in model._iter()

23:11:25.955 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields_set__` attribute is deprecated, use `model_fields_set` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:25.955 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:25.963 | INFO    | prefect.engine - Created flow run 'shaggy-labrador' for flow 'curate_data'
2025-12-22 23:11:25 | INFO     | flows.curate_data:curate_data:84 - Starting curation flow for 2024-09-19
23:11:25.975 | INFO    | Flow run 'shaggy-labrador' - Created task run 'curate_and_validate_prices-0' for task 'curate_and_validate_prices'
23:11:25.976 | INFO    | Flow run 'shaggy-labrador' - Executing 'curate_and_validate_prices-0' immediately...
2025-12-22 23:11:25 | INFO     | flows.curate_data:curate_and_validate_prices:24 - Starting price curation for 2024-09-19
2025-12-22 23:11:25 | INFO     | curation.curate_prices:curate_daily_prices:52 - Reading 25 ticker files from /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq/2024/09/19
2025-12-22 23:11:26 | INFO     | curation.curate_prices:curate_daily_prices:70 - Combined 25 rows from 25 tickers
23:11:26.000 | ERROR   | Task run 'curate_and_validate_prices-0' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:26.008 | ERROR   | Task run 'curate_and_validate_prices-0' - Finished in state Failed('Task run encountered an exception TypeError: cannot safely cast non-equivalent float64 to int64')
23:11:26.009 | ERROR   | Flow run 'shaggy-labrador' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 864, in orchestrate_flow_run
    result = await flow_call.aresult()
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 87, in curate_data
    curate_and_validate_prices(run_date_str)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/tasks.py", line 569, in __call__
    return enter_task_run_engine(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1414, in enter_task_run_engine
    return from_sync.wait_for_call_in_loop_thread(begin_run)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/api.py", line 243, in wait_for_call_in_loop_thread
    return call.result()
           ^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 284, in result
    return self.future.result(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 168, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.14_1/Frameworks/Python.framework/Versions/3.11/lib/python3.11/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 355, in _run_async
    result = await coro
             ^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1582, in get_task_call_return_value
    return await future._result()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/futures.py", line 237, in _result
    return await final_state.result(raise_on_failure=raise_on_failure, fetch=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/states.py", line 91, in _get_state_result
    raise await get_state_exception(state)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:26.016 | ERROR   | Flow run 'shaggy-labrador' - Finished in state Failed('Flow run encountered an exception. TypeError: cannot safely cast non-equivalent float64 to int64')
2025-12-22 23:11:26 | ERROR    | __main__:backfill_data:114 - Failed to curate 2024-09-19: cannot safely cast non-equivalent float64 to int64
2025-12-22 23:11:26 | INFO     | __main__:backfill_data:110 - Curating date 2024-09-20 (34/85)
23:11:26.025 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/alembic/config.py:598: DeprecationWarning: No path_separator found in configuration; falling back to legacy splitting on spaces, commas, and colons for prepend_sys_path.  Consider adding path_separator=os to Alembic config.
  util.warn_deprecated(

23:11:26.040 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/pydantic/v2_validated_func.py:51: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  class DecoratorBaseModel(BaseModel):

23:11:26.041 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:157: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for name, field in self.model.__fields__.items()

23:11:26.041 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:160: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  non_var_fields = set(self.model.__fields__) - {self.v_args_name, self.v_kwargs_name}

23:11:26.041 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:536: PydanticDeprecatedSince20: The private method `_iter` will be removed and should no longer be used. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for k, v in model._iter()

23:11:26.041 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields_set__` attribute is deprecated, use `model_fields_set` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:26.041 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:26.050 | INFO    | prefect.engine - Created flow run 'classy-guillemot' for flow 'curate_data'
2025-12-22 23:11:26 | INFO     | flows.curate_data:curate_data:84 - Starting curation flow for 2024-09-20
23:11:26.062 | INFO    | Flow run 'classy-guillemot' - Created task run 'curate_and_validate_prices-0' for task 'curate_and_validate_prices'
23:11:26.062 | INFO    | Flow run 'classy-guillemot' - Executing 'curate_and_validate_prices-0' immediately...
2025-12-22 23:11:26 | INFO     | flows.curate_data:curate_and_validate_prices:24 - Starting price curation for 2024-09-20
2025-12-22 23:11:26 | INFO     | curation.curate_prices:curate_daily_prices:52 - Reading 25 ticker files from /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq/2024/09/20
2025-12-22 23:11:26 | INFO     | curation.curate_prices:curate_daily_prices:70 - Combined 25 rows from 25 tickers
23:11:26.088 | ERROR   | Task run 'curate_and_validate_prices-0' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:26.095 | ERROR   | Task run 'curate_and_validate_prices-0' - Finished in state Failed('Task run encountered an exception TypeError: cannot safely cast non-equivalent float64 to int64')
23:11:26.096 | ERROR   | Flow run 'classy-guillemot' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 864, in orchestrate_flow_run
    result = await flow_call.aresult()
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 87, in curate_data
    curate_and_validate_prices(run_date_str)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/tasks.py", line 569, in __call__
    return enter_task_run_engine(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1414, in enter_task_run_engine
    return from_sync.wait_for_call_in_loop_thread(begin_run)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/api.py", line 243, in wait_for_call_in_loop_thread
    return call.result()
           ^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 284, in result
    return self.future.result(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 168, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.14_1/Frameworks/Python.framework/Versions/3.11/lib/python3.11/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 355, in _run_async
    result = await coro
             ^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1582, in get_task_call_return_value
    return await future._result()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/futures.py", line 237, in _result
    return await final_state.result(raise_on_failure=raise_on_failure, fetch=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/states.py", line 91, in _get_state_result
    raise await get_state_exception(state)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:26.103 | ERROR   | Flow run 'classy-guillemot' - Finished in state Failed('Flow run encountered an exception. TypeError: cannot safely cast non-equivalent float64 to int64')
2025-12-22 23:11:26 | ERROR    | __main__:backfill_data:114 - Failed to curate 2024-09-20: cannot safely cast non-equivalent float64 to int64
2025-12-22 23:11:26 | INFO     | __main__:backfill_data:110 - Curating date 2024-09-23 (35/85)
23:11:26.112 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/alembic/config.py:598: DeprecationWarning: No path_separator found in configuration; falling back to legacy splitting on spaces, commas, and colons for prepend_sys_path.  Consider adding path_separator=os to Alembic config.
  util.warn_deprecated(

23:11:26.127 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/pydantic/v2_validated_func.py:51: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  class DecoratorBaseModel(BaseModel):

23:11:26.128 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:157: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for name, field in self.model.__fields__.items()

23:11:26.128 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:160: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  non_var_fields = set(self.model.__fields__) - {self.v_args_name, self.v_kwargs_name}

23:11:26.128 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:536: PydanticDeprecatedSince20: The private method `_iter` will be removed and should no longer be used. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for k, v in model._iter()

23:11:26.128 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields_set__` attribute is deprecated, use `model_fields_set` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:26.128 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:26.137 | INFO    | prefect.engine - Created flow run 'rugged-guppy' for flow 'curate_data'
2025-12-22 23:11:26 | INFO     | flows.curate_data:curate_data:84 - Starting curation flow for 2024-09-23
23:11:26.148 | INFO    | Flow run 'rugged-guppy' - Created task run 'curate_and_validate_prices-0' for task 'curate_and_validate_prices'
23:11:26.149 | INFO    | Flow run 'rugged-guppy' - Executing 'curate_and_validate_prices-0' immediately...
2025-12-22 23:11:26 | INFO     | flows.curate_data:curate_and_validate_prices:24 - Starting price curation for 2024-09-23
2025-12-22 23:11:26 | INFO     | curation.curate_prices:curate_daily_prices:52 - Reading 25 ticker files from /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq/2024/09/23
2025-12-22 23:11:26 | INFO     | curation.curate_prices:curate_daily_prices:70 - Combined 25 rows from 25 tickers
23:11:26.175 | ERROR   | Task run 'curate_and_validate_prices-0' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:26.182 | ERROR   | Task run 'curate_and_validate_prices-0' - Finished in state Failed('Task run encountered an exception TypeError: cannot safely cast non-equivalent float64 to int64')
23:11:26.183 | ERROR   | Flow run 'rugged-guppy' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 864, in orchestrate_flow_run
    result = await flow_call.aresult()
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 87, in curate_data
    curate_and_validate_prices(run_date_str)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/tasks.py", line 569, in __call__
    return enter_task_run_engine(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1414, in enter_task_run_engine
    return from_sync.wait_for_call_in_loop_thread(begin_run)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/api.py", line 243, in wait_for_call_in_loop_thread
    return call.result()
           ^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 284, in result
    return self.future.result(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 168, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.14_1/Frameworks/Python.framework/Versions/3.11/lib/python3.11/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 355, in _run_async
    result = await coro
             ^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1582, in get_task_call_return_value
    return await future._result()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/futures.py", line 237, in _result
    return await final_state.result(raise_on_failure=raise_on_failure, fetch=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/states.py", line 91, in _get_state_result
    raise await get_state_exception(state)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:26.190 | ERROR   | Flow run 'rugged-guppy' - Finished in state Failed('Flow run encountered an exception. TypeError: cannot safely cast non-equivalent float64 to int64')
2025-12-22 23:11:26 | ERROR    | __main__:backfill_data:114 - Failed to curate 2024-09-23: cannot safely cast non-equivalent float64 to int64
2025-12-22 23:11:26 | INFO     | __main__:backfill_data:110 - Curating date 2024-09-24 (36/85)
23:11:26.199 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/alembic/config.py:598: DeprecationWarning: No path_separator found in configuration; falling back to legacy splitting on spaces, commas, and colons for prepend_sys_path.  Consider adding path_separator=os to Alembic config.
  util.warn_deprecated(

23:11:26.214 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/pydantic/v2_validated_func.py:51: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  class DecoratorBaseModel(BaseModel):

23:11:26.214 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:157: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for name, field in self.model.__fields__.items()

23:11:26.215 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:160: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  non_var_fields = set(self.model.__fields__) - {self.v_args_name, self.v_kwargs_name}

23:11:26.215 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:536: PydanticDeprecatedSince20: The private method `_iter` will be removed and should no longer be used. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for k, v in model._iter()

23:11:26.215 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields_set__` attribute is deprecated, use `model_fields_set` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:26.215 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:26.224 | INFO    | prefect.engine - Created flow run 'invaluable-firefly' for flow 'curate_data'
2025-12-22 23:11:26 | INFO     | flows.curate_data:curate_data:84 - Starting curation flow for 2024-09-24
23:11:26.236 | INFO    | Flow run 'invaluable-firefly' - Created task run 'curate_and_validate_prices-0' for task 'curate_and_validate_prices'
23:11:26.237 | INFO    | Flow run 'invaluable-firefly' - Executing 'curate_and_validate_prices-0' immediately...
2025-12-22 23:11:26 | INFO     | flows.curate_data:curate_and_validate_prices:24 - Starting price curation for 2024-09-24
2025-12-22 23:11:26 | INFO     | curation.curate_prices:curate_daily_prices:52 - Reading 25 ticker files from /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq/2024/09/24
2025-12-22 23:11:26 | INFO     | curation.curate_prices:curate_daily_prices:70 - Combined 25 rows from 25 tickers
23:11:26.260 | ERROR   | Task run 'curate_and_validate_prices-0' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:26.268 | ERROR   | Task run 'curate_and_validate_prices-0' - Finished in state Failed('Task run encountered an exception TypeError: cannot safely cast non-equivalent float64 to int64')
23:11:26.268 | ERROR   | Flow run 'invaluable-firefly' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 864, in orchestrate_flow_run
    result = await flow_call.aresult()
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 87, in curate_data
    curate_and_validate_prices(run_date_str)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/tasks.py", line 569, in __call__
    return enter_task_run_engine(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1414, in enter_task_run_engine
    return from_sync.wait_for_call_in_loop_thread(begin_run)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/api.py", line 243, in wait_for_call_in_loop_thread
    return call.result()
           ^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 284, in result
    return self.future.result(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 168, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.14_1/Frameworks/Python.framework/Versions/3.11/lib/python3.11/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 355, in _run_async
    result = await coro
             ^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1582, in get_task_call_return_value
    return await future._result()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/futures.py", line 237, in _result
    return await final_state.result(raise_on_failure=raise_on_failure, fetch=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/states.py", line 91, in _get_state_result
    raise await get_state_exception(state)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:26.276 | ERROR   | Flow run 'invaluable-firefly' - Finished in state Failed('Flow run encountered an exception. TypeError: cannot safely cast non-equivalent float64 to int64')
2025-12-22 23:11:26 | ERROR    | __main__:backfill_data:114 - Failed to curate 2024-09-24: cannot safely cast non-equivalent float64 to int64
2025-12-22 23:11:26 | INFO     | __main__:backfill_data:110 - Curating date 2024-09-25 (37/85)
23:11:26.284 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/alembic/config.py:598: DeprecationWarning: No path_separator found in configuration; falling back to legacy splitting on spaces, commas, and colons for prepend_sys_path.  Consider adding path_separator=os to Alembic config.
  util.warn_deprecated(

23:11:26.299 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/pydantic/v2_validated_func.py:51: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  class DecoratorBaseModel(BaseModel):

23:11:26.300 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:157: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for name, field in self.model.__fields__.items()

23:11:26.300 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:160: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  non_var_fields = set(self.model.__fields__) - {self.v_args_name, self.v_kwargs_name}

23:11:26.300 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:536: PydanticDeprecatedSince20: The private method `_iter` will be removed and should no longer be used. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for k, v in model._iter()

23:11:26.300 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields_set__` attribute is deprecated, use `model_fields_set` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:26.300 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:26.308 | INFO    | prefect.engine - Created flow run 'bizarre-puffin' for flow 'curate_data'
2025-12-22 23:11:26 | INFO     | flows.curate_data:curate_data:84 - Starting curation flow for 2024-09-25
23:11:26.321 | INFO    | Flow run 'bizarre-puffin' - Created task run 'curate_and_validate_prices-0' for task 'curate_and_validate_prices'
23:11:26.322 | INFO    | Flow run 'bizarre-puffin' - Executing 'curate_and_validate_prices-0' immediately...
2025-12-22 23:11:26 | INFO     | flows.curate_data:curate_and_validate_prices:24 - Starting price curation for 2024-09-25
2025-12-22 23:11:26 | INFO     | curation.curate_prices:curate_daily_prices:52 - Reading 25 ticker files from /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq/2024/09/25
2025-12-22 23:11:26 | INFO     | curation.curate_prices:curate_daily_prices:70 - Combined 25 rows from 25 tickers
23:11:26.345 | ERROR   | Task run 'curate_and_validate_prices-0' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:26.353 | ERROR   | Task run 'curate_and_validate_prices-0' - Finished in state Failed('Task run encountered an exception TypeError: cannot safely cast non-equivalent float64 to int64')
23:11:26.354 | ERROR   | Flow run 'bizarre-puffin' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 864, in orchestrate_flow_run
    result = await flow_call.aresult()
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 87, in curate_data
    curate_and_validate_prices(run_date_str)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/tasks.py", line 569, in __call__
    return enter_task_run_engine(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1414, in enter_task_run_engine
    return from_sync.wait_for_call_in_loop_thread(begin_run)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/api.py", line 243, in wait_for_call_in_loop_thread
    return call.result()
           ^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 284, in result
    return self.future.result(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 168, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.14_1/Frameworks/Python.framework/Versions/3.11/lib/python3.11/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 355, in _run_async
    result = await coro
             ^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1582, in get_task_call_return_value
    return await future._result()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/futures.py", line 237, in _result
    return await final_state.result(raise_on_failure=raise_on_failure, fetch=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/states.py", line 91, in _get_state_result
    raise await get_state_exception(state)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:26.361 | ERROR   | Flow run 'bizarre-puffin' - Finished in state Failed('Flow run encountered an exception. TypeError: cannot safely cast non-equivalent float64 to int64')
2025-12-22 23:11:26 | ERROR    | __main__:backfill_data:114 - Failed to curate 2024-09-25: cannot safely cast non-equivalent float64 to int64
2025-12-22 23:11:26 | INFO     | __main__:backfill_data:110 - Curating date 2024-09-26 (38/85)
23:11:26.370 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/alembic/config.py:598: DeprecationWarning: No path_separator found in configuration; falling back to legacy splitting on spaces, commas, and colons for prepend_sys_path.  Consider adding path_separator=os to Alembic config.
  util.warn_deprecated(

23:11:26.385 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/pydantic/v2_validated_func.py:51: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  class DecoratorBaseModel(BaseModel):

23:11:26.386 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:157: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for name, field in self.model.__fields__.items()

23:11:26.386 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:160: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  non_var_fields = set(self.model.__fields__) - {self.v_args_name, self.v_kwargs_name}

23:11:26.386 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:536: PydanticDeprecatedSince20: The private method `_iter` will be removed and should no longer be used. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for k, v in model._iter()

23:11:26.386 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields_set__` attribute is deprecated, use `model_fields_set` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:26.386 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:26.394 | INFO    | prefect.engine - Created flow run 'notorious-serval' for flow 'curate_data'
2025-12-22 23:11:26 | INFO     | flows.curate_data:curate_data:84 - Starting curation flow for 2024-09-26
23:11:26.406 | INFO    | Flow run 'notorious-serval' - Created task run 'curate_and_validate_prices-0' for task 'curate_and_validate_prices'
23:11:26.407 | INFO    | Flow run 'notorious-serval' - Executing 'curate_and_validate_prices-0' immediately...
2025-12-22 23:11:26 | INFO     | flows.curate_data:curate_and_validate_prices:24 - Starting price curation for 2024-09-26
2025-12-22 23:11:26 | INFO     | curation.curate_prices:curate_daily_prices:52 - Reading 25 ticker files from /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq/2024/09/26
2025-12-22 23:11:26 | INFO     | curation.curate_prices:curate_daily_prices:70 - Combined 25 rows from 25 tickers
23:11:26.432 | ERROR   | Task run 'curate_and_validate_prices-0' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:26.440 | ERROR   | Task run 'curate_and_validate_prices-0' - Finished in state Failed('Task run encountered an exception TypeError: cannot safely cast non-equivalent float64 to int64')
23:11:26.440 | ERROR   | Flow run 'notorious-serval' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 864, in orchestrate_flow_run
    result = await flow_call.aresult()
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 87, in curate_data
    curate_and_validate_prices(run_date_str)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/tasks.py", line 569, in __call__
    return enter_task_run_engine(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1414, in enter_task_run_engine
    return from_sync.wait_for_call_in_loop_thread(begin_run)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/api.py", line 243, in wait_for_call_in_loop_thread
    return call.result()
           ^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 284, in result
    return self.future.result(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 168, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.14_1/Frameworks/Python.framework/Versions/3.11/lib/python3.11/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 355, in _run_async
    result = await coro
             ^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1582, in get_task_call_return_value
    return await future._result()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/futures.py", line 237, in _result
    return await final_state.result(raise_on_failure=raise_on_failure, fetch=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/states.py", line 91, in _get_state_result
    raise await get_state_exception(state)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:26.447 | ERROR   | Flow run 'notorious-serval' - Finished in state Failed('Flow run encountered an exception. TypeError: cannot safely cast non-equivalent float64 to int64')
2025-12-22 23:11:26 | ERROR    | __main__:backfill_data:114 - Failed to curate 2024-09-26: cannot safely cast non-equivalent float64 to int64
2025-12-22 23:11:26 | INFO     | __main__:backfill_data:110 - Curating date 2024-09-27 (39/85)
23:11:26.456 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/alembic/config.py:598: DeprecationWarning: No path_separator found in configuration; falling back to legacy splitting on spaces, commas, and colons for prepend_sys_path.  Consider adding path_separator=os to Alembic config.
  util.warn_deprecated(

23:11:26.471 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/pydantic/v2_validated_func.py:51: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  class DecoratorBaseModel(BaseModel):

23:11:26.471 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:157: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for name, field in self.model.__fields__.items()

23:11:26.471 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:160: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  non_var_fields = set(self.model.__fields__) - {self.v_args_name, self.v_kwargs_name}

23:11:26.472 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:536: PydanticDeprecatedSince20: The private method `_iter` will be removed and should no longer be used. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for k, v in model._iter()

23:11:26.472 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields_set__` attribute is deprecated, use `model_fields_set` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:26.472 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:26.480 | INFO    | prefect.engine - Created flow run 'pretty-goldfish' for flow 'curate_data'
2025-12-22 23:11:26 | INFO     | flows.curate_data:curate_data:84 - Starting curation flow for 2024-09-27
23:11:26.493 | INFO    | Flow run 'pretty-goldfish' - Created task run 'curate_and_validate_prices-0' for task 'curate_and_validate_prices'
23:11:26.493 | INFO    | Flow run 'pretty-goldfish' - Executing 'curate_and_validate_prices-0' immediately...
2025-12-22 23:11:26 | INFO     | flows.curate_data:curate_and_validate_prices:24 - Starting price curation for 2024-09-27
2025-12-22 23:11:26 | INFO     | curation.curate_prices:curate_daily_prices:52 - Reading 25 ticker files from /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq/2024/09/27
2025-12-22 23:11:26 | INFO     | curation.curate_prices:curate_daily_prices:70 - Combined 25 rows from 25 tickers
23:11:26.516 | ERROR   | Task run 'curate_and_validate_prices-0' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:26.524 | ERROR   | Task run 'curate_and_validate_prices-0' - Finished in state Failed('Task run encountered an exception TypeError: cannot safely cast non-equivalent float64 to int64')
23:11:26.525 | ERROR   | Flow run 'pretty-goldfish' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 864, in orchestrate_flow_run
    result = await flow_call.aresult()
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 87, in curate_data
    curate_and_validate_prices(run_date_str)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/tasks.py", line 569, in __call__
    return enter_task_run_engine(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1414, in enter_task_run_engine
    return from_sync.wait_for_call_in_loop_thread(begin_run)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/api.py", line 243, in wait_for_call_in_loop_thread
    return call.result()
           ^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 284, in result
    return self.future.result(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 168, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.14_1/Frameworks/Python.framework/Versions/3.11/lib/python3.11/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 355, in _run_async
    result = await coro
             ^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1582, in get_task_call_return_value
    return await future._result()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/futures.py", line 237, in _result
    return await final_state.result(raise_on_failure=raise_on_failure, fetch=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/states.py", line 91, in _get_state_result
    raise await get_state_exception(state)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:26.532 | ERROR   | Flow run 'pretty-goldfish' - Finished in state Failed('Flow run encountered an exception. TypeError: cannot safely cast non-equivalent float64 to int64')
2025-12-22 23:11:26 | ERROR    | __main__:backfill_data:114 - Failed to curate 2024-09-27: cannot safely cast non-equivalent float64 to int64
2025-12-22 23:11:26 | INFO     | __main__:backfill_data:110 - Curating date 2024-09-30 (40/85)
23:11:26.540 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/alembic/config.py:598: DeprecationWarning: No path_separator found in configuration; falling back to legacy splitting on spaces, commas, and colons for prepend_sys_path.  Consider adding path_separator=os to Alembic config.
  util.warn_deprecated(

23:11:26.556 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/pydantic/v2_validated_func.py:51: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  class DecoratorBaseModel(BaseModel):

23:11:26.556 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:157: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for name, field in self.model.__fields__.items()

23:11:26.556 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:160: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  non_var_fields = set(self.model.__fields__) - {self.v_args_name, self.v_kwargs_name}

23:11:26.557 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:536: PydanticDeprecatedSince20: The private method `_iter` will be removed and should no longer be used. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for k, v in model._iter()

23:11:26.557 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields_set__` attribute is deprecated, use `model_fields_set` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:26.557 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:26.565 | INFO    | prefect.engine - Created flow run 'zealous-moth' for flow 'curate_data'
2025-12-22 23:11:26 | INFO     | flows.curate_data:curate_data:84 - Starting curation flow for 2024-09-30
23:11:26.578 | INFO    | Flow run 'zealous-moth' - Created task run 'curate_and_validate_prices-0' for task 'curate_and_validate_prices'
23:11:26.578 | INFO    | Flow run 'zealous-moth' - Executing 'curate_and_validate_prices-0' immediately...
2025-12-22 23:11:26 | INFO     | flows.curate_data:curate_and_validate_prices:24 - Starting price curation for 2024-09-30
2025-12-22 23:11:26 | INFO     | curation.curate_prices:curate_daily_prices:52 - Reading 25 ticker files from /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq/2024/09/30
2025-12-22 23:11:26 | INFO     | curation.curate_prices:curate_daily_prices:70 - Combined 25 rows from 25 tickers
23:11:26.604 | ERROR   | Task run 'curate_and_validate_prices-0' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:26.611 | ERROR   | Task run 'curate_and_validate_prices-0' - Finished in state Failed('Task run encountered an exception TypeError: cannot safely cast non-equivalent float64 to int64')
23:11:26.612 | ERROR   | Flow run 'zealous-moth' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 864, in orchestrate_flow_run
    result = await flow_call.aresult()
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 87, in curate_data
    curate_and_validate_prices(run_date_str)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/tasks.py", line 569, in __call__
    return enter_task_run_engine(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1414, in enter_task_run_engine
    return from_sync.wait_for_call_in_loop_thread(begin_run)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/api.py", line 243, in wait_for_call_in_loop_thread
    return call.result()
           ^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 284, in result
    return self.future.result(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 168, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.14_1/Frameworks/Python.framework/Versions/3.11/lib/python3.11/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 355, in _run_async
    result = await coro
             ^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1582, in get_task_call_return_value
    return await future._result()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/futures.py", line 237, in _result
    return await final_state.result(raise_on_failure=raise_on_failure, fetch=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/states.py", line 91, in _get_state_result
    raise await get_state_exception(state)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:26.619 | ERROR   | Flow run 'zealous-moth' - Finished in state Failed('Flow run encountered an exception. TypeError: cannot safely cast non-equivalent float64 to int64')
2025-12-22 23:11:26 | ERROR    | __main__:backfill_data:114 - Failed to curate 2024-09-30: cannot safely cast non-equivalent float64 to int64
2025-12-22 23:11:26 | INFO     | __main__:backfill_data:110 - Curating date 2024-10-01 (41/85)
23:11:26.628 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/alembic/config.py:598: DeprecationWarning: No path_separator found in configuration; falling back to legacy splitting on spaces, commas, and colons for prepend_sys_path.  Consider adding path_separator=os to Alembic config.
  util.warn_deprecated(

23:11:26.643 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/pydantic/v2_validated_func.py:51: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  class DecoratorBaseModel(BaseModel):

23:11:26.644 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:157: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for name, field in self.model.__fields__.items()

23:11:26.644 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:160: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  non_var_fields = set(self.model.__fields__) - {self.v_args_name, self.v_kwargs_name}

23:11:26.644 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:536: PydanticDeprecatedSince20: The private method `_iter` will be removed and should no longer be used. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for k, v in model._iter()

23:11:26.644 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields_set__` attribute is deprecated, use `model_fields_set` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:26.644 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:26.653 | INFO    | prefect.engine - Created flow run 'passionate-ammonite' for flow 'curate_data'
2025-12-22 23:11:26 | INFO     | flows.curate_data:curate_data:84 - Starting curation flow for 2024-10-01
23:11:26.665 | INFO    | Flow run 'passionate-ammonite' - Created task run 'curate_and_validate_prices-0' for task 'curate_and_validate_prices'
23:11:26.665 | INFO    | Flow run 'passionate-ammonite' - Executing 'curate_and_validate_prices-0' immediately...
2025-12-22 23:11:26 | INFO     | flows.curate_data:curate_and_validate_prices:24 - Starting price curation for 2024-10-01
2025-12-22 23:11:26 | INFO     | curation.curate_prices:curate_daily_prices:52 - Reading 25 ticker files from /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq/2024/10/01
2025-12-22 23:11:26 | INFO     | curation.curate_prices:curate_daily_prices:70 - Combined 25 rows from 25 tickers
23:11:26.689 | ERROR   | Task run 'curate_and_validate_prices-0' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:26.696 | ERROR   | Task run 'curate_and_validate_prices-0' - Finished in state Failed('Task run encountered an exception TypeError: cannot safely cast non-equivalent float64 to int64')
23:11:26.697 | ERROR   | Flow run 'passionate-ammonite' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 864, in orchestrate_flow_run
    result = await flow_call.aresult()
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 87, in curate_data
    curate_and_validate_prices(run_date_str)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/tasks.py", line 569, in __call__
    return enter_task_run_engine(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1414, in enter_task_run_engine
    return from_sync.wait_for_call_in_loop_thread(begin_run)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/api.py", line 243, in wait_for_call_in_loop_thread
    return call.result()
           ^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 284, in result
    return self.future.result(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 168, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.14_1/Frameworks/Python.framework/Versions/3.11/lib/python3.11/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 355, in _run_async
    result = await coro
             ^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1582, in get_task_call_return_value
    return await future._result()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/futures.py", line 237, in _result
    return await final_state.result(raise_on_failure=raise_on_failure, fetch=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/states.py", line 91, in _get_state_result
    raise await get_state_exception(state)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:26.704 | ERROR   | Flow run 'passionate-ammonite' - Finished in state Failed('Flow run encountered an exception. TypeError: cannot safely cast non-equivalent float64 to int64')
2025-12-22 23:11:26 | ERROR    | __main__:backfill_data:114 - Failed to curate 2024-10-01: cannot safely cast non-equivalent float64 to int64
2025-12-22 23:11:26 | INFO     | __main__:backfill_data:110 - Curating date 2024-10-02 (42/85)
23:11:26.713 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/alembic/config.py:598: DeprecationWarning: No path_separator found in configuration; falling back to legacy splitting on spaces, commas, and colons for prepend_sys_path.  Consider adding path_separator=os to Alembic config.
  util.warn_deprecated(

23:11:26.728 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/pydantic/v2_validated_func.py:51: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  class DecoratorBaseModel(BaseModel):

23:11:26.729 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:157: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for name, field in self.model.__fields__.items()

23:11:26.729 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:160: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  non_var_fields = set(self.model.__fields__) - {self.v_args_name, self.v_kwargs_name}

23:11:26.729 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:536: PydanticDeprecatedSince20: The private method `_iter` will be removed and should no longer be used. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for k, v in model._iter()

23:11:26.729 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields_set__` attribute is deprecated, use `model_fields_set` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:26.730 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:26.738 | INFO    | prefect.engine - Created flow run 'cheerful-spoonbill' for flow 'curate_data'
2025-12-22 23:11:26 | INFO     | flows.curate_data:curate_data:84 - Starting curation flow for 2024-10-02
23:11:26.750 | INFO    | Flow run 'cheerful-spoonbill' - Created task run 'curate_and_validate_prices-0' for task 'curate_and_validate_prices'
23:11:26.750 | INFO    | Flow run 'cheerful-spoonbill' - Executing 'curate_and_validate_prices-0' immediately...
2025-12-22 23:11:26 | INFO     | flows.curate_data:curate_and_validate_prices:24 - Starting price curation for 2024-10-02
2025-12-22 23:11:26 | INFO     | curation.curate_prices:curate_daily_prices:52 - Reading 25 ticker files from /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq/2024/10/02
2025-12-22 23:11:26 | INFO     | curation.curate_prices:curate_daily_prices:70 - Combined 25 rows from 25 tickers
23:11:26.775 | ERROR   | Task run 'curate_and_validate_prices-0' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:26.783 | ERROR   | Task run 'curate_and_validate_prices-0' - Finished in state Failed('Task run encountered an exception TypeError: cannot safely cast non-equivalent float64 to int64')
23:11:26.783 | ERROR   | Flow run 'cheerful-spoonbill' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 864, in orchestrate_flow_run
    result = await flow_call.aresult()
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 87, in curate_data
    curate_and_validate_prices(run_date_str)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/tasks.py", line 569, in __call__
    return enter_task_run_engine(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1414, in enter_task_run_engine
    return from_sync.wait_for_call_in_loop_thread(begin_run)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/api.py", line 243, in wait_for_call_in_loop_thread
    return call.result()
           ^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 284, in result
    return self.future.result(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 168, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.14_1/Frameworks/Python.framework/Versions/3.11/lib/python3.11/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 355, in _run_async
    result = await coro
             ^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1582, in get_task_call_return_value
    return await future._result()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/futures.py", line 237, in _result
    return await final_state.result(raise_on_failure=raise_on_failure, fetch=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/states.py", line 91, in _get_state_result
    raise await get_state_exception(state)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:26.791 | ERROR   | Flow run 'cheerful-spoonbill' - Finished in state Failed('Flow run encountered an exception. TypeError: cannot safely cast non-equivalent float64 to int64')
2025-12-22 23:11:26 | ERROR    | __main__:backfill_data:114 - Failed to curate 2024-10-02: cannot safely cast non-equivalent float64 to int64
2025-12-22 23:11:26 | INFO     | __main__:backfill_data:110 - Curating date 2024-10-03 (43/85)
23:11:26.799 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/alembic/config.py:598: DeprecationWarning: No path_separator found in configuration; falling back to legacy splitting on spaces, commas, and colons for prepend_sys_path.  Consider adding path_separator=os to Alembic config.
  util.warn_deprecated(

23:11:26.814 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/pydantic/v2_validated_func.py:51: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  class DecoratorBaseModel(BaseModel):

23:11:26.815 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:157: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for name, field in self.model.__fields__.items()

23:11:26.815 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:160: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  non_var_fields = set(self.model.__fields__) - {self.v_args_name, self.v_kwargs_name}

23:11:26.815 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:536: PydanticDeprecatedSince20: The private method `_iter` will be removed and should no longer be used. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for k, v in model._iter()

23:11:26.815 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields_set__` attribute is deprecated, use `model_fields_set` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:26.815 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:26.824 | INFO    | prefect.engine - Created flow run 'teal-millipede' for flow 'curate_data'
2025-12-22 23:11:26 | INFO     | flows.curate_data:curate_data:84 - Starting curation flow for 2024-10-03
23:11:26.836 | INFO    | Flow run 'teal-millipede' - Created task run 'curate_and_validate_prices-0' for task 'curate_and_validate_prices'
23:11:26.837 | INFO    | Flow run 'teal-millipede' - Executing 'curate_and_validate_prices-0' immediately...
2025-12-22 23:11:26 | INFO     | flows.curate_data:curate_and_validate_prices:24 - Starting price curation for 2024-10-03
2025-12-22 23:11:26 | INFO     | curation.curate_prices:curate_daily_prices:52 - Reading 25 ticker files from /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq/2024/10/03
2025-12-22 23:11:26 | INFO     | curation.curate_prices:curate_daily_prices:70 - Combined 25 rows from 25 tickers
23:11:26.860 | ERROR   | Task run 'curate_and_validate_prices-0' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:26.868 | ERROR   | Task run 'curate_and_validate_prices-0' - Finished in state Failed('Task run encountered an exception TypeError: cannot safely cast non-equivalent float64 to int64')
23:11:26.868 | ERROR   | Flow run 'teal-millipede' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 864, in orchestrate_flow_run
    result = await flow_call.aresult()
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 87, in curate_data
    curate_and_validate_prices(run_date_str)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/tasks.py", line 569, in __call__
    return enter_task_run_engine(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1414, in enter_task_run_engine
    return from_sync.wait_for_call_in_loop_thread(begin_run)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/api.py", line 243, in wait_for_call_in_loop_thread
    return call.result()
           ^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 284, in result
    return self.future.result(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 168, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.14_1/Frameworks/Python.framework/Versions/3.11/lib/python3.11/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 355, in _run_async
    result = await coro
             ^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1582, in get_task_call_return_value
    return await future._result()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/futures.py", line 237, in _result
    return await final_state.result(raise_on_failure=raise_on_failure, fetch=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/states.py", line 91, in _get_state_result
    raise await get_state_exception(state)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:26.875 | ERROR   | Flow run 'teal-millipede' - Finished in state Failed('Flow run encountered an exception. TypeError: cannot safely cast non-equivalent float64 to int64')
2025-12-22 23:11:26 | ERROR    | __main__:backfill_data:114 - Failed to curate 2024-10-03: cannot safely cast non-equivalent float64 to int64
2025-12-22 23:11:26 | INFO     | __main__:backfill_data:110 - Curating date 2024-10-04 (44/85)
23:11:26.885 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/alembic/config.py:598: DeprecationWarning: No path_separator found in configuration; falling back to legacy splitting on spaces, commas, and colons for prepend_sys_path.  Consider adding path_separator=os to Alembic config.
  util.warn_deprecated(

23:11:26.900 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/pydantic/v2_validated_func.py:51: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  class DecoratorBaseModel(BaseModel):

23:11:26.901 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:157: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for name, field in self.model.__fields__.items()

23:11:26.901 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:160: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  non_var_fields = set(self.model.__fields__) - {self.v_args_name, self.v_kwargs_name}

23:11:26.901 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:536: PydanticDeprecatedSince20: The private method `_iter` will be removed and should no longer be used. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for k, v in model._iter()

23:11:26.901 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields_set__` attribute is deprecated, use `model_fields_set` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:26.901 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:26.910 | INFO    | prefect.engine - Created flow run 'beautiful-viper' for flow 'curate_data'
2025-12-22 23:11:26 | INFO     | flows.curate_data:curate_data:84 - Starting curation flow for 2024-10-04
23:11:26.922 | INFO    | Flow run 'beautiful-viper' - Created task run 'curate_and_validate_prices-0' for task 'curate_and_validate_prices'
23:11:26.922 | INFO    | Flow run 'beautiful-viper' - Executing 'curate_and_validate_prices-0' immediately...
2025-12-22 23:11:26 | INFO     | flows.curate_data:curate_and_validate_prices:24 - Starting price curation for 2024-10-04
2025-12-22 23:11:26 | INFO     | curation.curate_prices:curate_daily_prices:52 - Reading 25 ticker files from /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq/2024/10/04
2025-12-22 23:11:26 | INFO     | curation.curate_prices:curate_daily_prices:70 - Combined 25 rows from 25 tickers
23:11:26.945 | ERROR   | Task run 'curate_and_validate_prices-0' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:26.953 | ERROR   | Task run 'curate_and_validate_prices-0' - Finished in state Failed('Task run encountered an exception TypeError: cannot safely cast non-equivalent float64 to int64')
23:11:26.954 | ERROR   | Flow run 'beautiful-viper' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 864, in orchestrate_flow_run
    result = await flow_call.aresult()
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 87, in curate_data
    curate_and_validate_prices(run_date_str)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/tasks.py", line 569, in __call__
    return enter_task_run_engine(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1414, in enter_task_run_engine
    return from_sync.wait_for_call_in_loop_thread(begin_run)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/api.py", line 243, in wait_for_call_in_loop_thread
    return call.result()
           ^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 284, in result
    return self.future.result(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 168, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.14_1/Frameworks/Python.framework/Versions/3.11/lib/python3.11/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 355, in _run_async
    result = await coro
             ^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1582, in get_task_call_return_value
    return await future._result()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/futures.py", line 237, in _result
    return await final_state.result(raise_on_failure=raise_on_failure, fetch=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/states.py", line 91, in _get_state_result
    raise await get_state_exception(state)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:26.961 | ERROR   | Flow run 'beautiful-viper' - Finished in state Failed('Flow run encountered an exception. TypeError: cannot safely cast non-equivalent float64 to int64')
2025-12-22 23:11:26 | ERROR    | __main__:backfill_data:114 - Failed to curate 2024-10-04: cannot safely cast non-equivalent float64 to int64
2025-12-22 23:11:26 | INFO     | __main__:backfill_data:110 - Curating date 2024-10-07 (45/85)
23:11:26.970 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/alembic/config.py:598: DeprecationWarning: No path_separator found in configuration; falling back to legacy splitting on spaces, commas, and colons for prepend_sys_path.  Consider adding path_separator=os to Alembic config.
  util.warn_deprecated(

23:11:26.985 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/pydantic/v2_validated_func.py:51: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  class DecoratorBaseModel(BaseModel):

23:11:26.986 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:157: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for name, field in self.model.__fields__.items()

23:11:26.986 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:160: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  non_var_fields = set(self.model.__fields__) - {self.v_args_name, self.v_kwargs_name}

23:11:26.986 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:536: PydanticDeprecatedSince20: The private method `_iter` will be removed and should no longer be used. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for k, v in model._iter()

23:11:26.986 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields_set__` attribute is deprecated, use `model_fields_set` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:26.986 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:26.994 | INFO    | prefect.engine - Created flow run 'stoic-peacock' for flow 'curate_data'
2025-12-22 23:11:27 | INFO     | flows.curate_data:curate_data:84 - Starting curation flow for 2024-10-07
23:11:27.006 | INFO    | Flow run 'stoic-peacock' - Created task run 'curate_and_validate_prices-0' for task 'curate_and_validate_prices'
23:11:27.006 | INFO    | Flow run 'stoic-peacock' - Executing 'curate_and_validate_prices-0' immediately...
2025-12-22 23:11:27 | INFO     | flows.curate_data:curate_and_validate_prices:24 - Starting price curation for 2024-10-07
2025-12-22 23:11:27 | INFO     | curation.curate_prices:curate_daily_prices:52 - Reading 25 ticker files from /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq/2024/10/07
2025-12-22 23:11:27 | INFO     | curation.curate_prices:curate_daily_prices:70 - Combined 25 rows from 25 tickers
23:11:27.033 | ERROR   | Task run 'curate_and_validate_prices-0' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:27.040 | ERROR   | Task run 'curate_and_validate_prices-0' - Finished in state Failed('Task run encountered an exception TypeError: cannot safely cast non-equivalent float64 to int64')
23:11:27.041 | ERROR   | Flow run 'stoic-peacock' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 864, in orchestrate_flow_run
    result = await flow_call.aresult()
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 87, in curate_data
    curate_and_validate_prices(run_date_str)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/tasks.py", line 569, in __call__
    return enter_task_run_engine(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1414, in enter_task_run_engine
    return from_sync.wait_for_call_in_loop_thread(begin_run)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/api.py", line 243, in wait_for_call_in_loop_thread
    return call.result()
           ^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 284, in result
    return self.future.result(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 168, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.14_1/Frameworks/Python.framework/Versions/3.11/lib/python3.11/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 355, in _run_async
    result = await coro
             ^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1582, in get_task_call_return_value
    return await future._result()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/futures.py", line 237, in _result
    return await final_state.result(raise_on_failure=raise_on_failure, fetch=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/states.py", line 91, in _get_state_result
    raise await get_state_exception(state)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:27.048 | ERROR   | Flow run 'stoic-peacock' - Finished in state Failed('Flow run encountered an exception. TypeError: cannot safely cast non-equivalent float64 to int64')
2025-12-22 23:11:27 | ERROR    | __main__:backfill_data:114 - Failed to curate 2024-10-07: cannot safely cast non-equivalent float64 to int64
2025-12-22 23:11:27 | INFO     | __main__:backfill_data:110 - Curating date 2024-10-08 (46/85)
23:11:27.056 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/alembic/config.py:598: DeprecationWarning: No path_separator found in configuration; falling back to legacy splitting on spaces, commas, and colons for prepend_sys_path.  Consider adding path_separator=os to Alembic config.
  util.warn_deprecated(

23:11:27.071 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/pydantic/v2_validated_func.py:51: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  class DecoratorBaseModel(BaseModel):

23:11:27.072 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:157: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for name, field in self.model.__fields__.items()

23:11:27.072 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:160: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  non_var_fields = set(self.model.__fields__) - {self.v_args_name, self.v_kwargs_name}

23:11:27.072 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:536: PydanticDeprecatedSince20: The private method `_iter` will be removed and should no longer be used. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for k, v in model._iter()

23:11:27.072 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields_set__` attribute is deprecated, use `model_fields_set` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:27.072 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:27.081 | INFO    | prefect.engine - Created flow run 'careful-gibbon' for flow 'curate_data'
2025-12-22 23:11:27 | INFO     | flows.curate_data:curate_data:84 - Starting curation flow for 2024-10-08
23:11:27.095 | INFO    | Flow run 'careful-gibbon' - Created task run 'curate_and_validate_prices-0' for task 'curate_and_validate_prices'
23:11:27.095 | INFO    | Flow run 'careful-gibbon' - Executing 'curate_and_validate_prices-0' immediately...
2025-12-22 23:11:27 | INFO     | flows.curate_data:curate_and_validate_prices:24 - Starting price curation for 2024-10-08
2025-12-22 23:11:27 | INFO     | curation.curate_prices:curate_daily_prices:52 - Reading 25 ticker files from /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq/2024/10/08
2025-12-22 23:11:27 | INFO     | curation.curate_prices:curate_daily_prices:70 - Combined 25 rows from 25 tickers
23:11:27.120 | ERROR   | Task run 'curate_and_validate_prices-0' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:27.128 | ERROR   | Task run 'curate_and_validate_prices-0' - Finished in state Failed('Task run encountered an exception TypeError: cannot safely cast non-equivalent float64 to int64')
23:11:27.128 | ERROR   | Flow run 'careful-gibbon' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 864, in orchestrate_flow_run
    result = await flow_call.aresult()
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 87, in curate_data
    curate_and_validate_prices(run_date_str)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/tasks.py", line 569, in __call__
    return enter_task_run_engine(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1414, in enter_task_run_engine
    return from_sync.wait_for_call_in_loop_thread(begin_run)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/api.py", line 243, in wait_for_call_in_loop_thread
    return call.result()
           ^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 284, in result
    return self.future.result(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 168, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.14_1/Frameworks/Python.framework/Versions/3.11/lib/python3.11/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 355, in _run_async
    result = await coro
             ^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1582, in get_task_call_return_value
    return await future._result()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/futures.py", line 237, in _result
    return await final_state.result(raise_on_failure=raise_on_failure, fetch=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/states.py", line 91, in _get_state_result
    raise await get_state_exception(state)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:27.137 | ERROR   | Flow run 'careful-gibbon' - Finished in state Failed('Flow run encountered an exception. TypeError: cannot safely cast non-equivalent float64 to int64')
2025-12-22 23:11:27 | ERROR    | __main__:backfill_data:114 - Failed to curate 2024-10-08: cannot safely cast non-equivalent float64 to int64
2025-12-22 23:11:27 | INFO     | __main__:backfill_data:110 - Curating date 2024-10-09 (47/85)
23:11:27.146 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/alembic/config.py:598: DeprecationWarning: No path_separator found in configuration; falling back to legacy splitting on spaces, commas, and colons for prepend_sys_path.  Consider adding path_separator=os to Alembic config.
  util.warn_deprecated(

23:11:27.161 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/pydantic/v2_validated_func.py:51: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  class DecoratorBaseModel(BaseModel):

23:11:27.162 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:157: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for name, field in self.model.__fields__.items()

23:11:27.162 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:160: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  non_var_fields = set(self.model.__fields__) - {self.v_args_name, self.v_kwargs_name}

23:11:27.162 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:536: PydanticDeprecatedSince20: The private method `_iter` will be removed and should no longer be used. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for k, v in model._iter()

23:11:27.162 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields_set__` attribute is deprecated, use `model_fields_set` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:27.162 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:27.171 | INFO    | prefect.engine - Created flow run 'bright-oriole' for flow 'curate_data'
2025-12-22 23:11:27 | INFO     | flows.curate_data:curate_data:84 - Starting curation flow for 2024-10-09
23:11:27.182 | INFO    | Flow run 'bright-oriole' - Created task run 'curate_and_validate_prices-0' for task 'curate_and_validate_prices'
23:11:27.183 | INFO    | Flow run 'bright-oriole' - Executing 'curate_and_validate_prices-0' immediately...
2025-12-22 23:11:27 | INFO     | flows.curate_data:curate_and_validate_prices:24 - Starting price curation for 2024-10-09
2025-12-22 23:11:27 | INFO     | curation.curate_prices:curate_daily_prices:52 - Reading 25 ticker files from /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq/2024/10/09
2025-12-22 23:11:27 | INFO     | curation.curate_prices:curate_daily_prices:70 - Combined 25 rows from 25 tickers
23:11:27.208 | ERROR   | Task run 'curate_and_validate_prices-0' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:27.215 | ERROR   | Task run 'curate_and_validate_prices-0' - Finished in state Failed('Task run encountered an exception TypeError: cannot safely cast non-equivalent float64 to int64')
23:11:27.216 | ERROR   | Flow run 'bright-oriole' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 864, in orchestrate_flow_run
    result = await flow_call.aresult()
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 87, in curate_data
    curate_and_validate_prices(run_date_str)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/tasks.py", line 569, in __call__
    return enter_task_run_engine(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1414, in enter_task_run_engine
    return from_sync.wait_for_call_in_loop_thread(begin_run)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/api.py", line 243, in wait_for_call_in_loop_thread
    return call.result()
           ^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 284, in result
    return self.future.result(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 168, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.14_1/Frameworks/Python.framework/Versions/3.11/lib/python3.11/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 355, in _run_async
    result = await coro
             ^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1582, in get_task_call_return_value
    return await future._result()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/futures.py", line 237, in _result
    return await final_state.result(raise_on_failure=raise_on_failure, fetch=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/states.py", line 91, in _get_state_result
    raise await get_state_exception(state)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:27.224 | ERROR   | Flow run 'bright-oriole' - Finished in state Failed('Flow run encountered an exception. TypeError: cannot safely cast non-equivalent float64 to int64')
2025-12-22 23:11:27 | ERROR    | __main__:backfill_data:114 - Failed to curate 2024-10-09: cannot safely cast non-equivalent float64 to int64
2025-12-22 23:11:27 | INFO     | __main__:backfill_data:110 - Curating date 2024-10-10 (48/85)
23:11:27.232 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/alembic/config.py:598: DeprecationWarning: No path_separator found in configuration; falling back to legacy splitting on spaces, commas, and colons for prepend_sys_path.  Consider adding path_separator=os to Alembic config.
  util.warn_deprecated(

23:11:27.248 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/pydantic/v2_validated_func.py:51: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  class DecoratorBaseModel(BaseModel):

23:11:27.249 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:157: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for name, field in self.model.__fields__.items()

23:11:27.249 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:160: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  non_var_fields = set(self.model.__fields__) - {self.v_args_name, self.v_kwargs_name}

23:11:27.249 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:536: PydanticDeprecatedSince20: The private method `_iter` will be removed and should no longer be used. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for k, v in model._iter()

23:11:27.249 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields_set__` attribute is deprecated, use `model_fields_set` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:27.249 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:27.259 | INFO    | prefect.engine - Created flow run 'prompt-viper' for flow 'curate_data'
2025-12-22 23:11:27 | INFO     | flows.curate_data:curate_data:84 - Starting curation flow for 2024-10-10
23:11:27.271 | INFO    | Flow run 'prompt-viper' - Created task run 'curate_and_validate_prices-0' for task 'curate_and_validate_prices'
23:11:27.271 | INFO    | Flow run 'prompt-viper' - Executing 'curate_and_validate_prices-0' immediately...
2025-12-22 23:11:27 | INFO     | flows.curate_data:curate_and_validate_prices:24 - Starting price curation for 2024-10-10
2025-12-22 23:11:27 | INFO     | curation.curate_prices:curate_daily_prices:52 - Reading 25 ticker files from /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq/2024/10/10
2025-12-22 23:11:27 | INFO     | curation.curate_prices:curate_daily_prices:70 - Combined 25 rows from 25 tickers
23:11:27.300 | ERROR   | Task run 'curate_and_validate_prices-0' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:27.308 | ERROR   | Task run 'curate_and_validate_prices-0' - Finished in state Failed('Task run encountered an exception TypeError: cannot safely cast non-equivalent float64 to int64')
23:11:27.309 | ERROR   | Flow run 'prompt-viper' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 864, in orchestrate_flow_run
    result = await flow_call.aresult()
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 87, in curate_data
    curate_and_validate_prices(run_date_str)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/tasks.py", line 569, in __call__
    return enter_task_run_engine(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1414, in enter_task_run_engine
    return from_sync.wait_for_call_in_loop_thread(begin_run)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/api.py", line 243, in wait_for_call_in_loop_thread
    return call.result()
           ^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 284, in result
    return self.future.result(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 168, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.14_1/Frameworks/Python.framework/Versions/3.11/lib/python3.11/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 355, in _run_async
    result = await coro
             ^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1582, in get_task_call_return_value
    return await future._result()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/futures.py", line 237, in _result
    return await final_state.result(raise_on_failure=raise_on_failure, fetch=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/states.py", line 91, in _get_state_result
    raise await get_state_exception(state)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:27.316 | ERROR   | Flow run 'prompt-viper' - Finished in state Failed('Flow run encountered an exception. TypeError: cannot safely cast non-equivalent float64 to int64')
2025-12-22 23:11:27 | ERROR    | __main__:backfill_data:114 - Failed to curate 2024-10-10: cannot safely cast non-equivalent float64 to int64
2025-12-22 23:11:27 | INFO     | __main__:backfill_data:110 - Curating date 2024-10-11 (49/85)
23:11:27.325 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/alembic/config.py:598: DeprecationWarning: No path_separator found in configuration; falling back to legacy splitting on spaces, commas, and colons for prepend_sys_path.  Consider adding path_separator=os to Alembic config.
  util.warn_deprecated(

23:11:27.506 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/pydantic/v2_validated_func.py:51: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  class DecoratorBaseModel(BaseModel):

23:11:27.506 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:157: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for name, field in self.model.__fields__.items()

23:11:27.506 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:160: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  non_var_fields = set(self.model.__fields__) - {self.v_args_name, self.v_kwargs_name}

23:11:27.507 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:536: PydanticDeprecatedSince20: The private method `_iter` will be removed and should no longer be used. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for k, v in model._iter()

23:11:27.507 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields_set__` attribute is deprecated, use `model_fields_set` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:27.507 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:27.515 | INFO    | prefect.engine - Created flow run 'passionate-coua' for flow 'curate_data'
2025-12-22 23:11:27 | INFO     | flows.curate_data:curate_data:84 - Starting curation flow for 2024-10-11
23:11:27.528 | INFO    | Flow run 'passionate-coua' - Created task run 'curate_and_validate_prices-0' for task 'curate_and_validate_prices'
23:11:27.528 | INFO    | Flow run 'passionate-coua' - Executing 'curate_and_validate_prices-0' immediately...
2025-12-22 23:11:27 | INFO     | flows.curate_data:curate_and_validate_prices:24 - Starting price curation for 2024-10-11
2025-12-22 23:11:27 | INFO     | curation.curate_prices:curate_daily_prices:52 - Reading 25 ticker files from /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq/2024/10/11
2025-12-22 23:11:27 | INFO     | curation.curate_prices:curate_daily_prices:70 - Combined 25 rows from 25 tickers
23:11:27.552 | ERROR   | Task run 'curate_and_validate_prices-0' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:27.560 | ERROR   | Task run 'curate_and_validate_prices-0' - Finished in state Failed('Task run encountered an exception TypeError: cannot safely cast non-equivalent float64 to int64')
23:11:27.560 | ERROR   | Flow run 'passionate-coua' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 864, in orchestrate_flow_run
    result = await flow_call.aresult()
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 87, in curate_data
    curate_and_validate_prices(run_date_str)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/tasks.py", line 569, in __call__
    return enter_task_run_engine(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1414, in enter_task_run_engine
    return from_sync.wait_for_call_in_loop_thread(begin_run)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/api.py", line 243, in wait_for_call_in_loop_thread
    return call.result()
           ^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 284, in result
    return self.future.result(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 168, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.14_1/Frameworks/Python.framework/Versions/3.11/lib/python3.11/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 355, in _run_async
    result = await coro
             ^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1582, in get_task_call_return_value
    return await future._result()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/futures.py", line 237, in _result
    return await final_state.result(raise_on_failure=raise_on_failure, fetch=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/states.py", line 91, in _get_state_result
    raise await get_state_exception(state)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:27.568 | ERROR   | Flow run 'passionate-coua' - Finished in state Failed('Flow run encountered an exception. TypeError: cannot safely cast non-equivalent float64 to int64')
2025-12-22 23:11:27 | ERROR    | __main__:backfill_data:114 - Failed to curate 2024-10-11: cannot safely cast non-equivalent float64 to int64
2025-12-22 23:11:27 | INFO     | __main__:backfill_data:110 - Curating date 2024-10-14 (50/85)
23:11:27.576 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/alembic/config.py:598: DeprecationWarning: No path_separator found in configuration; falling back to legacy splitting on spaces, commas, and colons for prepend_sys_path.  Consider adding path_separator=os to Alembic config.
  util.warn_deprecated(

23:11:27.592 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/pydantic/v2_validated_func.py:51: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  class DecoratorBaseModel(BaseModel):

23:11:27.593 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:157: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for name, field in self.model.__fields__.items()

23:11:27.593 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:160: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  non_var_fields = set(self.model.__fields__) - {self.v_args_name, self.v_kwargs_name}

23:11:27.593 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:536: PydanticDeprecatedSince20: The private method `_iter` will be removed and should no longer be used. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for k, v in model._iter()

23:11:27.593 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields_set__` attribute is deprecated, use `model_fields_set` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:27.593 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:27.602 | INFO    | prefect.engine - Created flow run 'energetic-buzzard' for flow 'curate_data'
2025-12-22 23:11:27 | INFO     | flows.curate_data:curate_data:84 - Starting curation flow for 2024-10-14
23:11:27.614 | INFO    | Flow run 'energetic-buzzard' - Created task run 'curate_and_validate_prices-0' for task 'curate_and_validate_prices'
23:11:27.614 | INFO    | Flow run 'energetic-buzzard' - Executing 'curate_and_validate_prices-0' immediately...
2025-12-22 23:11:27 | INFO     | flows.curate_data:curate_and_validate_prices:24 - Starting price curation for 2024-10-14
2025-12-22 23:11:27 | INFO     | curation.curate_prices:curate_daily_prices:52 - Reading 25 ticker files from /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq/2024/10/14
2025-12-22 23:11:27 | INFO     | curation.curate_prices:curate_daily_prices:70 - Combined 25 rows from 25 tickers
23:11:27.640 | ERROR   | Task run 'curate_and_validate_prices-0' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:27.648 | ERROR   | Task run 'curate_and_validate_prices-0' - Finished in state Failed('Task run encountered an exception TypeError: cannot safely cast non-equivalent float64 to int64')
23:11:27.648 | ERROR   | Flow run 'energetic-buzzard' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 864, in orchestrate_flow_run
    result = await flow_call.aresult()
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 87, in curate_data
    curate_and_validate_prices(run_date_str)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/tasks.py", line 569, in __call__
    return enter_task_run_engine(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1414, in enter_task_run_engine
    return from_sync.wait_for_call_in_loop_thread(begin_run)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/api.py", line 243, in wait_for_call_in_loop_thread
    return call.result()
           ^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 284, in result
    return self.future.result(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 168, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.14_1/Frameworks/Python.framework/Versions/3.11/lib/python3.11/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 355, in _run_async
    result = await coro
             ^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1582, in get_task_call_return_value
    return await future._result()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/futures.py", line 237, in _result
    return await final_state.result(raise_on_failure=raise_on_failure, fetch=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/states.py", line 91, in _get_state_result
    raise await get_state_exception(state)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:27.657 | ERROR   | Flow run 'energetic-buzzard' - Finished in state Failed('Flow run encountered an exception. TypeError: cannot safely cast non-equivalent float64 to int64')
2025-12-22 23:11:27 | ERROR    | __main__:backfill_data:114 - Failed to curate 2024-10-14: cannot safely cast non-equivalent float64 to int64
2025-12-22 23:11:27 | INFO     | __main__:backfill_data:110 - Curating date 2024-10-15 (51/85)
23:11:27.665 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/alembic/config.py:598: DeprecationWarning: No path_separator found in configuration; falling back to legacy splitting on spaces, commas, and colons for prepend_sys_path.  Consider adding path_separator=os to Alembic config.
  util.warn_deprecated(

23:11:27.680 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/pydantic/v2_validated_func.py:51: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  class DecoratorBaseModel(BaseModel):

23:11:27.681 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:157: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for name, field in self.model.__fields__.items()

23:11:27.681 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:160: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  non_var_fields = set(self.model.__fields__) - {self.v_args_name, self.v_kwargs_name}

23:11:27.681 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:536: PydanticDeprecatedSince20: The private method `_iter` will be removed and should no longer be used. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for k, v in model._iter()

23:11:27.681 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields_set__` attribute is deprecated, use `model_fields_set` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:27.681 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:27.689 | INFO    | prefect.engine - Created flow run 'hulking-giraffe' for flow 'curate_data'
2025-12-22 23:11:27 | INFO     | flows.curate_data:curate_data:84 - Starting curation flow for 2024-10-15
23:11:27.701 | INFO    | Flow run 'hulking-giraffe' - Created task run 'curate_and_validate_prices-0' for task 'curate_and_validate_prices'
23:11:27.702 | INFO    | Flow run 'hulking-giraffe' - Executing 'curate_and_validate_prices-0' immediately...
2025-12-22 23:11:27 | INFO     | flows.curate_data:curate_and_validate_prices:24 - Starting price curation for 2024-10-15
2025-12-22 23:11:27 | INFO     | curation.curate_prices:curate_daily_prices:52 - Reading 25 ticker files from /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq/2024/10/15
2025-12-22 23:11:27 | INFO     | curation.curate_prices:curate_daily_prices:70 - Combined 25 rows from 25 tickers
23:11:27.728 | ERROR   | Task run 'curate_and_validate_prices-0' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:27.736 | ERROR   | Task run 'curate_and_validate_prices-0' - Finished in state Failed('Task run encountered an exception TypeError: cannot safely cast non-equivalent float64 to int64')
23:11:27.737 | ERROR   | Flow run 'hulking-giraffe' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 864, in orchestrate_flow_run
    result = await flow_call.aresult()
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 87, in curate_data
    curate_and_validate_prices(run_date_str)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/tasks.py", line 569, in __call__
    return enter_task_run_engine(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1414, in enter_task_run_engine
    return from_sync.wait_for_call_in_loop_thread(begin_run)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/api.py", line 243, in wait_for_call_in_loop_thread
    return call.result()
           ^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 284, in result
    return self.future.result(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 168, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.14_1/Frameworks/Python.framework/Versions/3.11/lib/python3.11/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 355, in _run_async
    result = await coro
             ^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1582, in get_task_call_return_value
    return await future._result()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/futures.py", line 237, in _result
    return await final_state.result(raise_on_failure=raise_on_failure, fetch=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/states.py", line 91, in _get_state_result
    raise await get_state_exception(state)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:27.744 | ERROR   | Flow run 'hulking-giraffe' - Finished in state Failed('Flow run encountered an exception. TypeError: cannot safely cast non-equivalent float64 to int64')
2025-12-22 23:11:27 | ERROR    | __main__:backfill_data:114 - Failed to curate 2024-10-15: cannot safely cast non-equivalent float64 to int64
2025-12-22 23:11:27 | INFO     | __main__:backfill_data:110 - Curating date 2024-10-16 (52/85)
23:11:27.753 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/alembic/config.py:598: DeprecationWarning: No path_separator found in configuration; falling back to legacy splitting on spaces, commas, and colons for prepend_sys_path.  Consider adding path_separator=os to Alembic config.
  util.warn_deprecated(

23:11:27.769 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/pydantic/v2_validated_func.py:51: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  class DecoratorBaseModel(BaseModel):

23:11:27.769 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:157: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for name, field in self.model.__fields__.items()

23:11:27.769 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:160: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  non_var_fields = set(self.model.__fields__) - {self.v_args_name, self.v_kwargs_name}

23:11:27.769 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:536: PydanticDeprecatedSince20: The private method `_iter` will be removed and should no longer be used. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for k, v in model._iter()

23:11:27.770 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields_set__` attribute is deprecated, use `model_fields_set` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:27.770 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:27.779 | INFO    | prefect.engine - Created flow run 'hallowed-grasshopper' for flow 'curate_data'
2025-12-22 23:11:27 | INFO     | flows.curate_data:curate_data:84 - Starting curation flow for 2024-10-16
23:11:27.791 | INFO    | Flow run 'hallowed-grasshopper' - Created task run 'curate_and_validate_prices-0' for task 'curate_and_validate_prices'
23:11:27.791 | INFO    | Flow run 'hallowed-grasshopper' - Executing 'curate_and_validate_prices-0' immediately...
2025-12-22 23:11:27 | INFO     | flows.curate_data:curate_and_validate_prices:24 - Starting price curation for 2024-10-16
2025-12-22 23:11:27 | INFO     | curation.curate_prices:curate_daily_prices:52 - Reading 25 ticker files from /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq/2024/10/16
2025-12-22 23:11:27 | INFO     | curation.curate_prices:curate_daily_prices:70 - Combined 25 rows from 25 tickers
23:11:27.815 | ERROR   | Task run 'curate_and_validate_prices-0' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:27.823 | ERROR   | Task run 'curate_and_validate_prices-0' - Finished in state Failed('Task run encountered an exception TypeError: cannot safely cast non-equivalent float64 to int64')
23:11:27.824 | ERROR   | Flow run 'hallowed-grasshopper' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 864, in orchestrate_flow_run
    result = await flow_call.aresult()
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 87, in curate_data
    curate_and_validate_prices(run_date_str)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/tasks.py", line 569, in __call__
    return enter_task_run_engine(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1414, in enter_task_run_engine
    return from_sync.wait_for_call_in_loop_thread(begin_run)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/api.py", line 243, in wait_for_call_in_loop_thread
    return call.result()
           ^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 284, in result
    return self.future.result(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 168, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.14_1/Frameworks/Python.framework/Versions/3.11/lib/python3.11/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 355, in _run_async
    result = await coro
             ^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1582, in get_task_call_return_value
    return await future._result()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/futures.py", line 237, in _result
    return await final_state.result(raise_on_failure=raise_on_failure, fetch=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/states.py", line 91, in _get_state_result
    raise await get_state_exception(state)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:27.831 | ERROR   | Flow run 'hallowed-grasshopper' - Finished in state Failed('Flow run encountered an exception. TypeError: cannot safely cast non-equivalent float64 to int64')
2025-12-22 23:11:27 | ERROR    | __main__:backfill_data:114 - Failed to curate 2024-10-16: cannot safely cast non-equivalent float64 to int64
2025-12-22 23:11:27 | INFO     | __main__:backfill_data:110 - Curating date 2024-10-17 (53/85)
23:11:27.839 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/alembic/config.py:598: DeprecationWarning: No path_separator found in configuration; falling back to legacy splitting on spaces, commas, and colons for prepend_sys_path.  Consider adding path_separator=os to Alembic config.
  util.warn_deprecated(

23:11:27.855 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/pydantic/v2_validated_func.py:51: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  class DecoratorBaseModel(BaseModel):

23:11:27.856 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:157: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for name, field in self.model.__fields__.items()

23:11:27.856 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:160: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  non_var_fields = set(self.model.__fields__) - {self.v_args_name, self.v_kwargs_name}

23:11:27.856 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:536: PydanticDeprecatedSince20: The private method `_iter` will be removed and should no longer be used. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for k, v in model._iter()

23:11:27.856 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields_set__` attribute is deprecated, use `model_fields_set` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:27.856 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:27.865 | INFO    | prefect.engine - Created flow run 'polar-groundhog' for flow 'curate_data'
2025-12-22 23:11:27 | INFO     | flows.curate_data:curate_data:84 - Starting curation flow for 2024-10-17
23:11:27.877 | INFO    | Flow run 'polar-groundhog' - Created task run 'curate_and_validate_prices-0' for task 'curate_and_validate_prices'
23:11:27.877 | INFO    | Flow run 'polar-groundhog' - Executing 'curate_and_validate_prices-0' immediately...
2025-12-22 23:11:27 | INFO     | flows.curate_data:curate_and_validate_prices:24 - Starting price curation for 2024-10-17
2025-12-22 23:11:27 | INFO     | curation.curate_prices:curate_daily_prices:52 - Reading 25 ticker files from /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq/2024/10/17
2025-12-22 23:11:27 | INFO     | curation.curate_prices:curate_daily_prices:70 - Combined 25 rows from 25 tickers
23:11:27.903 | ERROR   | Task run 'curate_and_validate_prices-0' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:27.910 | ERROR   | Task run 'curate_and_validate_prices-0' - Finished in state Failed('Task run encountered an exception TypeError: cannot safely cast non-equivalent float64 to int64')
23:11:27.911 | ERROR   | Flow run 'polar-groundhog' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 864, in orchestrate_flow_run
    result = await flow_call.aresult()
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 87, in curate_data
    curate_and_validate_prices(run_date_str)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/tasks.py", line 569, in __call__
    return enter_task_run_engine(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1414, in enter_task_run_engine
    return from_sync.wait_for_call_in_loop_thread(begin_run)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/api.py", line 243, in wait_for_call_in_loop_thread
    return call.result()
           ^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 284, in result
    return self.future.result(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 168, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.14_1/Frameworks/Python.framework/Versions/3.11/lib/python3.11/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 355, in _run_async
    result = await coro
             ^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1582, in get_task_call_return_value
    return await future._result()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/futures.py", line 237, in _result
    return await final_state.result(raise_on_failure=raise_on_failure, fetch=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/states.py", line 91, in _get_state_result
    raise await get_state_exception(state)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:27.918 | ERROR   | Flow run 'polar-groundhog' - Finished in state Failed('Flow run encountered an exception. TypeError: cannot safely cast non-equivalent float64 to int64')
2025-12-22 23:11:27 | ERROR    | __main__:backfill_data:114 - Failed to curate 2024-10-17: cannot safely cast non-equivalent float64 to int64
2025-12-22 23:11:27 | INFO     | __main__:backfill_data:110 - Curating date 2024-10-18 (54/85)
23:11:27.928 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/alembic/config.py:598: DeprecationWarning: No path_separator found in configuration; falling back to legacy splitting on spaces, commas, and colons for prepend_sys_path.  Consider adding path_separator=os to Alembic config.
  util.warn_deprecated(

23:11:27.943 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/pydantic/v2_validated_func.py:51: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  class DecoratorBaseModel(BaseModel):

23:11:27.943 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:157: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for name, field in self.model.__fields__.items()

23:11:27.943 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:160: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  non_var_fields = set(self.model.__fields__) - {self.v_args_name, self.v_kwargs_name}

23:11:27.944 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:536: PydanticDeprecatedSince20: The private method `_iter` will be removed and should no longer be used. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for k, v in model._iter()

23:11:27.944 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields_set__` attribute is deprecated, use `model_fields_set` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:27.944 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:27.953 | INFO    | prefect.engine - Created flow run 'chirpy-adder' for flow 'curate_data'
2025-12-22 23:11:27 | INFO     | flows.curate_data:curate_data:84 - Starting curation flow for 2024-10-18
23:11:27.965 | INFO    | Flow run 'chirpy-adder' - Created task run 'curate_and_validate_prices-0' for task 'curate_and_validate_prices'
23:11:27.965 | INFO    | Flow run 'chirpy-adder' - Executing 'curate_and_validate_prices-0' immediately...
2025-12-22 23:11:27 | INFO     | flows.curate_data:curate_and_validate_prices:24 - Starting price curation for 2024-10-18
2025-12-22 23:11:27 | INFO     | curation.curate_prices:curate_daily_prices:52 - Reading 25 ticker files from /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq/2024/10/18
2025-12-22 23:11:27 | INFO     | curation.curate_prices:curate_daily_prices:70 - Combined 25 rows from 25 tickers
23:11:27.990 | ERROR   | Task run 'curate_and_validate_prices-0' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:27.997 | ERROR   | Task run 'curate_and_validate_prices-0' - Finished in state Failed('Task run encountered an exception TypeError: cannot safely cast non-equivalent float64 to int64')
23:11:27.998 | ERROR   | Flow run 'chirpy-adder' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 864, in orchestrate_flow_run
    result = await flow_call.aresult()
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 87, in curate_data
    curate_and_validate_prices(run_date_str)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/tasks.py", line 569, in __call__
    return enter_task_run_engine(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1414, in enter_task_run_engine
    return from_sync.wait_for_call_in_loop_thread(begin_run)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/api.py", line 243, in wait_for_call_in_loop_thread
    return call.result()
           ^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 284, in result
    return self.future.result(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 168, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.14_1/Frameworks/Python.framework/Versions/3.11/lib/python3.11/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 355, in _run_async
    result = await coro
             ^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1582, in get_task_call_return_value
    return await future._result()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/futures.py", line 237, in _result
    return await final_state.result(raise_on_failure=raise_on_failure, fetch=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/states.py", line 91, in _get_state_result
    raise await get_state_exception(state)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:28.006 | ERROR   | Flow run 'chirpy-adder' - Finished in state Failed('Flow run encountered an exception. TypeError: cannot safely cast non-equivalent float64 to int64')
2025-12-22 23:11:28 | ERROR    | __main__:backfill_data:114 - Failed to curate 2024-10-18: cannot safely cast non-equivalent float64 to int64
2025-12-22 23:11:28 | INFO     | __main__:backfill_data:110 - Curating date 2024-10-21 (55/85)
23:11:28.014 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/alembic/config.py:598: DeprecationWarning: No path_separator found in configuration; falling back to legacy splitting on spaces, commas, and colons for prepend_sys_path.  Consider adding path_separator=os to Alembic config.
  util.warn_deprecated(

23:11:28.030 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/pydantic/v2_validated_func.py:51: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  class DecoratorBaseModel(BaseModel):

23:11:28.031 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:157: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for name, field in self.model.__fields__.items()

23:11:28.031 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:160: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  non_var_fields = set(self.model.__fields__) - {self.v_args_name, self.v_kwargs_name}

23:11:28.031 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:536: PydanticDeprecatedSince20: The private method `_iter` will be removed and should no longer be used. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for k, v in model._iter()

23:11:28.031 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields_set__` attribute is deprecated, use `model_fields_set` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:28.031 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:28.040 | INFO    | prefect.engine - Created flow run 'sandy-ermine' for flow 'curate_data'
2025-12-22 23:11:28 | INFO     | flows.curate_data:curate_data:84 - Starting curation flow for 2024-10-21
23:11:28.052 | INFO    | Flow run 'sandy-ermine' - Created task run 'curate_and_validate_prices-0' for task 'curate_and_validate_prices'
23:11:28.052 | INFO    | Flow run 'sandy-ermine' - Executing 'curate_and_validate_prices-0' immediately...
2025-12-22 23:11:28 | INFO     | flows.curate_data:curate_and_validate_prices:24 - Starting price curation for 2024-10-21
2025-12-22 23:11:28 | INFO     | curation.curate_prices:curate_daily_prices:52 - Reading 25 ticker files from /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq/2024/10/21
2025-12-22 23:11:28 | INFO     | curation.curate_prices:curate_daily_prices:70 - Combined 25 rows from 25 tickers
23:11:28.077 | ERROR   | Task run 'curate_and_validate_prices-0' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:28.085 | ERROR   | Task run 'curate_and_validate_prices-0' - Finished in state Failed('Task run encountered an exception TypeError: cannot safely cast non-equivalent float64 to int64')
23:11:28.086 | ERROR   | Flow run 'sandy-ermine' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 864, in orchestrate_flow_run
    result = await flow_call.aresult()
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 87, in curate_data
    curate_and_validate_prices(run_date_str)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/tasks.py", line 569, in __call__
    return enter_task_run_engine(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1414, in enter_task_run_engine
    return from_sync.wait_for_call_in_loop_thread(begin_run)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/api.py", line 243, in wait_for_call_in_loop_thread
    return call.result()
           ^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 284, in result
    return self.future.result(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 168, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.14_1/Frameworks/Python.framework/Versions/3.11/lib/python3.11/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 355, in _run_async
    result = await coro
             ^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1582, in get_task_call_return_value
    return await future._result()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/futures.py", line 237, in _result
    return await final_state.result(raise_on_failure=raise_on_failure, fetch=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/states.py", line 91, in _get_state_result
    raise await get_state_exception(state)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:28.093 | ERROR   | Flow run 'sandy-ermine' - Finished in state Failed('Flow run encountered an exception. TypeError: cannot safely cast non-equivalent float64 to int64')
2025-12-22 23:11:28 | ERROR    | __main__:backfill_data:114 - Failed to curate 2024-10-21: cannot safely cast non-equivalent float64 to int64
2025-12-22 23:11:28 | INFO     | __main__:backfill_data:110 - Curating date 2024-10-22 (56/85)
23:11:28.102 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/alembic/config.py:598: DeprecationWarning: No path_separator found in configuration; falling back to legacy splitting on spaces, commas, and colons for prepend_sys_path.  Consider adding path_separator=os to Alembic config.
  util.warn_deprecated(

23:11:28.117 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/pydantic/v2_validated_func.py:51: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  class DecoratorBaseModel(BaseModel):

23:11:28.117 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:157: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for name, field in self.model.__fields__.items()

23:11:28.117 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:160: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  non_var_fields = set(self.model.__fields__) - {self.v_args_name, self.v_kwargs_name}

23:11:28.118 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:536: PydanticDeprecatedSince20: The private method `_iter` will be removed and should no longer be used. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for k, v in model._iter()

23:11:28.118 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields_set__` attribute is deprecated, use `model_fields_set` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:28.118 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:28.127 | INFO    | prefect.engine - Created flow run 'debonair-nautilus' for flow 'curate_data'
2025-12-22 23:11:28 | INFO     | flows.curate_data:curate_data:84 - Starting curation flow for 2024-10-22
23:11:28.139 | INFO    | Flow run 'debonair-nautilus' - Created task run 'curate_and_validate_prices-0' for task 'curate_and_validate_prices'
23:11:28.139 | INFO    | Flow run 'debonair-nautilus' - Executing 'curate_and_validate_prices-0' immediately...
2025-12-22 23:11:28 | INFO     | flows.curate_data:curate_and_validate_prices:24 - Starting price curation for 2024-10-22
2025-12-22 23:11:28 | INFO     | curation.curate_prices:curate_daily_prices:52 - Reading 25 ticker files from /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq/2024/10/22
2025-12-22 23:11:28 | INFO     | curation.curate_prices:curate_daily_prices:70 - Combined 25 rows from 25 tickers
23:11:28.163 | ERROR   | Task run 'curate_and_validate_prices-0' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:28.171 | ERROR   | Task run 'curate_and_validate_prices-0' - Finished in state Failed('Task run encountered an exception TypeError: cannot safely cast non-equivalent float64 to int64')
23:11:28.172 | ERROR   | Flow run 'debonair-nautilus' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 864, in orchestrate_flow_run
    result = await flow_call.aresult()
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 87, in curate_data
    curate_and_validate_prices(run_date_str)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/tasks.py", line 569, in __call__
    return enter_task_run_engine(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1414, in enter_task_run_engine
    return from_sync.wait_for_call_in_loop_thread(begin_run)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/api.py", line 243, in wait_for_call_in_loop_thread
    return call.result()
           ^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 284, in result
    return self.future.result(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 168, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.14_1/Frameworks/Python.framework/Versions/3.11/lib/python3.11/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 355, in _run_async
    result = await coro
             ^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1582, in get_task_call_return_value
    return await future._result()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/futures.py", line 237, in _result
    return await final_state.result(raise_on_failure=raise_on_failure, fetch=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/states.py", line 91, in _get_state_result
    raise await get_state_exception(state)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:28.180 | ERROR   | Flow run 'debonair-nautilus' - Finished in state Failed('Flow run encountered an exception. TypeError: cannot safely cast non-equivalent float64 to int64')
2025-12-22 23:11:28 | ERROR    | __main__:backfill_data:114 - Failed to curate 2024-10-22: cannot safely cast non-equivalent float64 to int64
2025-12-22 23:11:28 | INFO     | __main__:backfill_data:110 - Curating date 2024-10-23 (57/85)
23:11:28.188 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/alembic/config.py:598: DeprecationWarning: No path_separator found in configuration; falling back to legacy splitting on spaces, commas, and colons for prepend_sys_path.  Consider adding path_separator=os to Alembic config.
  util.warn_deprecated(

23:11:28.204 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/pydantic/v2_validated_func.py:51: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  class DecoratorBaseModel(BaseModel):

23:11:28.204 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:157: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for name, field in self.model.__fields__.items()

23:11:28.204 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:160: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  non_var_fields = set(self.model.__fields__) - {self.v_args_name, self.v_kwargs_name}

23:11:28.204 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:536: PydanticDeprecatedSince20: The private method `_iter` will be removed and should no longer be used. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for k, v in model._iter()

23:11:28.204 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields_set__` attribute is deprecated, use `model_fields_set` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:28.205 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:28.213 | INFO    | prefect.engine - Created flow run 'notorious-grasshopper' for flow 'curate_data'
2025-12-22 23:11:28 | INFO     | flows.curate_data:curate_data:84 - Starting curation flow for 2024-10-23
23:11:28.226 | INFO    | Flow run 'notorious-grasshopper' - Created task run 'curate_and_validate_prices-0' for task 'curate_and_validate_prices'
23:11:28.226 | INFO    | Flow run 'notorious-grasshopper' - Executing 'curate_and_validate_prices-0' immediately...
2025-12-22 23:11:28 | INFO     | flows.curate_data:curate_and_validate_prices:24 - Starting price curation for 2024-10-23
2025-12-22 23:11:28 | INFO     | curation.curate_prices:curate_daily_prices:52 - Reading 25 ticker files from /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq/2024/10/23
2025-12-22 23:11:28 | INFO     | curation.curate_prices:curate_daily_prices:70 - Combined 25 rows from 25 tickers
23:11:28.252 | ERROR   | Task run 'curate_and_validate_prices-0' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:28.261 | ERROR   | Task run 'curate_and_validate_prices-0' - Finished in state Failed('Task run encountered an exception TypeError: cannot safely cast non-equivalent float64 to int64')
23:11:28.261 | ERROR   | Flow run 'notorious-grasshopper' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 864, in orchestrate_flow_run
    result = await flow_call.aresult()
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 87, in curate_data
    curate_and_validate_prices(run_date_str)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/tasks.py", line 569, in __call__
    return enter_task_run_engine(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1414, in enter_task_run_engine
    return from_sync.wait_for_call_in_loop_thread(begin_run)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/api.py", line 243, in wait_for_call_in_loop_thread
    return call.result()
           ^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 284, in result
    return self.future.result(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 168, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.14_1/Frameworks/Python.framework/Versions/3.11/lib/python3.11/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 355, in _run_async
    result = await coro
             ^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1582, in get_task_call_return_value
    return await future._result()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/futures.py", line 237, in _result
    return await final_state.result(raise_on_failure=raise_on_failure, fetch=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/states.py", line 91, in _get_state_result
    raise await get_state_exception(state)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:28.269 | ERROR   | Flow run 'notorious-grasshopper' - Finished in state Failed('Flow run encountered an exception. TypeError: cannot safely cast non-equivalent float64 to int64')
2025-12-22 23:11:28 | ERROR    | __main__:backfill_data:114 - Failed to curate 2024-10-23: cannot safely cast non-equivalent float64 to int64
2025-12-22 23:11:28 | INFO     | __main__:backfill_data:110 - Curating date 2024-10-24 (58/85)
23:11:28.278 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/alembic/config.py:598: DeprecationWarning: No path_separator found in configuration; falling back to legacy splitting on spaces, commas, and colons for prepend_sys_path.  Consider adding path_separator=os to Alembic config.
  util.warn_deprecated(

23:11:28.296 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/pydantic/v2_validated_func.py:51: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  class DecoratorBaseModel(BaseModel):

23:11:28.296 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:157: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for name, field in self.model.__fields__.items()

23:11:28.296 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:160: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  non_var_fields = set(self.model.__fields__) - {self.v_args_name, self.v_kwargs_name}

23:11:28.297 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:536: PydanticDeprecatedSince20: The private method `_iter` will be removed and should no longer be used. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for k, v in model._iter()

23:11:28.297 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields_set__` attribute is deprecated, use `model_fields_set` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:28.297 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:28.306 | INFO    | prefect.engine - Created flow run 'annoying-jaguarundi' for flow 'curate_data'
2025-12-22 23:11:28 | INFO     | flows.curate_data:curate_data:84 - Starting curation flow for 2024-10-24
23:11:28.320 | INFO    | Flow run 'annoying-jaguarundi' - Created task run 'curate_and_validate_prices-0' for task 'curate_and_validate_prices'
23:11:28.320 | INFO    | Flow run 'annoying-jaguarundi' - Executing 'curate_and_validate_prices-0' immediately...
2025-12-22 23:11:28 | INFO     | flows.curate_data:curate_and_validate_prices:24 - Starting price curation for 2024-10-24
2025-12-22 23:11:28 | INFO     | curation.curate_prices:curate_daily_prices:52 - Reading 25 ticker files from /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq/2024/10/24
2025-12-22 23:11:28 | INFO     | curation.curate_prices:curate_daily_prices:70 - Combined 25 rows from 25 tickers
23:11:28.344 | ERROR   | Task run 'curate_and_validate_prices-0' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:28.352 | ERROR   | Task run 'curate_and_validate_prices-0' - Finished in state Failed('Task run encountered an exception TypeError: cannot safely cast non-equivalent float64 to int64')
23:11:28.352 | ERROR   | Flow run 'annoying-jaguarundi' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 864, in orchestrate_flow_run
    result = await flow_call.aresult()
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 87, in curate_data
    curate_and_validate_prices(run_date_str)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/tasks.py", line 569, in __call__
    return enter_task_run_engine(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1414, in enter_task_run_engine
    return from_sync.wait_for_call_in_loop_thread(begin_run)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/api.py", line 243, in wait_for_call_in_loop_thread
    return call.result()
           ^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 284, in result
    return self.future.result(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 168, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.14_1/Frameworks/Python.framework/Versions/3.11/lib/python3.11/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 355, in _run_async
    result = await coro
             ^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1582, in get_task_call_return_value
    return await future._result()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/futures.py", line 237, in _result
    return await final_state.result(raise_on_failure=raise_on_failure, fetch=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/states.py", line 91, in _get_state_result
    raise await get_state_exception(state)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:28.360 | ERROR   | Flow run 'annoying-jaguarundi' - Finished in state Failed('Flow run encountered an exception. TypeError: cannot safely cast non-equivalent float64 to int64')
2025-12-22 23:11:28 | ERROR    | __main__:backfill_data:114 - Failed to curate 2024-10-24: cannot safely cast non-equivalent float64 to int64
2025-12-22 23:11:28 | INFO     | __main__:backfill_data:110 - Curating date 2024-10-25 (59/85)
23:11:28.369 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/alembic/config.py:598: DeprecationWarning: No path_separator found in configuration; falling back to legacy splitting on spaces, commas, and colons for prepend_sys_path.  Consider adding path_separator=os to Alembic config.
  util.warn_deprecated(

23:11:28.383 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/pydantic/v2_validated_func.py:51: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  class DecoratorBaseModel(BaseModel):

23:11:28.384 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:157: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for name, field in self.model.__fields__.items()

23:11:28.384 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:160: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  non_var_fields = set(self.model.__fields__) - {self.v_args_name, self.v_kwargs_name}

23:11:28.384 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:536: PydanticDeprecatedSince20: The private method `_iter` will be removed and should no longer be used. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for k, v in model._iter()

23:11:28.384 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields_set__` attribute is deprecated, use `model_fields_set` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:28.384 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:28.393 | INFO    | prefect.engine - Created flow run 'heavenly-whippet' for flow 'curate_data'
2025-12-22 23:11:28 | INFO     | flows.curate_data:curate_data:84 - Starting curation flow for 2024-10-25
23:11:28.405 | INFO    | Flow run 'heavenly-whippet' - Created task run 'curate_and_validate_prices-0' for task 'curate_and_validate_prices'
23:11:28.406 | INFO    | Flow run 'heavenly-whippet' - Executing 'curate_and_validate_prices-0' immediately...
2025-12-22 23:11:28 | INFO     | flows.curate_data:curate_and_validate_prices:24 - Starting price curation for 2024-10-25
2025-12-22 23:11:28 | INFO     | curation.curate_prices:curate_daily_prices:52 - Reading 25 ticker files from /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq/2024/10/25
2025-12-22 23:11:28 | INFO     | curation.curate_prices:curate_daily_prices:70 - Combined 25 rows from 25 tickers
23:11:28.431 | ERROR   | Task run 'curate_and_validate_prices-0' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:28.439 | ERROR   | Task run 'curate_and_validate_prices-0' - Finished in state Failed('Task run encountered an exception TypeError: cannot safely cast non-equivalent float64 to int64')
23:11:28.440 | ERROR   | Flow run 'heavenly-whippet' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 864, in orchestrate_flow_run
    result = await flow_call.aresult()
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 87, in curate_data
    curate_and_validate_prices(run_date_str)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/tasks.py", line 569, in __call__
    return enter_task_run_engine(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1414, in enter_task_run_engine
    return from_sync.wait_for_call_in_loop_thread(begin_run)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/api.py", line 243, in wait_for_call_in_loop_thread
    return call.result()
           ^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 284, in result
    return self.future.result(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 168, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.14_1/Frameworks/Python.framework/Versions/3.11/lib/python3.11/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 355, in _run_async
    result = await coro
             ^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1582, in get_task_call_return_value
    return await future._result()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/futures.py", line 237, in _result
    return await final_state.result(raise_on_failure=raise_on_failure, fetch=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/states.py", line 91, in _get_state_result
    raise await get_state_exception(state)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:28.447 | ERROR   | Flow run 'heavenly-whippet' - Finished in state Failed('Flow run encountered an exception. TypeError: cannot safely cast non-equivalent float64 to int64')
2025-12-22 23:11:28 | ERROR    | __main__:backfill_data:114 - Failed to curate 2024-10-25: cannot safely cast non-equivalent float64 to int64
2025-12-22 23:11:28 | INFO     | __main__:backfill_data:110 - Curating date 2024-10-28 (60/85)
23:11:28.456 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/alembic/config.py:598: DeprecationWarning: No path_separator found in configuration; falling back to legacy splitting on spaces, commas, and colons for prepend_sys_path.  Consider adding path_separator=os to Alembic config.
  util.warn_deprecated(

23:11:28.471 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/pydantic/v2_validated_func.py:51: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  class DecoratorBaseModel(BaseModel):

23:11:28.472 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:157: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for name, field in self.model.__fields__.items()

23:11:28.472 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:160: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  non_var_fields = set(self.model.__fields__) - {self.v_args_name, self.v_kwargs_name}

23:11:28.472 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:536: PydanticDeprecatedSince20: The private method `_iter` will be removed and should no longer be used. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for k, v in model._iter()

23:11:28.472 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields_set__` attribute is deprecated, use `model_fields_set` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:28.472 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:28.480 | INFO    | prefect.engine - Created flow run 'small-boar' for flow 'curate_data'
2025-12-22 23:11:28 | INFO     | flows.curate_data:curate_data:84 - Starting curation flow for 2024-10-28
23:11:28.493 | INFO    | Flow run 'small-boar' - Created task run 'curate_and_validate_prices-0' for task 'curate_and_validate_prices'
23:11:28.493 | INFO    | Flow run 'small-boar' - Executing 'curate_and_validate_prices-0' immediately...
2025-12-22 23:11:28 | INFO     | flows.curate_data:curate_and_validate_prices:24 - Starting price curation for 2024-10-28
2025-12-22 23:11:28 | INFO     | curation.curate_prices:curate_daily_prices:52 - Reading 25 ticker files from /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq/2024/10/28
2025-12-22 23:11:28 | INFO     | curation.curate_prices:curate_daily_prices:70 - Combined 25 rows from 25 tickers
23:11:28.518 | ERROR   | Task run 'curate_and_validate_prices-0' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:28.527 | ERROR   | Task run 'curate_and_validate_prices-0' - Finished in state Failed('Task run encountered an exception TypeError: cannot safely cast non-equivalent float64 to int64')
23:11:28.527 | ERROR   | Flow run 'small-boar' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 864, in orchestrate_flow_run
    result = await flow_call.aresult()
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 87, in curate_data
    curate_and_validate_prices(run_date_str)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/tasks.py", line 569, in __call__
    return enter_task_run_engine(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1414, in enter_task_run_engine
    return from_sync.wait_for_call_in_loop_thread(begin_run)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/api.py", line 243, in wait_for_call_in_loop_thread
    return call.result()
           ^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 284, in result
    return self.future.result(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 168, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.14_1/Frameworks/Python.framework/Versions/3.11/lib/python3.11/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 355, in _run_async
    result = await coro
             ^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1582, in get_task_call_return_value
    return await future._result()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/futures.py", line 237, in _result
    return await final_state.result(raise_on_failure=raise_on_failure, fetch=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/states.py", line 91, in _get_state_result
    raise await get_state_exception(state)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:28.535 | ERROR   | Flow run 'small-boar' - Finished in state Failed('Flow run encountered an exception. TypeError: cannot safely cast non-equivalent float64 to int64')
2025-12-22 23:11:28 | ERROR    | __main__:backfill_data:114 - Failed to curate 2024-10-28: cannot safely cast non-equivalent float64 to int64
2025-12-22 23:11:28 | INFO     | __main__:backfill_data:110 - Curating date 2024-10-29 (61/85)
23:11:28.544 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/alembic/config.py:598: DeprecationWarning: No path_separator found in configuration; falling back to legacy splitting on spaces, commas, and colons for prepend_sys_path.  Consider adding path_separator=os to Alembic config.
  util.warn_deprecated(

23:11:28.560 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/pydantic/v2_validated_func.py:51: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  class DecoratorBaseModel(BaseModel):

23:11:28.560 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:157: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for name, field in self.model.__fields__.items()

23:11:28.561 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:160: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  non_var_fields = set(self.model.__fields__) - {self.v_args_name, self.v_kwargs_name}

23:11:28.561 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:536: PydanticDeprecatedSince20: The private method `_iter` will be removed and should no longer be used. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for k, v in model._iter()

23:11:28.561 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields_set__` attribute is deprecated, use `model_fields_set` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:28.561 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:28.570 | INFO    | prefect.engine - Created flow run 'frisky-ammonite' for flow 'curate_data'
2025-12-22 23:11:28 | INFO     | flows.curate_data:curate_data:84 - Starting curation flow for 2024-10-29
23:11:28.583 | INFO    | Flow run 'frisky-ammonite' - Created task run 'curate_and_validate_prices-0' for task 'curate_and_validate_prices'
23:11:28.583 | INFO    | Flow run 'frisky-ammonite' - Executing 'curate_and_validate_prices-0' immediately...
2025-12-22 23:11:28 | INFO     | flows.curate_data:curate_and_validate_prices:24 - Starting price curation for 2024-10-29
2025-12-22 23:11:28 | INFO     | curation.curate_prices:curate_daily_prices:52 - Reading 25 ticker files from /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq/2024/10/29
2025-12-22 23:11:28 | INFO     | curation.curate_prices:curate_daily_prices:70 - Combined 25 rows from 25 tickers
23:11:28.609 | ERROR   | Task run 'curate_and_validate_prices-0' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:28.617 | ERROR   | Task run 'curate_and_validate_prices-0' - Finished in state Failed('Task run encountered an exception TypeError: cannot safely cast non-equivalent float64 to int64')
23:11:28.618 | ERROR   | Flow run 'frisky-ammonite' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 864, in orchestrate_flow_run
    result = await flow_call.aresult()
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 87, in curate_data
    curate_and_validate_prices(run_date_str)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/tasks.py", line 569, in __call__
    return enter_task_run_engine(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1414, in enter_task_run_engine
    return from_sync.wait_for_call_in_loop_thread(begin_run)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/api.py", line 243, in wait_for_call_in_loop_thread
    return call.result()
           ^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 284, in result
    return self.future.result(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 168, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.14_1/Frameworks/Python.framework/Versions/3.11/lib/python3.11/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 355, in _run_async
    result = await coro
             ^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1582, in get_task_call_return_value
    return await future._result()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/futures.py", line 237, in _result
    return await final_state.result(raise_on_failure=raise_on_failure, fetch=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/states.py", line 91, in _get_state_result
    raise await get_state_exception(state)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:28.625 | ERROR   | Flow run 'frisky-ammonite' - Finished in state Failed('Flow run encountered an exception. TypeError: cannot safely cast non-equivalent float64 to int64')
2025-12-22 23:11:28 | ERROR    | __main__:backfill_data:114 - Failed to curate 2024-10-29: cannot safely cast non-equivalent float64 to int64
2025-12-22 23:11:28 | INFO     | __main__:backfill_data:110 - Curating date 2024-10-30 (62/85)
23:11:28.634 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/alembic/config.py:598: DeprecationWarning: No path_separator found in configuration; falling back to legacy splitting on spaces, commas, and colons for prepend_sys_path.  Consider adding path_separator=os to Alembic config.
  util.warn_deprecated(

23:11:28.650 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/pydantic/v2_validated_func.py:51: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  class DecoratorBaseModel(BaseModel):

23:11:28.650 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:157: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for name, field in self.model.__fields__.items()

23:11:28.651 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:160: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  non_var_fields = set(self.model.__fields__) - {self.v_args_name, self.v_kwargs_name}

23:11:28.651 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:536: PydanticDeprecatedSince20: The private method `_iter` will be removed and should no longer be used. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for k, v in model._iter()

23:11:28.651 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields_set__` attribute is deprecated, use `model_fields_set` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:28.651 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:28.659 | INFO    | prefect.engine - Created flow run 'teal-gharial' for flow 'curate_data'
2025-12-22 23:11:28 | INFO     | flows.curate_data:curate_data:84 - Starting curation flow for 2024-10-30
23:11:28.671 | INFO    | Flow run 'teal-gharial' - Created task run 'curate_and_validate_prices-0' for task 'curate_and_validate_prices'
23:11:28.671 | INFO    | Flow run 'teal-gharial' - Executing 'curate_and_validate_prices-0' immediately...
2025-12-22 23:11:28 | INFO     | flows.curate_data:curate_and_validate_prices:24 - Starting price curation for 2024-10-30
2025-12-22 23:11:28 | INFO     | curation.curate_prices:curate_daily_prices:52 - Reading 25 ticker files from /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq/2024/10/30
2025-12-22 23:11:28 | INFO     | curation.curate_prices:curate_daily_prices:70 - Combined 25 rows from 25 tickers
23:11:28.697 | ERROR   | Task run 'curate_and_validate_prices-0' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:28.706 | ERROR   | Task run 'curate_and_validate_prices-0' - Finished in state Failed('Task run encountered an exception TypeError: cannot safely cast non-equivalent float64 to int64')
23:11:28.706 | ERROR   | Flow run 'teal-gharial' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 864, in orchestrate_flow_run
    result = await flow_call.aresult()
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 87, in curate_data
    curate_and_validate_prices(run_date_str)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/tasks.py", line 569, in __call__
    return enter_task_run_engine(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1414, in enter_task_run_engine
    return from_sync.wait_for_call_in_loop_thread(begin_run)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/api.py", line 243, in wait_for_call_in_loop_thread
    return call.result()
           ^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 284, in result
    return self.future.result(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 168, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.14_1/Frameworks/Python.framework/Versions/3.11/lib/python3.11/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 355, in _run_async
    result = await coro
             ^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1582, in get_task_call_return_value
    return await future._result()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/futures.py", line 237, in _result
    return await final_state.result(raise_on_failure=raise_on_failure, fetch=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/states.py", line 91, in _get_state_result
    raise await get_state_exception(state)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:28.713 | ERROR   | Flow run 'teal-gharial' - Finished in state Failed('Flow run encountered an exception. TypeError: cannot safely cast non-equivalent float64 to int64')
2025-12-22 23:11:28 | ERROR    | __main__:backfill_data:114 - Failed to curate 2024-10-30: cannot safely cast non-equivalent float64 to int64
2025-12-22 23:11:28 | INFO     | __main__:backfill_data:110 - Curating date 2024-10-31 (63/85)
23:11:28.722 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/alembic/config.py:598: DeprecationWarning: No path_separator found in configuration; falling back to legacy splitting on spaces, commas, and colons for prepend_sys_path.  Consider adding path_separator=os to Alembic config.
  util.warn_deprecated(

23:11:28.737 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/pydantic/v2_validated_func.py:51: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  class DecoratorBaseModel(BaseModel):

23:11:28.738 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:157: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for name, field in self.model.__fields__.items()

23:11:28.738 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:160: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  non_var_fields = set(self.model.__fields__) - {self.v_args_name, self.v_kwargs_name}

23:11:28.738 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:536: PydanticDeprecatedSince20: The private method `_iter` will be removed and should no longer be used. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for k, v in model._iter()

23:11:28.738 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields_set__` attribute is deprecated, use `model_fields_set` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:28.738 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:28.747 | INFO    | prefect.engine - Created flow run 'lumpy-gharial' for flow 'curate_data'
2025-12-22 23:11:28 | INFO     | flows.curate_data:curate_data:84 - Starting curation flow for 2024-10-31
23:11:28.760 | INFO    | Flow run 'lumpy-gharial' - Created task run 'curate_and_validate_prices-0' for task 'curate_and_validate_prices'
23:11:28.760 | INFO    | Flow run 'lumpy-gharial' - Executing 'curate_and_validate_prices-0' immediately...
2025-12-22 23:11:28 | INFO     | flows.curate_data:curate_and_validate_prices:24 - Starting price curation for 2024-10-31
2025-12-22 23:11:28 | INFO     | curation.curate_prices:curate_daily_prices:52 - Reading 25 ticker files from /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq/2024/10/31
2025-12-22 23:11:28 | INFO     | curation.curate_prices:curate_daily_prices:70 - Combined 25 rows from 25 tickers
23:11:28.786 | ERROR   | Task run 'curate_and_validate_prices-0' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:28.793 | ERROR   | Task run 'curate_and_validate_prices-0' - Finished in state Failed('Task run encountered an exception TypeError: cannot safely cast non-equivalent float64 to int64')
23:11:28.794 | ERROR   | Flow run 'lumpy-gharial' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 864, in orchestrate_flow_run
    result = await flow_call.aresult()
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 87, in curate_data
    curate_and_validate_prices(run_date_str)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/tasks.py", line 569, in __call__
    return enter_task_run_engine(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1414, in enter_task_run_engine
    return from_sync.wait_for_call_in_loop_thread(begin_run)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/api.py", line 243, in wait_for_call_in_loop_thread
    return call.result()
           ^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 284, in result
    return self.future.result(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 168, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.14_1/Frameworks/Python.framework/Versions/3.11/lib/python3.11/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 355, in _run_async
    result = await coro
             ^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1582, in get_task_call_return_value
    return await future._result()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/futures.py", line 237, in _result
    return await final_state.result(raise_on_failure=raise_on_failure, fetch=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/states.py", line 91, in _get_state_result
    raise await get_state_exception(state)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:28.801 | ERROR   | Flow run 'lumpy-gharial' - Finished in state Failed('Flow run encountered an exception. TypeError: cannot safely cast non-equivalent float64 to int64')
2025-12-22 23:11:28 | ERROR    | __main__:backfill_data:114 - Failed to curate 2024-10-31: cannot safely cast non-equivalent float64 to int64
2025-12-22 23:11:28 | INFO     | __main__:backfill_data:110 - Curating date 2024-11-01 (64/85)
23:11:28.809 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/alembic/config.py:598: DeprecationWarning: No path_separator found in configuration; falling back to legacy splitting on spaces, commas, and colons for prepend_sys_path.  Consider adding path_separator=os to Alembic config.
  util.warn_deprecated(

23:11:28.824 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/pydantic/v2_validated_func.py:51: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  class DecoratorBaseModel(BaseModel):

23:11:28.825 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:157: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for name, field in self.model.__fields__.items()

23:11:28.825 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:160: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  non_var_fields = set(self.model.__fields__) - {self.v_args_name, self.v_kwargs_name}

23:11:28.825 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:536: PydanticDeprecatedSince20: The private method `_iter` will be removed and should no longer be used. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for k, v in model._iter()

23:11:28.825 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields_set__` attribute is deprecated, use `model_fields_set` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:28.825 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:28.836 | INFO    | prefect.engine - Created flow run 'accomplished-parrot' for flow 'curate_data'
2025-12-22 23:11:28 | INFO     | flows.curate_data:curate_data:84 - Starting curation flow for 2024-11-01
23:11:28.849 | INFO    | Flow run 'accomplished-parrot' - Created task run 'curate_and_validate_prices-0' for task 'curate_and_validate_prices'
23:11:28.849 | INFO    | Flow run 'accomplished-parrot' - Executing 'curate_and_validate_prices-0' immediately...
2025-12-22 23:11:28 | INFO     | flows.curate_data:curate_and_validate_prices:24 - Starting price curation for 2024-11-01
2025-12-22 23:11:28 | INFO     | curation.curate_prices:curate_daily_prices:52 - Reading 25 ticker files from /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq/2024/11/01
2025-12-22 23:11:28 | INFO     | curation.curate_prices:curate_daily_prices:70 - Combined 25 rows from 25 tickers
23:11:28.874 | ERROR   | Task run 'curate_and_validate_prices-0' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:28.882 | ERROR   | Task run 'curate_and_validate_prices-0' - Finished in state Failed('Task run encountered an exception TypeError: cannot safely cast non-equivalent float64 to int64')
23:11:28.882 | ERROR   | Flow run 'accomplished-parrot' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 864, in orchestrate_flow_run
    result = await flow_call.aresult()
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 87, in curate_data
    curate_and_validate_prices(run_date_str)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/tasks.py", line 569, in __call__
    return enter_task_run_engine(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1414, in enter_task_run_engine
    return from_sync.wait_for_call_in_loop_thread(begin_run)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/api.py", line 243, in wait_for_call_in_loop_thread
    return call.result()
           ^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 284, in result
    return self.future.result(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 168, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.14_1/Frameworks/Python.framework/Versions/3.11/lib/python3.11/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 355, in _run_async
    result = await coro
             ^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1582, in get_task_call_return_value
    return await future._result()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/futures.py", line 237, in _result
    return await final_state.result(raise_on_failure=raise_on_failure, fetch=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/states.py", line 91, in _get_state_result
    raise await get_state_exception(state)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:28.890 | ERROR   | Flow run 'accomplished-parrot' - Finished in state Failed('Flow run encountered an exception. TypeError: cannot safely cast non-equivalent float64 to int64')
2025-12-22 23:11:28 | ERROR    | __main__:backfill_data:114 - Failed to curate 2024-11-01: cannot safely cast non-equivalent float64 to int64
2025-12-22 23:11:28 | INFO     | __main__:backfill_data:110 - Curating date 2024-11-04 (65/85)
23:11:28.899 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/alembic/config.py:598: DeprecationWarning: No path_separator found in configuration; falling back to legacy splitting on spaces, commas, and colons for prepend_sys_path.  Consider adding path_separator=os to Alembic config.
  util.warn_deprecated(

23:11:28.914 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/pydantic/v2_validated_func.py:51: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  class DecoratorBaseModel(BaseModel):

23:11:28.915 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:157: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for name, field in self.model.__fields__.items()

23:11:28.915 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:160: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  non_var_fields = set(self.model.__fields__) - {self.v_args_name, self.v_kwargs_name}

23:11:28.915 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:536: PydanticDeprecatedSince20: The private method `_iter` will be removed and should no longer be used. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for k, v in model._iter()

23:11:28.915 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields_set__` attribute is deprecated, use `model_fields_set` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:28.915 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:28.924 | INFO    | prefect.engine - Created flow run 'economic-corgi' for flow 'curate_data'
2025-12-22 23:11:28 | INFO     | flows.curate_data:curate_data:84 - Starting curation flow for 2024-11-04
23:11:28.936 | INFO    | Flow run 'economic-corgi' - Created task run 'curate_and_validate_prices-0' for task 'curate_and_validate_prices'
23:11:28.936 | INFO    | Flow run 'economic-corgi' - Executing 'curate_and_validate_prices-0' immediately...
2025-12-22 23:11:28 | INFO     | flows.curate_data:curate_and_validate_prices:24 - Starting price curation for 2024-11-04
2025-12-22 23:11:28 | INFO     | curation.curate_prices:curate_daily_prices:52 - Reading 25 ticker files from /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq/2024/11/04
2025-12-22 23:11:28 | INFO     | curation.curate_prices:curate_daily_prices:70 - Combined 25 rows from 25 tickers
23:11:28.961 | ERROR   | Task run 'curate_and_validate_prices-0' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:28.969 | ERROR   | Task run 'curate_and_validate_prices-0' - Finished in state Failed('Task run encountered an exception TypeError: cannot safely cast non-equivalent float64 to int64')
23:11:28.969 | ERROR   | Flow run 'economic-corgi' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 864, in orchestrate_flow_run
    result = await flow_call.aresult()
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 87, in curate_data
    curate_and_validate_prices(run_date_str)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/tasks.py", line 569, in __call__
    return enter_task_run_engine(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1414, in enter_task_run_engine
    return from_sync.wait_for_call_in_loop_thread(begin_run)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/api.py", line 243, in wait_for_call_in_loop_thread
    return call.result()
           ^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 284, in result
    return self.future.result(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 168, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.14_1/Frameworks/Python.framework/Versions/3.11/lib/python3.11/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 355, in _run_async
    result = await coro
             ^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1582, in get_task_call_return_value
    return await future._result()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/futures.py", line 237, in _result
    return await final_state.result(raise_on_failure=raise_on_failure, fetch=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/states.py", line 91, in _get_state_result
    raise await get_state_exception(state)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:28.976 | ERROR   | Flow run 'economic-corgi' - Finished in state Failed('Flow run encountered an exception. TypeError: cannot safely cast non-equivalent float64 to int64')
2025-12-22 23:11:28 | ERROR    | __main__:backfill_data:114 - Failed to curate 2024-11-04: cannot safely cast non-equivalent float64 to int64
2025-12-22 23:11:28 | INFO     | __main__:backfill_data:110 - Curating date 2024-11-05 (66/85)
23:11:28.986 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/alembic/config.py:598: DeprecationWarning: No path_separator found in configuration; falling back to legacy splitting on spaces, commas, and colons for prepend_sys_path.  Consider adding path_separator=os to Alembic config.
  util.warn_deprecated(

23:11:29.001 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/pydantic/v2_validated_func.py:51: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  class DecoratorBaseModel(BaseModel):

23:11:29.002 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:157: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for name, field in self.model.__fields__.items()

23:11:29.002 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:160: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  non_var_fields = set(self.model.__fields__) - {self.v_args_name, self.v_kwargs_name}

23:11:29.002 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:536: PydanticDeprecatedSince20: The private method `_iter` will be removed and should no longer be used. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for k, v in model._iter()

23:11:29.002 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields_set__` attribute is deprecated, use `model_fields_set` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:29.002 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:29.011 | INFO    | prefect.engine - Created flow run 'serious-chital' for flow 'curate_data'
2025-12-22 23:11:29 | INFO     | flows.curate_data:curate_data:84 - Starting curation flow for 2024-11-05
23:11:29.023 | INFO    | Flow run 'serious-chital' - Created task run 'curate_and_validate_prices-0' for task 'curate_and_validate_prices'
23:11:29.023 | INFO    | Flow run 'serious-chital' - Executing 'curate_and_validate_prices-0' immediately...
2025-12-22 23:11:29 | INFO     | flows.curate_data:curate_and_validate_prices:24 - Starting price curation for 2024-11-05
2025-12-22 23:11:29 | INFO     | curation.curate_prices:curate_daily_prices:52 - Reading 25 ticker files from /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq/2024/11/05
2025-12-22 23:11:29 | INFO     | curation.curate_prices:curate_daily_prices:70 - Combined 25 rows from 25 tickers
23:11:29.047 | ERROR   | Task run 'curate_and_validate_prices-0' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:29.055 | ERROR   | Task run 'curate_and_validate_prices-0' - Finished in state Failed('Task run encountered an exception TypeError: cannot safely cast non-equivalent float64 to int64')
23:11:29.055 | ERROR   | Flow run 'serious-chital' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 864, in orchestrate_flow_run
    result = await flow_call.aresult()
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 87, in curate_data
    curate_and_validate_prices(run_date_str)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/tasks.py", line 569, in __call__
    return enter_task_run_engine(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1414, in enter_task_run_engine
    return from_sync.wait_for_call_in_loop_thread(begin_run)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/api.py", line 243, in wait_for_call_in_loop_thread
    return call.result()
           ^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 284, in result
    return self.future.result(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 168, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.14_1/Frameworks/Python.framework/Versions/3.11/lib/python3.11/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 355, in _run_async
    result = await coro
             ^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1582, in get_task_call_return_value
    return await future._result()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/futures.py", line 237, in _result
    return await final_state.result(raise_on_failure=raise_on_failure, fetch=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/states.py", line 91, in _get_state_result
    raise await get_state_exception(state)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:29.063 | ERROR   | Flow run 'serious-chital' - Finished in state Failed('Flow run encountered an exception. TypeError: cannot safely cast non-equivalent float64 to int64')
2025-12-22 23:11:29 | ERROR    | __main__:backfill_data:114 - Failed to curate 2024-11-05: cannot safely cast non-equivalent float64 to int64
2025-12-22 23:11:29 | INFO     | __main__:backfill_data:110 - Curating date 2024-11-06 (67/85)
23:11:29.071 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/alembic/config.py:598: DeprecationWarning: No path_separator found in configuration; falling back to legacy splitting on spaces, commas, and colons for prepend_sys_path.  Consider adding path_separator=os to Alembic config.
  util.warn_deprecated(

23:11:29.087 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/pydantic/v2_validated_func.py:51: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  class DecoratorBaseModel(BaseModel):

23:11:29.088 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:157: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for name, field in self.model.__fields__.items()

23:11:29.088 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:160: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  non_var_fields = set(self.model.__fields__) - {self.v_args_name, self.v_kwargs_name}

23:11:29.088 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:536: PydanticDeprecatedSince20: The private method `_iter` will be removed and should no longer be used. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for k, v in model._iter()

23:11:29.088 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields_set__` attribute is deprecated, use `model_fields_set` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:29.088 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:29.097 | INFO    | prefect.engine - Created flow run 'accurate-chihuahua' for flow 'curate_data'
2025-12-22 23:11:29 | INFO     | flows.curate_data:curate_data:84 - Starting curation flow for 2024-11-06
23:11:29.110 | INFO    | Flow run 'accurate-chihuahua' - Created task run 'curate_and_validate_prices-0' for task 'curate_and_validate_prices'
23:11:29.110 | INFO    | Flow run 'accurate-chihuahua' - Executing 'curate_and_validate_prices-0' immediately...
2025-12-22 23:11:29 | INFO     | flows.curate_data:curate_and_validate_prices:24 - Starting price curation for 2024-11-06
2025-12-22 23:11:29 | INFO     | curation.curate_prices:curate_daily_prices:52 - Reading 25 ticker files from /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq/2024/11/06
2025-12-22 23:11:29 | INFO     | curation.curate_prices:curate_daily_prices:70 - Combined 25 rows from 25 tickers
23:11:29.135 | ERROR   | Task run 'curate_and_validate_prices-0' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:29.143 | ERROR   | Task run 'curate_and_validate_prices-0' - Finished in state Failed('Task run encountered an exception TypeError: cannot safely cast non-equivalent float64 to int64')
23:11:29.143 | ERROR   | Flow run 'accurate-chihuahua' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 864, in orchestrate_flow_run
    result = await flow_call.aresult()
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 87, in curate_data
    curate_and_validate_prices(run_date_str)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/tasks.py", line 569, in __call__
    return enter_task_run_engine(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1414, in enter_task_run_engine
    return from_sync.wait_for_call_in_loop_thread(begin_run)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/api.py", line 243, in wait_for_call_in_loop_thread
    return call.result()
           ^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 284, in result
    return self.future.result(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 168, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.14_1/Frameworks/Python.framework/Versions/3.11/lib/python3.11/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 355, in _run_async
    result = await coro
             ^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1582, in get_task_call_return_value
    return await future._result()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/futures.py", line 237, in _result
    return await final_state.result(raise_on_failure=raise_on_failure, fetch=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/states.py", line 91, in _get_state_result
    raise await get_state_exception(state)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:29.151 | ERROR   | Flow run 'accurate-chihuahua' - Finished in state Failed('Flow run encountered an exception. TypeError: cannot safely cast non-equivalent float64 to int64')
2025-12-22 23:11:29 | ERROR    | __main__:backfill_data:114 - Failed to curate 2024-11-06: cannot safely cast non-equivalent float64 to int64
2025-12-22 23:11:29 | INFO     | __main__:backfill_data:110 - Curating date 2024-11-07 (68/85)
23:11:29.160 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/alembic/config.py:598: DeprecationWarning: No path_separator found in configuration; falling back to legacy splitting on spaces, commas, and colons for prepend_sys_path.  Consider adding path_separator=os to Alembic config.
  util.warn_deprecated(

23:11:29.176 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/pydantic/v2_validated_func.py:51: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  class DecoratorBaseModel(BaseModel):

23:11:29.176 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:157: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for name, field in self.model.__fields__.items()

23:11:29.176 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:160: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  non_var_fields = set(self.model.__fields__) - {self.v_args_name, self.v_kwargs_name}

23:11:29.177 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:536: PydanticDeprecatedSince20: The private method `_iter` will be removed and should no longer be used. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for k, v in model._iter()

23:11:29.177 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields_set__` attribute is deprecated, use `model_fields_set` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:29.177 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:29.185 | INFO    | prefect.engine - Created flow run 'miniature-labrador' for flow 'curate_data'
2025-12-22 23:11:29 | INFO     | flows.curate_data:curate_data:84 - Starting curation flow for 2024-11-07
23:11:29.197 | INFO    | Flow run 'miniature-labrador' - Created task run 'curate_and_validate_prices-0' for task 'curate_and_validate_prices'
23:11:29.197 | INFO    | Flow run 'miniature-labrador' - Executing 'curate_and_validate_prices-0' immediately...
2025-12-22 23:11:29 | INFO     | flows.curate_data:curate_and_validate_prices:24 - Starting price curation for 2024-11-07
2025-12-22 23:11:29 | INFO     | curation.curate_prices:curate_daily_prices:52 - Reading 25 ticker files from /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq/2024/11/07
2025-12-22 23:11:29 | INFO     | curation.curate_prices:curate_daily_prices:70 - Combined 25 rows from 25 tickers
23:11:29.221 | ERROR   | Task run 'curate_and_validate_prices-0' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:29.229 | ERROR   | Task run 'curate_and_validate_prices-0' - Finished in state Failed('Task run encountered an exception TypeError: cannot safely cast non-equivalent float64 to int64')
23:11:29.229 | ERROR   | Flow run 'miniature-labrador' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 864, in orchestrate_flow_run
    result = await flow_call.aresult()
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 87, in curate_data
    curate_and_validate_prices(run_date_str)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/tasks.py", line 569, in __call__
    return enter_task_run_engine(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1414, in enter_task_run_engine
    return from_sync.wait_for_call_in_loop_thread(begin_run)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/api.py", line 243, in wait_for_call_in_loop_thread
    return call.result()
           ^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 284, in result
    return self.future.result(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 168, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.14_1/Frameworks/Python.framework/Versions/3.11/lib/python3.11/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 355, in _run_async
    result = await coro
             ^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1582, in get_task_call_return_value
    return await future._result()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/futures.py", line 237, in _result
    return await final_state.result(raise_on_failure=raise_on_failure, fetch=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/states.py", line 91, in _get_state_result
    raise await get_state_exception(state)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:29.236 | ERROR   | Flow run 'miniature-labrador' - Finished in state Failed('Flow run encountered an exception. TypeError: cannot safely cast non-equivalent float64 to int64')
2025-12-22 23:11:29 | ERROR    | __main__:backfill_data:114 - Failed to curate 2024-11-07: cannot safely cast non-equivalent float64 to int64
2025-12-22 23:11:29 | INFO     | __main__:backfill_data:110 - Curating date 2024-11-08 (69/85)
23:11:29.245 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/alembic/config.py:598: DeprecationWarning: No path_separator found in configuration; falling back to legacy splitting on spaces, commas, and colons for prepend_sys_path.  Consider adding path_separator=os to Alembic config.
  util.warn_deprecated(

23:11:29.260 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/pydantic/v2_validated_func.py:51: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  class DecoratorBaseModel(BaseModel):

23:11:29.260 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:157: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for name, field in self.model.__fields__.items()

23:11:29.260 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:160: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  non_var_fields = set(self.model.__fields__) - {self.v_args_name, self.v_kwargs_name}

23:11:29.260 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:536: PydanticDeprecatedSince20: The private method `_iter` will be removed and should no longer be used. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for k, v in model._iter()

23:11:29.261 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields_set__` attribute is deprecated, use `model_fields_set` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:29.261 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:29.269 | INFO    | prefect.engine - Created flow run 'fanatic-puma' for flow 'curate_data'
2025-12-22 23:11:29 | INFO     | flows.curate_data:curate_data:84 - Starting curation flow for 2024-11-08
23:11:29.281 | INFO    | Flow run 'fanatic-puma' - Created task run 'curate_and_validate_prices-0' for task 'curate_and_validate_prices'
23:11:29.282 | INFO    | Flow run 'fanatic-puma' - Executing 'curate_and_validate_prices-0' immediately...
2025-12-22 23:11:29 | INFO     | flows.curate_data:curate_and_validate_prices:24 - Starting price curation for 2024-11-08
2025-12-22 23:11:29 | INFO     | curation.curate_prices:curate_daily_prices:52 - Reading 25 ticker files from /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq/2024/11/08
2025-12-22 23:11:29 | INFO     | curation.curate_prices:curate_daily_prices:70 - Combined 25 rows from 25 tickers
23:11:29.305 | ERROR   | Task run 'curate_and_validate_prices-0' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:29.313 | ERROR   | Task run 'curate_and_validate_prices-0' - Finished in state Failed('Task run encountered an exception TypeError: cannot safely cast non-equivalent float64 to int64')
23:11:29.313 | ERROR   | Flow run 'fanatic-puma' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 864, in orchestrate_flow_run
    result = await flow_call.aresult()
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 87, in curate_data
    curate_and_validate_prices(run_date_str)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/tasks.py", line 569, in __call__
    return enter_task_run_engine(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1414, in enter_task_run_engine
    return from_sync.wait_for_call_in_loop_thread(begin_run)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/api.py", line 243, in wait_for_call_in_loop_thread
    return call.result()
           ^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 284, in result
    return self.future.result(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 168, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.14_1/Frameworks/Python.framework/Versions/3.11/lib/python3.11/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 355, in _run_async
    result = await coro
             ^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1582, in get_task_call_return_value
    return await future._result()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/futures.py", line 237, in _result
    return await final_state.result(raise_on_failure=raise_on_failure, fetch=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/states.py", line 91, in _get_state_result
    raise await get_state_exception(state)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:29.321 | ERROR   | Flow run 'fanatic-puma' - Finished in state Failed('Flow run encountered an exception. TypeError: cannot safely cast non-equivalent float64 to int64')
2025-12-22 23:11:29 | ERROR    | __main__:backfill_data:114 - Failed to curate 2024-11-08: cannot safely cast non-equivalent float64 to int64
2025-12-22 23:11:29 | INFO     | __main__:backfill_data:110 - Curating date 2024-11-11 (70/85)
23:11:29.329 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/alembic/config.py:598: DeprecationWarning: No path_separator found in configuration; falling back to legacy splitting on spaces, commas, and colons for prepend_sys_path.  Consider adding path_separator=os to Alembic config.
  util.warn_deprecated(

23:11:29.345 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/pydantic/v2_validated_func.py:51: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  class DecoratorBaseModel(BaseModel):

23:11:29.345 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:157: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for name, field in self.model.__fields__.items()

23:11:29.345 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:160: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  non_var_fields = set(self.model.__fields__) - {self.v_args_name, self.v_kwargs_name}

23:11:29.346 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:536: PydanticDeprecatedSince20: The private method `_iter` will be removed and should no longer be used. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for k, v in model._iter()

23:11:29.346 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields_set__` attribute is deprecated, use `model_fields_set` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:29.346 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:29.354 | INFO    | prefect.engine - Created flow run 'heavenly-smilodon' for flow 'curate_data'
2025-12-22 23:11:29 | INFO     | flows.curate_data:curate_data:84 - Starting curation flow for 2024-11-11
23:11:29.366 | INFO    | Flow run 'heavenly-smilodon' - Created task run 'curate_and_validate_prices-0' for task 'curate_and_validate_prices'
23:11:29.366 | INFO    | Flow run 'heavenly-smilodon' - Executing 'curate_and_validate_prices-0' immediately...
2025-12-22 23:11:29 | INFO     | flows.curate_data:curate_and_validate_prices:24 - Starting price curation for 2024-11-11
2025-12-22 23:11:29 | INFO     | curation.curate_prices:curate_daily_prices:52 - Reading 25 ticker files from /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq/2024/11/11
2025-12-22 23:11:29 | INFO     | curation.curate_prices:curate_daily_prices:70 - Combined 25 rows from 25 tickers
23:11:29.392 | ERROR   | Task run 'curate_and_validate_prices-0' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:29.399 | ERROR   | Task run 'curate_and_validate_prices-0' - Finished in state Failed('Task run encountered an exception TypeError: cannot safely cast non-equivalent float64 to int64')
23:11:29.400 | ERROR   | Flow run 'heavenly-smilodon' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 864, in orchestrate_flow_run
    result = await flow_call.aresult()
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 87, in curate_data
    curate_and_validate_prices(run_date_str)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/tasks.py", line 569, in __call__
    return enter_task_run_engine(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1414, in enter_task_run_engine
    return from_sync.wait_for_call_in_loop_thread(begin_run)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/api.py", line 243, in wait_for_call_in_loop_thread
    return call.result()
           ^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 284, in result
    return self.future.result(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 168, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.14_1/Frameworks/Python.framework/Versions/3.11/lib/python3.11/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 355, in _run_async
    result = await coro
             ^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1582, in get_task_call_return_value
    return await future._result()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/futures.py", line 237, in _result
    return await final_state.result(raise_on_failure=raise_on_failure, fetch=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/states.py", line 91, in _get_state_result
    raise await get_state_exception(state)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:29.408 | ERROR   | Flow run 'heavenly-smilodon' - Finished in state Failed('Flow run encountered an exception. TypeError: cannot safely cast non-equivalent float64 to int64')
2025-12-22 23:11:29 | ERROR    | __main__:backfill_data:114 - Failed to curate 2024-11-11: cannot safely cast non-equivalent float64 to int64
2025-12-22 23:11:29 | INFO     | __main__:backfill_data:110 - Curating date 2024-11-12 (71/85)
23:11:29.416 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/alembic/config.py:598: DeprecationWarning: No path_separator found in configuration; falling back to legacy splitting on spaces, commas, and colons for prepend_sys_path.  Consider adding path_separator=os to Alembic config.
  util.warn_deprecated(

23:11:29.432 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/pydantic/v2_validated_func.py:51: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  class DecoratorBaseModel(BaseModel):

23:11:29.432 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:157: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for name, field in self.model.__fields__.items()

23:11:29.432 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:160: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  non_var_fields = set(self.model.__fields__) - {self.v_args_name, self.v_kwargs_name}

23:11:29.433 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:536: PydanticDeprecatedSince20: The private method `_iter` will be removed and should no longer be used. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for k, v in model._iter()

23:11:29.433 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields_set__` attribute is deprecated, use `model_fields_set` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:29.433 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:29.441 | INFO    | prefect.engine - Created flow run 'infrared-cormorant' for flow 'curate_data'
2025-12-22 23:11:29 | INFO     | flows.curate_data:curate_data:84 - Starting curation flow for 2024-11-12
23:11:29.455 | INFO    | Flow run 'infrared-cormorant' - Created task run 'curate_and_validate_prices-0' for task 'curate_and_validate_prices'
23:11:29.456 | INFO    | Flow run 'infrared-cormorant' - Executing 'curate_and_validate_prices-0' immediately...
2025-12-22 23:11:29 | INFO     | flows.curate_data:curate_and_validate_prices:24 - Starting price curation for 2024-11-12
2025-12-22 23:11:29 | INFO     | curation.curate_prices:curate_daily_prices:52 - Reading 25 ticker files from /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq/2024/11/12
2025-12-22 23:11:29 | INFO     | curation.curate_prices:curate_daily_prices:70 - Combined 25 rows from 25 tickers
23:11:29.480 | ERROR   | Task run 'curate_and_validate_prices-0' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:29.488 | ERROR   | Task run 'curate_and_validate_prices-0' - Finished in state Failed('Task run encountered an exception TypeError: cannot safely cast non-equivalent float64 to int64')
23:11:29.489 | ERROR   | Flow run 'infrared-cormorant' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 864, in orchestrate_flow_run
    result = await flow_call.aresult()
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 87, in curate_data
    curate_and_validate_prices(run_date_str)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/tasks.py", line 569, in __call__
    return enter_task_run_engine(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1414, in enter_task_run_engine
    return from_sync.wait_for_call_in_loop_thread(begin_run)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/api.py", line 243, in wait_for_call_in_loop_thread
    return call.result()
           ^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 284, in result
    return self.future.result(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 168, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.14_1/Frameworks/Python.framework/Versions/3.11/lib/python3.11/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 355, in _run_async
    result = await coro
             ^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1582, in get_task_call_return_value
    return await future._result()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/futures.py", line 237, in _result
    return await final_state.result(raise_on_failure=raise_on_failure, fetch=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/states.py", line 91, in _get_state_result
    raise await get_state_exception(state)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:29.496 | ERROR   | Flow run 'infrared-cormorant' - Finished in state Failed('Flow run encountered an exception. TypeError: cannot safely cast non-equivalent float64 to int64')
2025-12-22 23:11:29 | ERROR    | __main__:backfill_data:114 - Failed to curate 2024-11-12: cannot safely cast non-equivalent float64 to int64
2025-12-22 23:11:29 | INFO     | __main__:backfill_data:110 - Curating date 2024-11-13 (72/85)
23:11:29.505 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/alembic/config.py:598: DeprecationWarning: No path_separator found in configuration; falling back to legacy splitting on spaces, commas, and colons for prepend_sys_path.  Consider adding path_separator=os to Alembic config.
  util.warn_deprecated(

23:11:29.520 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/pydantic/v2_validated_func.py:51: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  class DecoratorBaseModel(BaseModel):

23:11:29.521 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:157: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for name, field in self.model.__fields__.items()

23:11:29.521 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:160: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  non_var_fields = set(self.model.__fields__) - {self.v_args_name, self.v_kwargs_name}

23:11:29.521 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:536: PydanticDeprecatedSince20: The private method `_iter` will be removed and should no longer be used. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for k, v in model._iter()

23:11:29.521 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields_set__` attribute is deprecated, use `model_fields_set` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:29.521 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:29.530 | INFO    | prefect.engine - Created flow run 'smoky-koel' for flow 'curate_data'
2025-12-22 23:11:29 | INFO     | flows.curate_data:curate_data:84 - Starting curation flow for 2024-11-13
23:11:29.542 | INFO    | Flow run 'smoky-koel' - Created task run 'curate_and_validate_prices-0' for task 'curate_and_validate_prices'
23:11:29.543 | INFO    | Flow run 'smoky-koel' - Executing 'curate_and_validate_prices-0' immediately...
2025-12-22 23:11:29 | INFO     | flows.curate_data:curate_and_validate_prices:24 - Starting price curation for 2024-11-13
2025-12-22 23:11:29 | INFO     | curation.curate_prices:curate_daily_prices:52 - Reading 25 ticker files from /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq/2024/11/13
2025-12-22 23:11:29 | INFO     | curation.curate_prices:curate_daily_prices:70 - Combined 25 rows from 25 tickers
23:11:29.566 | ERROR   | Task run 'curate_and_validate_prices-0' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:29.574 | ERROR   | Task run 'curate_and_validate_prices-0' - Finished in state Failed('Task run encountered an exception TypeError: cannot safely cast non-equivalent float64 to int64')
23:11:29.574 | ERROR   | Flow run 'smoky-koel' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 864, in orchestrate_flow_run
    result = await flow_call.aresult()
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 87, in curate_data
    curate_and_validate_prices(run_date_str)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/tasks.py", line 569, in __call__
    return enter_task_run_engine(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1414, in enter_task_run_engine
    return from_sync.wait_for_call_in_loop_thread(begin_run)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/api.py", line 243, in wait_for_call_in_loop_thread
    return call.result()
           ^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 284, in result
    return self.future.result(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 168, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.14_1/Frameworks/Python.framework/Versions/3.11/lib/python3.11/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 355, in _run_async
    result = await coro
             ^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1582, in get_task_call_return_value
    return await future._result()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/futures.py", line 237, in _result
    return await final_state.result(raise_on_failure=raise_on_failure, fetch=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/states.py", line 91, in _get_state_result
    raise await get_state_exception(state)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:29.582 | ERROR   | Flow run 'smoky-koel' - Finished in state Failed('Flow run encountered an exception. TypeError: cannot safely cast non-equivalent float64 to int64')
2025-12-22 23:11:29 | ERROR    | __main__:backfill_data:114 - Failed to curate 2024-11-13: cannot safely cast non-equivalent float64 to int64
2025-12-22 23:11:29 | INFO     | __main__:backfill_data:110 - Curating date 2024-11-14 (73/85)
23:11:29.591 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/alembic/config.py:598: DeprecationWarning: No path_separator found in configuration; falling back to legacy splitting on spaces, commas, and colons for prepend_sys_path.  Consider adding path_separator=os to Alembic config.
  util.warn_deprecated(

23:11:29.606 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/pydantic/v2_validated_func.py:51: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  class DecoratorBaseModel(BaseModel):

23:11:29.606 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:157: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for name, field in self.model.__fields__.items()

23:11:29.607 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:160: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  non_var_fields = set(self.model.__fields__) - {self.v_args_name, self.v_kwargs_name}

23:11:29.607 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:536: PydanticDeprecatedSince20: The private method `_iter` will be removed and should no longer be used. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for k, v in model._iter()

23:11:29.607 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields_set__` attribute is deprecated, use `model_fields_set` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:29.607 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:29.615 | INFO    | prefect.engine - Created flow run 'precise-collie' for flow 'curate_data'
2025-12-22 23:11:29 | INFO     | flows.curate_data:curate_data:84 - Starting curation flow for 2024-11-14
23:11:29.627 | INFO    | Flow run 'precise-collie' - Created task run 'curate_and_validate_prices-0' for task 'curate_and_validate_prices'
23:11:29.627 | INFO    | Flow run 'precise-collie' - Executing 'curate_and_validate_prices-0' immediately...
2025-12-22 23:11:29 | INFO     | flows.curate_data:curate_and_validate_prices:24 - Starting price curation for 2024-11-14
2025-12-22 23:11:29 | INFO     | curation.curate_prices:curate_daily_prices:52 - Reading 25 ticker files from /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq/2024/11/14
2025-12-22 23:11:29 | INFO     | curation.curate_prices:curate_daily_prices:70 - Combined 25 rows from 25 tickers
23:11:29.652 | ERROR   | Task run 'curate_and_validate_prices-0' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:29.659 | ERROR   | Task run 'curate_and_validate_prices-0' - Finished in state Failed('Task run encountered an exception TypeError: cannot safely cast non-equivalent float64 to int64')
23:11:29.659 | ERROR   | Flow run 'precise-collie' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 864, in orchestrate_flow_run
    result = await flow_call.aresult()
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 87, in curate_data
    curate_and_validate_prices(run_date_str)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/tasks.py", line 569, in __call__
    return enter_task_run_engine(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1414, in enter_task_run_engine
    return from_sync.wait_for_call_in_loop_thread(begin_run)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/api.py", line 243, in wait_for_call_in_loop_thread
    return call.result()
           ^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 284, in result
    return self.future.result(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 168, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.14_1/Frameworks/Python.framework/Versions/3.11/lib/python3.11/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 355, in _run_async
    result = await coro
             ^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1582, in get_task_call_return_value
    return await future._result()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/futures.py", line 237, in _result
    return await final_state.result(raise_on_failure=raise_on_failure, fetch=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/states.py", line 91, in _get_state_result
    raise await get_state_exception(state)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:29.666 | ERROR   | Flow run 'precise-collie' - Finished in state Failed('Flow run encountered an exception. TypeError: cannot safely cast non-equivalent float64 to int64')
2025-12-22 23:11:29 | ERROR    | __main__:backfill_data:114 - Failed to curate 2024-11-14: cannot safely cast non-equivalent float64 to int64
2025-12-22 23:11:29 | INFO     | __main__:backfill_data:110 - Curating date 2024-11-15 (74/85)
23:11:29.675 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/alembic/config.py:598: DeprecationWarning: No path_separator found in configuration; falling back to legacy splitting on spaces, commas, and colons for prepend_sys_path.  Consider adding path_separator=os to Alembic config.
  util.warn_deprecated(

23:11:29.690 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/pydantic/v2_validated_func.py:51: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  class DecoratorBaseModel(BaseModel):

23:11:29.691 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:157: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for name, field in self.model.__fields__.items()

23:11:29.691 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:160: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  non_var_fields = set(self.model.__fields__) - {self.v_args_name, self.v_kwargs_name}

23:11:29.691 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:536: PydanticDeprecatedSince20: The private method `_iter` will be removed and should no longer be used. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for k, v in model._iter()

23:11:29.691 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields_set__` attribute is deprecated, use `model_fields_set` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:29.691 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:29.700 | INFO    | prefect.engine - Created flow run 'debonair-cormorant' for flow 'curate_data'
2025-12-22 23:11:29 | INFO     | flows.curate_data:curate_data:84 - Starting curation flow for 2024-11-15
23:11:29.712 | INFO    | Flow run 'debonair-cormorant' - Created task run 'curate_and_validate_prices-0' for task 'curate_and_validate_prices'
23:11:29.713 | INFO    | Flow run 'debonair-cormorant' - Executing 'curate_and_validate_prices-0' immediately...
2025-12-22 23:11:29 | INFO     | flows.curate_data:curate_and_validate_prices:24 - Starting price curation for 2024-11-15
2025-12-22 23:11:29 | INFO     | curation.curate_prices:curate_daily_prices:52 - Reading 25 ticker files from /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq/2024/11/15
2025-12-22 23:11:29 | INFO     | curation.curate_prices:curate_daily_prices:70 - Combined 25 rows from 25 tickers
23:11:29.737 | ERROR   | Task run 'curate_and_validate_prices-0' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:29.744 | ERROR   | Task run 'curate_and_validate_prices-0' - Finished in state Failed('Task run encountered an exception TypeError: cannot safely cast non-equivalent float64 to int64')
23:11:29.744 | ERROR   | Flow run 'debonair-cormorant' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 864, in orchestrate_flow_run
    result = await flow_call.aresult()
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 87, in curate_data
    curate_and_validate_prices(run_date_str)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/tasks.py", line 569, in __call__
    return enter_task_run_engine(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1414, in enter_task_run_engine
    return from_sync.wait_for_call_in_loop_thread(begin_run)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/api.py", line 243, in wait_for_call_in_loop_thread
    return call.result()
           ^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 284, in result
    return self.future.result(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 168, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.14_1/Frameworks/Python.framework/Versions/3.11/lib/python3.11/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 355, in _run_async
    result = await coro
             ^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1582, in get_task_call_return_value
    return await future._result()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/futures.py", line 237, in _result
    return await final_state.result(raise_on_failure=raise_on_failure, fetch=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/states.py", line 91, in _get_state_result
    raise await get_state_exception(state)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:29.752 | ERROR   | Flow run 'debonair-cormorant' - Finished in state Failed('Flow run encountered an exception. TypeError: cannot safely cast non-equivalent float64 to int64')
2025-12-22 23:11:29 | ERROR    | __main__:backfill_data:114 - Failed to curate 2024-11-15: cannot safely cast non-equivalent float64 to int64
2025-12-22 23:11:29 | INFO     | __main__:backfill_data:110 - Curating date 2024-11-18 (75/85)
23:11:29.761 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/alembic/config.py:598: DeprecationWarning: No path_separator found in configuration; falling back to legacy splitting on spaces, commas, and colons for prepend_sys_path.  Consider adding path_separator=os to Alembic config.
  util.warn_deprecated(

23:11:29.776 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/pydantic/v2_validated_func.py:51: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  class DecoratorBaseModel(BaseModel):

23:11:29.777 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:157: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for name, field in self.model.__fields__.items()

23:11:29.777 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:160: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  non_var_fields = set(self.model.__fields__) - {self.v_args_name, self.v_kwargs_name}

23:11:29.777 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:536: PydanticDeprecatedSince20: The private method `_iter` will be removed and should no longer be used. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for k, v in model._iter()

23:11:29.777 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields_set__` attribute is deprecated, use `model_fields_set` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:29.777 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:29.785 | INFO    | prefect.engine - Created flow run 'pistachio-jaguar' for flow 'curate_data'
2025-12-22 23:11:29 | INFO     | flows.curate_data:curate_data:84 - Starting curation flow for 2024-11-18
23:11:29.797 | INFO    | Flow run 'pistachio-jaguar' - Created task run 'curate_and_validate_prices-0' for task 'curate_and_validate_prices'
23:11:29.797 | INFO    | Flow run 'pistachio-jaguar' - Executing 'curate_and_validate_prices-0' immediately...
2025-12-22 23:11:29 | INFO     | flows.curate_data:curate_and_validate_prices:24 - Starting price curation for 2024-11-18
2025-12-22 23:11:29 | INFO     | curation.curate_prices:curate_daily_prices:52 - Reading 25 ticker files from /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq/2024/11/18
2025-12-22 23:11:30 | INFO     | curation.curate_prices:curate_daily_prices:70 - Combined 25 rows from 25 tickers
23:11:30.027 | ERROR   | Task run 'curate_and_validate_prices-0' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:30.039 | ERROR   | Task run 'curate_and_validate_prices-0' - Finished in state Failed('Task run encountered an exception TypeError: cannot safely cast non-equivalent float64 to int64')
23:11:30.040 | ERROR   | Flow run 'pistachio-jaguar' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 864, in orchestrate_flow_run
    result = await flow_call.aresult()
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 87, in curate_data
    curate_and_validate_prices(run_date_str)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/tasks.py", line 569, in __call__
    return enter_task_run_engine(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1414, in enter_task_run_engine
    return from_sync.wait_for_call_in_loop_thread(begin_run)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/api.py", line 243, in wait_for_call_in_loop_thread
    return call.result()
           ^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 284, in result
    return self.future.result(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 168, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.14_1/Frameworks/Python.framework/Versions/3.11/lib/python3.11/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 355, in _run_async
    result = await coro
             ^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1582, in get_task_call_return_value
    return await future._result()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/futures.py", line 237, in _result
    return await final_state.result(raise_on_failure=raise_on_failure, fetch=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/states.py", line 91, in _get_state_result
    raise await get_state_exception(state)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:30.047 | ERROR   | Flow run 'pistachio-jaguar' - Finished in state Failed('Flow run encountered an exception. TypeError: cannot safely cast non-equivalent float64 to int64')
2025-12-22 23:11:30 | ERROR    | __main__:backfill_data:114 - Failed to curate 2024-11-18: cannot safely cast non-equivalent float64 to int64
2025-12-22 23:11:30 | INFO     | __main__:backfill_data:110 - Curating date 2024-11-19 (76/85)
23:11:30.056 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/alembic/config.py:598: DeprecationWarning: No path_separator found in configuration; falling back to legacy splitting on spaces, commas, and colons for prepend_sys_path.  Consider adding path_separator=os to Alembic config.
  util.warn_deprecated(

23:11:30.071 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/pydantic/v2_validated_func.py:51: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  class DecoratorBaseModel(BaseModel):

23:11:30.072 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:157: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for name, field in self.model.__fields__.items()

23:11:30.072 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:160: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  non_var_fields = set(self.model.__fields__) - {self.v_args_name, self.v_kwargs_name}

23:11:30.072 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:536: PydanticDeprecatedSince20: The private method `_iter` will be removed and should no longer be used. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for k, v in model._iter()

23:11:30.072 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields_set__` attribute is deprecated, use `model_fields_set` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:30.072 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:30.081 | INFO    | prefect.engine - Created flow run 'eccentric-partridge' for flow 'curate_data'
2025-12-22 23:11:30 | INFO     | flows.curate_data:curate_data:84 - Starting curation flow for 2024-11-19
23:11:30.093 | INFO    | Flow run 'eccentric-partridge' - Created task run 'curate_and_validate_prices-0' for task 'curate_and_validate_prices'
23:11:30.094 | INFO    | Flow run 'eccentric-partridge' - Executing 'curate_and_validate_prices-0' immediately...
2025-12-22 23:11:30 | INFO     | flows.curate_data:curate_and_validate_prices:24 - Starting price curation for 2024-11-19
2025-12-22 23:11:30 | INFO     | curation.curate_prices:curate_daily_prices:52 - Reading 25 ticker files from /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq/2024/11/19
2025-12-22 23:11:30 | INFO     | curation.curate_prices:curate_daily_prices:70 - Combined 25 rows from 25 tickers
23:11:30.117 | ERROR   | Task run 'curate_and_validate_prices-0' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:30.125 | ERROR   | Task run 'curate_and_validate_prices-0' - Finished in state Failed('Task run encountered an exception TypeError: cannot safely cast non-equivalent float64 to int64')
23:11:30.126 | ERROR   | Flow run 'eccentric-partridge' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 864, in orchestrate_flow_run
    result = await flow_call.aresult()
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 87, in curate_data
    curate_and_validate_prices(run_date_str)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/tasks.py", line 569, in __call__
    return enter_task_run_engine(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1414, in enter_task_run_engine
    return from_sync.wait_for_call_in_loop_thread(begin_run)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/api.py", line 243, in wait_for_call_in_loop_thread
    return call.result()
           ^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 284, in result
    return self.future.result(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 168, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.14_1/Frameworks/Python.framework/Versions/3.11/lib/python3.11/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 355, in _run_async
    result = await coro
             ^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1582, in get_task_call_return_value
    return await future._result()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/futures.py", line 237, in _result
    return await final_state.result(raise_on_failure=raise_on_failure, fetch=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/states.py", line 91, in _get_state_result
    raise await get_state_exception(state)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:30.134 | ERROR   | Flow run 'eccentric-partridge' - Finished in state Failed('Flow run encountered an exception. TypeError: cannot safely cast non-equivalent float64 to int64')
2025-12-22 23:11:30 | ERROR    | __main__:backfill_data:114 - Failed to curate 2024-11-19: cannot safely cast non-equivalent float64 to int64
2025-12-22 23:11:30 | INFO     | __main__:backfill_data:110 - Curating date 2024-11-20 (77/85)
23:11:30.142 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/alembic/config.py:598: DeprecationWarning: No path_separator found in configuration; falling back to legacy splitting on spaces, commas, and colons for prepend_sys_path.  Consider adding path_separator=os to Alembic config.
  util.warn_deprecated(

23:11:30.158 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/pydantic/v2_validated_func.py:51: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  class DecoratorBaseModel(BaseModel):

23:11:30.158 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:157: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for name, field in self.model.__fields__.items()

23:11:30.158 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:160: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  non_var_fields = set(self.model.__fields__) - {self.v_args_name, self.v_kwargs_name}

23:11:30.158 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:536: PydanticDeprecatedSince20: The private method `_iter` will be removed and should no longer be used. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for k, v in model._iter()

23:11:30.158 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields_set__` attribute is deprecated, use `model_fields_set` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:30.159 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:30.167 | INFO    | prefect.engine - Created flow run 'towering-aardwolf' for flow 'curate_data'
2025-12-22 23:11:30 | INFO     | flows.curate_data:curate_data:84 - Starting curation flow for 2024-11-20
23:11:30.180 | INFO    | Flow run 'towering-aardwolf' - Created task run 'curate_and_validate_prices-0' for task 'curate_and_validate_prices'
23:11:30.180 | INFO    | Flow run 'towering-aardwolf' - Executing 'curate_and_validate_prices-0' immediately...
2025-12-22 23:11:30 | INFO     | flows.curate_data:curate_and_validate_prices:24 - Starting price curation for 2024-11-20
2025-12-22 23:11:30 | INFO     | curation.curate_prices:curate_daily_prices:52 - Reading 25 ticker files from /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq/2024/11/20
2025-12-22 23:11:30 | INFO     | curation.curate_prices:curate_daily_prices:70 - Combined 25 rows from 25 tickers
23:11:30.204 | ERROR   | Task run 'curate_and_validate_prices-0' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:30.211 | ERROR   | Task run 'curate_and_validate_prices-0' - Finished in state Failed('Task run encountered an exception TypeError: cannot safely cast non-equivalent float64 to int64')
23:11:30.212 | ERROR   | Flow run 'towering-aardwolf' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 53, in _safe_cast
    return values.astype(dtype, casting="safe", copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Cannot cast array data from dtype('float64') to dtype('int64') according to the rule 'safe'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 864, in orchestrate_flow_run
    result = await flow_call.aresult()
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 87, in curate_data
    curate_and_validate_prices(run_date_str)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/tasks.py", line 569, in __call__
    return enter_task_run_engine(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1414, in enter_task_run_engine
    return from_sync.wait_for_call_in_loop_thread(begin_run)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/api.py", line 243, in wait_for_call_in_loop_thread
    return call.result()
           ^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 284, in result
    return self.future.result(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 168, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.14_1/Frameworks/Python.framework/Versions/3.11/lib/python3.11/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 355, in _run_async
    result = await coro
             ^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 1582, in get_task_call_return_value
    return await future._result()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/futures.py", line 237, in _result
    return await final_state.result(raise_on_failure=raise_on_failure, fetch=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/states.py", line 91, in _get_state_result
    raise await get_state_exception(state)
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/engine.py", line 2121, in orchestrate_task_run
    result = await call.aresult()
             ^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 293, in aresult
    return await asyncio.wrap_future(self.future)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/concurrency/calls.py", line 318, in _run_sync
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/flows/curate_data.py", line 27, in curate_and_validate_prices
    curated_df = curate_daily_prices(run_dt)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/src/curation/curate_prices.py", line 85, in curate_daily_prices
    combined["volume"] = pd.to_numeric(combined["volume"], errors="coerce").astype("Int64")  # Nullable int
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/generic.py", line 6643, in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 430, in astype
    return self.apply(
           ^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/managers.py", line 363, in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/internals/blocks.py", line 758, in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 237, in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 182, in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/dtypes/astype.py", line 80, in _astype_nansafe
    return dtype.construct_array_type()._from_sequence(arr, dtype=dtype, copy=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/masked.py", line 152, in _from_sequence
    values, mask = cls._coerce_to_array(scalars, dtype=dtype, copy=copy)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 272, in _coerce_to_array
    values, mask, _, _ = _coerce_to_data_and_mask(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/numeric.py", line 229, in _coerce_to_data_and_mask
    values = dtype_cls._safe_cast(values, dtype, copy=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pandas/core/arrays/integer.py", line 59, in _safe_cast
    raise TypeError(
TypeError: cannot safely cast non-equivalent float64 to int64
23:11:30.219 | ERROR   | Flow run 'towering-aardwolf' - Finished in state Failed('Flow run encountered an exception. TypeError: cannot safely cast non-equivalent float64 to int64')
2025-12-22 23:11:30 | ERROR    | __main__:backfill_data:114 - Failed to curate 2024-11-20: cannot safely cast non-equivalent float64 to int64
2025-12-22 23:11:30 | INFO     | __main__:backfill_data:110 - Curating date 2024-11-21 (78/85)
23:11:30.228 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/alembic/config.py:598: DeprecationWarning: No path_separator found in configuration; falling back to legacy splitting on spaces, commas, and colons for prepend_sys_path.  Consider adding path_separator=os to Alembic config.
  util.warn_deprecated(

23:11:30.244 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/pydantic/v2_validated_func.py:51: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  class DecoratorBaseModel(BaseModel):

23:11:30.245 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:157: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for name, field in self.model.__fields__.items()

23:11:30.245 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:160: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  non_var_fields = set(self.model.__fields__) - {self.v_args_name, self.v_kwargs_name}

23:11:30.245 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:536: PydanticDeprecatedSince20: The private method `_iter` will be removed and should no longer be used. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for k, v in model._iter()

23:11:30.245 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields_set__` attribute is deprecated, use `model_fields_set` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:30.245 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:30.254 | INFO    | prefect.engine - Created flow run 'dark-ape' for flow 'curate_data'
2025-12-22 23:11:30 | INFO     | flows.curate_data:curate_data:84 - Starting curation flow for 2024-11-21
23:11:30.265 | INFO    | Flow run 'dark-ape' - Created task run 'curate_and_validate_prices-0' for task 'curate_and_validate_prices'
23:11:30.266 | INFO    | Flow run 'dark-ape' - Executing 'curate_and_validate_prices-0' immediately...
2025-12-22 23:11:30 | INFO     | flows.curate_data:curate_and_validate_prices:24 - Starting price curation for 2024-11-21
2025-12-22 23:11:30 | INFO     | curation.curate_prices:curate_daily_prices:52 - Reading 25 ticker files from /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq/2024/11/21
2025-12-22 23:11:30 | INFO     | curation.curate_prices:curate_daily_prices:70 - Combined 25 rows from 25 tickers
2025-12-22 23:11:30 | INFO     | curation.curate_prices:curate_daily_prices:131 - Saved curated prices for 1 date(s) including 2024-11-21 (25 rows for run_date, 25 tickers)
2025-12-22 23:11:30 | INFO     | curation.validate_prices:validate_daily_prices:127 - Validation passed for 25 rows
2025-12-22 23:11:30 | INFO     | db.duckdb_client:__init__:24 - Connected to DuckDB: /Users/nimratsandhu/repos/mosaic/data/marts/duckdb/mosaic.duckdb
2025-12-22 23:11:30 | INFO     | db.duckdb_client:create_schema:33 - Schema 'curated' ready
2025-12-22 23:11:30 | INFO     | db.load_curated:load_curated_prices_to_db:67 - Upserted prices for 2024-11-21 into DuckDB table 'curated.daily_prices'
2025-12-22 23:11:30 | INFO     | db.duckdb_client:close:105 - DuckDB connection closed
2025-12-22 23:11:30 | INFO     | flows.curate_data:curate_and_validate_prices:50 - Completed price curation for 2024-11-21
23:11:30.399 | INFO    | Task run 'curate_and_validate_prices-0' - Finished in state Completed()
23:11:30.404 | INFO    | Flow run 'dark-ape' - Created task run 'curate_fundamentals-0' for task 'curate_fundamentals'
23:11:30.404 | INFO    | Flow run 'dark-ape' - Executing 'curate_fundamentals-0' immediately...
2025-12-22 23:11:30 | INFO     | flows.curate_data:curate_fundamentals:59 - Starting fundamentals curation for 2024-11-21
2025-12-22 23:11:30 | INFO     | curation.curate_fundamentals:curate_quarterly_fundamentals:59 - Reading 26 manifest files from /Users/nimratsandhu/repos/mosaic/data/raw/fundamentals_sec/2024/Q4
2025-12-22 23:11:30 | WARNING  | curation.curate_fundamentals:curate_quarterly_fundamentals:72 - No valid fundamentals data found for 2024/Q4
2025-12-22 23:11:30 | WARNING  | flows.curate_data:curate_fundamentals:65 - No fundamentals data to curate for 2024-11-21
23:11:30.432 | INFO    | Task run 'curate_fundamentals-0' - Finished in state Completed()
2025-12-22 23:11:30 | INFO     | flows.curate_data:curate_data:92 - Completed curation flow for 2024-11-21
23:11:30.439 | INFO    | Flow run 'dark-ape' - Finished in state Completed('All states completed.')
2025-12-22 23:11:30 | INFO     | __main__:backfill_data:110 - Curating date 2024-11-22 (79/85)
23:11:30.448 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/alembic/config.py:598: DeprecationWarning: No path_separator found in configuration; falling back to legacy splitting on spaces, commas, and colons for prepend_sys_path.  Consider adding path_separator=os to Alembic config.
  util.warn_deprecated(

23:11:30.464 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/pydantic/v2_validated_func.py:51: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  class DecoratorBaseModel(BaseModel):

23:11:30.465 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:157: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for name, field in self.model.__fields__.items()

23:11:30.465 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:160: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  non_var_fields = set(self.model.__fields__) - {self.v_args_name, self.v_kwargs_name}

23:11:30.465 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:536: PydanticDeprecatedSince20: The private method `_iter` will be removed and should no longer be used. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for k, v in model._iter()

23:11:30.465 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields_set__` attribute is deprecated, use `model_fields_set` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:30.465 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:30.475 | INFO    | prefect.engine - Created flow run 'marigold-gharial' for flow 'curate_data'
2025-12-22 23:11:30 | INFO     | flows.curate_data:curate_data:84 - Starting curation flow for 2024-11-22
23:11:30.489 | INFO    | Flow run 'marigold-gharial' - Created task run 'curate_and_validate_prices-0' for task 'curate_and_validate_prices'
23:11:30.489 | INFO    | Flow run 'marigold-gharial' - Executing 'curate_and_validate_prices-0' immediately...
2025-12-22 23:11:30 | INFO     | flows.curate_data:curate_and_validate_prices:24 - Starting price curation for 2024-11-22
2025-12-22 23:11:30 | INFO     | curation.curate_prices:curate_daily_prices:52 - Reading 25 ticker files from /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq/2024/11/22
2025-12-22 23:11:30 | INFO     | curation.curate_prices:curate_daily_prices:70 - Combined 25 rows from 25 tickers
2025-12-22 23:11:30 | INFO     | curation.curate_prices:curate_daily_prices:131 - Saved curated prices for 1 date(s) including 2024-11-22 (25 rows for run_date, 25 tickers)
2025-12-22 23:11:30 | INFO     | curation.validate_prices:validate_daily_prices:127 - Validation passed for 25 rows
2025-12-22 23:11:30 | INFO     | db.duckdb_client:__init__:24 - Connected to DuckDB: /Users/nimratsandhu/repos/mosaic/data/marts/duckdb/mosaic.duckdb
2025-12-22 23:11:30 | INFO     | db.duckdb_client:create_schema:33 - Schema 'curated' ready
2025-12-22 23:11:30 | INFO     | db.load_curated:load_curated_prices_to_db:67 - Upserted prices for 2024-11-22 into DuckDB table 'curated.daily_prices'
2025-12-22 23:11:30 | INFO     | db.duckdb_client:close:105 - DuckDB connection closed
2025-12-22 23:11:30 | INFO     | flows.curate_data:curate_and_validate_prices:50 - Completed price curation for 2024-11-22
23:11:30.539 | INFO    | Task run 'curate_and_validate_prices-0' - Finished in state Completed()
23:11:30.543 | INFO    | Flow run 'marigold-gharial' - Created task run 'curate_fundamentals-0' for task 'curate_fundamentals'
23:11:30.544 | INFO    | Flow run 'marigold-gharial' - Executing 'curate_fundamentals-0' immediately...
2025-12-22 23:11:30 | INFO     | flows.curate_data:curate_fundamentals:59 - Starting fundamentals curation for 2024-11-22
2025-12-22 23:11:30 | INFO     | curation.curate_fundamentals:curate_quarterly_fundamentals:59 - Reading 26 manifest files from /Users/nimratsandhu/repos/mosaic/data/raw/fundamentals_sec/2024/Q4
2025-12-22 23:11:30 | WARNING  | curation.curate_fundamentals:curate_quarterly_fundamentals:72 - No valid fundamentals data found for 2024/Q4
2025-12-22 23:11:30 | WARNING  | flows.curate_data:curate_fundamentals:65 - No fundamentals data to curate for 2024-11-22
23:11:30.565 | INFO    | Task run 'curate_fundamentals-0' - Finished in state Completed()
2025-12-22 23:11:30 | INFO     | flows.curate_data:curate_data:92 - Completed curation flow for 2024-11-22
23:11:30.572 | INFO    | Flow run 'marigold-gharial' - Finished in state Completed('All states completed.')
2025-12-22 23:11:30 | INFO     | __main__:backfill_data:110 - Curating date 2024-11-25 (80/85)
23:11:30.583 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/alembic/config.py:598: DeprecationWarning: No path_separator found in configuration; falling back to legacy splitting on spaces, commas, and colons for prepend_sys_path.  Consider adding path_separator=os to Alembic config.
  util.warn_deprecated(

23:11:30.598 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/pydantic/v2_validated_func.py:51: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  class DecoratorBaseModel(BaseModel):

23:11:30.599 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:157: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for name, field in self.model.__fields__.items()

23:11:30.599 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:160: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  non_var_fields = set(self.model.__fields__) - {self.v_args_name, self.v_kwargs_name}

23:11:30.599 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:536: PydanticDeprecatedSince20: The private method `_iter` will be removed and should no longer be used. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for k, v in model._iter()

23:11:30.599 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields_set__` attribute is deprecated, use `model_fields_set` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:30.600 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:30.608 | INFO    | prefect.engine - Created flow run 'noisy-pig' for flow 'curate_data'
2025-12-22 23:11:30 | INFO     | flows.curate_data:curate_data:84 - Starting curation flow for 2024-11-25
23:11:30.621 | INFO    | Flow run 'noisy-pig' - Created task run 'curate_and_validate_prices-0' for task 'curate_and_validate_prices'
23:11:30.621 | INFO    | Flow run 'noisy-pig' - Executing 'curate_and_validate_prices-0' immediately...
2025-12-22 23:11:30 | INFO     | flows.curate_data:curate_and_validate_prices:24 - Starting price curation for 2024-11-25
2025-12-22 23:11:30 | INFO     | curation.curate_prices:curate_daily_prices:52 - Reading 25 ticker files from /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq/2024/11/25
2025-12-22 23:11:30 | INFO     | curation.curate_prices:curate_daily_prices:70 - Combined 25 rows from 25 tickers
2025-12-22 23:11:30 | INFO     | curation.curate_prices:curate_daily_prices:131 - Saved curated prices for 1 date(s) including 2024-11-25 (25 rows for run_date, 25 tickers)
2025-12-22 23:11:30 | INFO     | curation.validate_prices:validate_daily_prices:127 - Validation passed for 25 rows
2025-12-22 23:11:30 | INFO     | db.duckdb_client:__init__:24 - Connected to DuckDB: /Users/nimratsandhu/repos/mosaic/data/marts/duckdb/mosaic.duckdb
2025-12-22 23:11:30 | INFO     | db.duckdb_client:create_schema:33 - Schema 'curated' ready
2025-12-22 23:11:30 | INFO     | db.load_curated:load_curated_prices_to_db:67 - Upserted prices for 2024-11-25 into DuckDB table 'curated.daily_prices'
2025-12-22 23:11:30 | INFO     | db.duckdb_client:close:105 - DuckDB connection closed
2025-12-22 23:11:30 | INFO     | flows.curate_data:curate_and_validate_prices:50 - Completed price curation for 2024-11-25
23:11:30.671 | INFO    | Task run 'curate_and_validate_prices-0' - Finished in state Completed()
23:11:30.676 | INFO    | Flow run 'noisy-pig' - Created task run 'curate_fundamentals-0' for task 'curate_fundamentals'
23:11:30.676 | INFO    | Flow run 'noisy-pig' - Executing 'curate_fundamentals-0' immediately...
2025-12-22 23:11:30 | INFO     | flows.curate_data:curate_fundamentals:59 - Starting fundamentals curation for 2024-11-25
2025-12-22 23:11:30 | INFO     | curation.curate_fundamentals:curate_quarterly_fundamentals:59 - Reading 26 manifest files from /Users/nimratsandhu/repos/mosaic/data/raw/fundamentals_sec/2024/Q4
2025-12-22 23:11:30 | WARNING  | curation.curate_fundamentals:curate_quarterly_fundamentals:72 - No valid fundamentals data found for 2024/Q4
2025-12-22 23:11:30 | WARNING  | flows.curate_data:curate_fundamentals:65 - No fundamentals data to curate for 2024-11-25
23:11:30.698 | INFO    | Task run 'curate_fundamentals-0' - Finished in state Completed()
2025-12-22 23:11:30 | INFO     | flows.curate_data:curate_data:92 - Completed curation flow for 2024-11-25
23:11:30.704 | INFO    | Flow run 'noisy-pig' - Finished in state Completed('All states completed.')
2025-12-22 23:11:30 | INFO     | __main__:backfill_data:110 - Curating date 2024-11-26 (81/85)
23:11:30.713 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/alembic/config.py:598: DeprecationWarning: No path_separator found in configuration; falling back to legacy splitting on spaces, commas, and colons for prepend_sys_path.  Consider adding path_separator=os to Alembic config.
  util.warn_deprecated(

23:11:30.729 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/pydantic/v2_validated_func.py:51: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  class DecoratorBaseModel(BaseModel):

23:11:30.729 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:157: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for name, field in self.model.__fields__.items()

23:11:30.729 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:160: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  non_var_fields = set(self.model.__fields__) - {self.v_args_name, self.v_kwargs_name}

23:11:30.730 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:536: PydanticDeprecatedSince20: The private method `_iter` will be removed and should no longer be used. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for k, v in model._iter()

23:11:30.730 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields_set__` attribute is deprecated, use `model_fields_set` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:30.730 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:30.739 | INFO    | prefect.engine - Created flow run 'authentic-manatee' for flow 'curate_data'
2025-12-22 23:11:30 | INFO     | flows.curate_data:curate_data:84 - Starting curation flow for 2024-11-26
23:11:30.752 | INFO    | Flow run 'authentic-manatee' - Created task run 'curate_and_validate_prices-0' for task 'curate_and_validate_prices'
23:11:30.752 | INFO    | Flow run 'authentic-manatee' - Executing 'curate_and_validate_prices-0' immediately...
2025-12-22 23:11:30 | INFO     | flows.curate_data:curate_and_validate_prices:24 - Starting price curation for 2024-11-26
2025-12-22 23:11:30 | INFO     | curation.curate_prices:curate_daily_prices:52 - Reading 25 ticker files from /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq/2024/11/26
2025-12-22 23:11:30 | INFO     | curation.curate_prices:curate_daily_prices:70 - Combined 25 rows from 25 tickers
2025-12-22 23:11:30 | INFO     | curation.curate_prices:curate_daily_prices:131 - Saved curated prices for 1 date(s) including 2024-11-26 (25 rows for run_date, 25 tickers)
2025-12-22 23:11:30 | INFO     | curation.validate_prices:validate_daily_prices:127 - Validation passed for 25 rows
2025-12-22 23:11:30 | INFO     | db.duckdb_client:__init__:24 - Connected to DuckDB: /Users/nimratsandhu/repos/mosaic/data/marts/duckdb/mosaic.duckdb
2025-12-22 23:11:30 | INFO     | db.duckdb_client:create_schema:33 - Schema 'curated' ready
2025-12-22 23:11:30 | INFO     | db.load_curated:load_curated_prices_to_db:67 - Upserted prices for 2024-11-26 into DuckDB table 'curated.daily_prices'
2025-12-22 23:11:30 | INFO     | db.duckdb_client:close:105 - DuckDB connection closed
2025-12-22 23:11:30 | INFO     | flows.curate_data:curate_and_validate_prices:50 - Completed price curation for 2024-11-26
23:11:30.801 | INFO    | Task run 'curate_and_validate_prices-0' - Finished in state Completed()
23:11:30.806 | INFO    | Flow run 'authentic-manatee' - Created task run 'curate_fundamentals-0' for task 'curate_fundamentals'
23:11:30.807 | INFO    | Flow run 'authentic-manatee' - Executing 'curate_fundamentals-0' immediately...
2025-12-22 23:11:30 | INFO     | flows.curate_data:curate_fundamentals:59 - Starting fundamentals curation for 2024-11-26
2025-12-22 23:11:30 | INFO     | curation.curate_fundamentals:curate_quarterly_fundamentals:59 - Reading 26 manifest files from /Users/nimratsandhu/repos/mosaic/data/raw/fundamentals_sec/2024/Q4
2025-12-22 23:11:30 | WARNING  | curation.curate_fundamentals:curate_quarterly_fundamentals:72 - No valid fundamentals data found for 2024/Q4
2025-12-22 23:11:30 | WARNING  | flows.curate_data:curate_fundamentals:65 - No fundamentals data to curate for 2024-11-26
23:11:30.830 | INFO    | Task run 'curate_fundamentals-0' - Finished in state Completed()
2025-12-22 23:11:30 | INFO     | flows.curate_data:curate_data:92 - Completed curation flow for 2024-11-26
23:11:30.837 | INFO    | Flow run 'authentic-manatee' - Finished in state Completed('All states completed.')
2025-12-22 23:11:30 | INFO     | __main__:backfill_data:110 - Curating date 2024-11-27 (82/85)
23:11:30.846 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/alembic/config.py:598: DeprecationWarning: No path_separator found in configuration; falling back to legacy splitting on spaces, commas, and colons for prepend_sys_path.  Consider adding path_separator=os to Alembic config.
  util.warn_deprecated(

23:11:30.862 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/pydantic/v2_validated_func.py:51: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  class DecoratorBaseModel(BaseModel):

23:11:30.862 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:157: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for name, field in self.model.__fields__.items()

23:11:30.862 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:160: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  non_var_fields = set(self.model.__fields__) - {self.v_args_name, self.v_kwargs_name}

23:11:30.862 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:536: PydanticDeprecatedSince20: The private method `_iter` will be removed and should no longer be used. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for k, v in model._iter()

23:11:30.863 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields_set__` attribute is deprecated, use `model_fields_set` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:30.863 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:30.871 | INFO    | prefect.engine - Created flow run 'cobalt-trogon' for flow 'curate_data'
2025-12-22 23:11:30 | INFO     | flows.curate_data:curate_data:84 - Starting curation flow for 2024-11-27
23:11:30.883 | INFO    | Flow run 'cobalt-trogon' - Created task run 'curate_and_validate_prices-0' for task 'curate_and_validate_prices'
23:11:30.883 | INFO    | Flow run 'cobalt-trogon' - Executing 'curate_and_validate_prices-0' immediately...
2025-12-22 23:11:30 | INFO     | flows.curate_data:curate_and_validate_prices:24 - Starting price curation for 2024-11-27
2025-12-22 23:11:30 | INFO     | curation.curate_prices:curate_daily_prices:52 - Reading 25 ticker files from /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq/2024/11/27
2025-12-22 23:11:30 | INFO     | curation.curate_prices:curate_daily_prices:70 - Combined 25 rows from 25 tickers
2025-12-22 23:11:30 | INFO     | curation.curate_prices:curate_daily_prices:131 - Saved curated prices for 1 date(s) including 2024-11-27 (25 rows for run_date, 25 tickers)
2025-12-22 23:11:30 | INFO     | curation.validate_prices:validate_daily_prices:127 - Validation passed for 25 rows
2025-12-22 23:11:30 | INFO     | db.duckdb_client:__init__:24 - Connected to DuckDB: /Users/nimratsandhu/repos/mosaic/data/marts/duckdb/mosaic.duckdb
2025-12-22 23:11:30 | INFO     | db.duckdb_client:create_schema:33 - Schema 'curated' ready
2025-12-22 23:11:30 | INFO     | db.load_curated:load_curated_prices_to_db:67 - Upserted prices for 2024-11-27 into DuckDB table 'curated.daily_prices'
2025-12-22 23:11:30 | INFO     | db.duckdb_client:close:105 - DuckDB connection closed
2025-12-22 23:11:30 | INFO     | flows.curate_data:curate_and_validate_prices:50 - Completed price curation for 2024-11-27
23:11:30.934 | INFO    | Task run 'curate_and_validate_prices-0' - Finished in state Completed()
23:11:30.939 | INFO    | Flow run 'cobalt-trogon' - Created task run 'curate_fundamentals-0' for task 'curate_fundamentals'
23:11:30.939 | INFO    | Flow run 'cobalt-trogon' - Executing 'curate_fundamentals-0' immediately...
2025-12-22 23:11:30 | INFO     | flows.curate_data:curate_fundamentals:59 - Starting fundamentals curation for 2024-11-27
2025-12-22 23:11:30 | INFO     | curation.curate_fundamentals:curate_quarterly_fundamentals:59 - Reading 26 manifest files from /Users/nimratsandhu/repos/mosaic/data/raw/fundamentals_sec/2024/Q4
2025-12-22 23:11:30 | WARNING  | curation.curate_fundamentals:curate_quarterly_fundamentals:72 - No valid fundamentals data found for 2024/Q4
2025-12-22 23:11:30 | WARNING  | flows.curate_data:curate_fundamentals:65 - No fundamentals data to curate for 2024-11-27
23:11:30.961 | INFO    | Task run 'curate_fundamentals-0' - Finished in state Completed()
2025-12-22 23:11:30 | INFO     | flows.curate_data:curate_data:92 - Completed curation flow for 2024-11-27
23:11:30.967 | INFO    | Flow run 'cobalt-trogon' - Finished in state Completed('All states completed.')
2025-12-22 23:11:30 | INFO     | __main__:backfill_data:110 - Curating date 2024-11-29 (83/85)
23:11:30.978 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/alembic/config.py:598: DeprecationWarning: No path_separator found in configuration; falling back to legacy splitting on spaces, commas, and colons for prepend_sys_path.  Consider adding path_separator=os to Alembic config.
  util.warn_deprecated(

23:11:30.994 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/pydantic/v2_validated_func.py:51: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  class DecoratorBaseModel(BaseModel):

23:11:30.995 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:157: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for name, field in self.model.__fields__.items()

23:11:30.995 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:160: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  non_var_fields = set(self.model.__fields__) - {self.v_args_name, self.v_kwargs_name}

23:11:30.995 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:536: PydanticDeprecatedSince20: The private method `_iter` will be removed and should no longer be used. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for k, v in model._iter()

23:11:30.995 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields_set__` attribute is deprecated, use `model_fields_set` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:30.995 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:31.004 | INFO    | prefect.engine - Created flow run 'gifted-swan' for flow 'curate_data'
2025-12-22 23:11:31 | INFO     | flows.curate_data:curate_data:84 - Starting curation flow for 2024-11-29
23:11:31.017 | INFO    | Flow run 'gifted-swan' - Created task run 'curate_and_validate_prices-0' for task 'curate_and_validate_prices'
23:11:31.017 | INFO    | Flow run 'gifted-swan' - Executing 'curate_and_validate_prices-0' immediately...
2025-12-22 23:11:31 | INFO     | flows.curate_data:curate_and_validate_prices:24 - Starting price curation for 2024-11-29
2025-12-22 23:11:31 | INFO     | curation.curate_prices:curate_daily_prices:52 - Reading 25 ticker files from /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq/2024/11/29
2025-12-22 23:11:31 | INFO     | curation.curate_prices:curate_daily_prices:70 - Combined 25 rows from 25 tickers
2025-12-22 23:11:31 | INFO     | curation.curate_prices:curate_daily_prices:131 - Saved curated prices for 1 date(s) including 2024-11-29 (25 rows for run_date, 25 tickers)
2025-12-22 23:11:31 | INFO     | curation.validate_prices:validate_daily_prices:127 - Validation passed for 25 rows
2025-12-22 23:11:31 | INFO     | db.duckdb_client:__init__:24 - Connected to DuckDB: /Users/nimratsandhu/repos/mosaic/data/marts/duckdb/mosaic.duckdb
2025-12-22 23:11:31 | INFO     | db.duckdb_client:create_schema:33 - Schema 'curated' ready
2025-12-22 23:11:31 | INFO     | db.load_curated:load_curated_prices_to_db:67 - Upserted prices for 2024-11-29 into DuckDB table 'curated.daily_prices'
2025-12-22 23:11:31 | INFO     | db.duckdb_client:close:105 - DuckDB connection closed
2025-12-22 23:11:31 | INFO     | flows.curate_data:curate_and_validate_prices:50 - Completed price curation for 2024-11-29
23:11:31.066 | INFO    | Task run 'curate_and_validate_prices-0' - Finished in state Completed()
23:11:31.071 | INFO    | Flow run 'gifted-swan' - Created task run 'curate_fundamentals-0' for task 'curate_fundamentals'
23:11:31.071 | INFO    | Flow run 'gifted-swan' - Executing 'curate_fundamentals-0' immediately...
2025-12-22 23:11:31 | INFO     | flows.curate_data:curate_fundamentals:59 - Starting fundamentals curation for 2024-11-29
2025-12-22 23:11:31 | INFO     | curation.curate_fundamentals:curate_quarterly_fundamentals:59 - Reading 26 manifest files from /Users/nimratsandhu/repos/mosaic/data/raw/fundamentals_sec/2024/Q4
2025-12-22 23:11:31 | WARNING  | curation.curate_fundamentals:curate_quarterly_fundamentals:72 - No valid fundamentals data found for 2024/Q4
2025-12-22 23:11:31 | WARNING  | flows.curate_data:curate_fundamentals:65 - No fundamentals data to curate for 2024-11-29
23:11:31.093 | INFO    | Task run 'curate_fundamentals-0' - Finished in state Completed()
2025-12-22 23:11:31 | INFO     | flows.curate_data:curate_data:92 - Completed curation flow for 2024-11-29
23:11:31.099 | INFO    | Flow run 'gifted-swan' - Finished in state Completed('All states completed.')
2025-12-22 23:11:31 | INFO     | __main__:backfill_data:110 - Curating date 2024-12-01 (84/85)
23:11:31.108 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/alembic/config.py:598: DeprecationWarning: No path_separator found in configuration; falling back to legacy splitting on spaces, commas, and colons for prepend_sys_path.  Consider adding path_separator=os to Alembic config.
  util.warn_deprecated(

23:11:31.124 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/pydantic/v2_validated_func.py:51: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  class DecoratorBaseModel(BaseModel):

23:11:31.124 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:157: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for name, field in self.model.__fields__.items()

23:11:31.125 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:160: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  non_var_fields = set(self.model.__fields__) - {self.v_args_name, self.v_kwargs_name}

23:11:31.125 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:536: PydanticDeprecatedSince20: The private method `_iter` will be removed and should no longer be used. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for k, v in model._iter()

23:11:31.125 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields_set__` attribute is deprecated, use `model_fields_set` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:31.125 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:31.133 | INFO    | prefect.engine - Created flow run 'yellow-wasp' for flow 'curate_data'
2025-12-22 23:11:31 | INFO     | flows.curate_data:curate_data:84 - Starting curation flow for 2024-12-01
23:11:31.146 | INFO    | Flow run 'yellow-wasp' - Created task run 'curate_and_validate_prices-0' for task 'curate_and_validate_prices'
23:11:31.146 | INFO    | Flow run 'yellow-wasp' - Executing 'curate_and_validate_prices-0' immediately...
2025-12-22 23:11:31 | INFO     | flows.curate_data:curate_and_validate_prices:24 - Starting price curation for 2024-12-01
2025-12-22 23:11:31 | INFO     | curation.curate_prices:curate_daily_prices:52 - Reading 25 ticker files from /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq/2024/12/01
2025-12-22 23:11:31 | INFO     | curation.curate_prices:curate_daily_prices:70 - Combined 25 rows from 25 tickers
2025-12-22 23:11:31 | WARNING  | curation.curate_prices:curate_daily_prices:96 - No exact match for 2024-12-01, using latest available date 2024-11-29 (25 rows)
2025-12-22 23:11:31 | INFO     | curation.curate_prices:curate_daily_prices:131 - Saved curated prices for 1 date(s) including 2024-12-01 (25 rows for run_date, 25 tickers)
2025-12-22 23:11:31 | INFO     | curation.validate_prices:validate_daily_prices:127 - Validation passed for 25 rows
2025-12-22 23:11:31 | INFO     | db.duckdb_client:__init__:24 - Connected to DuckDB: /Users/nimratsandhu/repos/mosaic/data/marts/duckdb/mosaic.duckdb
2025-12-22 23:11:31 | INFO     | db.duckdb_client:create_schema:33 - Schema 'curated' ready
2025-12-22 23:11:31 | INFO     | db.load_curated:load_curated_prices_to_db:67 - Upserted prices for 2024-12-01 into DuckDB table 'curated.daily_prices'
2025-12-22 23:11:31 | INFO     | db.duckdb_client:close:105 - DuckDB connection closed
2025-12-22 23:11:31 | INFO     | flows.curate_data:curate_and_validate_prices:50 - Completed price curation for 2024-12-01
23:11:31.198 | INFO    | Task run 'curate_and_validate_prices-0' - Finished in state Completed()
23:11:31.203 | INFO    | Flow run 'yellow-wasp' - Created task run 'curate_fundamentals-0' for task 'curate_fundamentals'
23:11:31.203 | INFO    | Flow run 'yellow-wasp' - Executing 'curate_fundamentals-0' immediately...
2025-12-22 23:11:31 | INFO     | flows.curate_data:curate_fundamentals:59 - Starting fundamentals curation for 2024-12-01
2025-12-22 23:11:31 | INFO     | curation.curate_fundamentals:curate_quarterly_fundamentals:59 - Reading 26 manifest files from /Users/nimratsandhu/repos/mosaic/data/raw/fundamentals_sec/2024/Q4
2025-12-22 23:11:31 | WARNING  | curation.curate_fundamentals:curate_quarterly_fundamentals:72 - No valid fundamentals data found for 2024/Q4
2025-12-22 23:11:31 | WARNING  | flows.curate_data:curate_fundamentals:65 - No fundamentals data to curate for 2024-12-01
23:11:31.226 | INFO    | Task run 'curate_fundamentals-0' - Finished in state Completed()
2025-12-22 23:11:31 | INFO     | flows.curate_data:curate_data:92 - Completed curation flow for 2024-12-01
23:11:31.232 | INFO    | Flow run 'yellow-wasp' - Finished in state Completed('All states completed.')
2025-12-22 23:11:31 | INFO     | __main__:backfill_data:110 - Curating date 2025-12-22 (85/85)
23:11:31.243 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/alembic/config.py:598: DeprecationWarning: No path_separator found in configuration; falling back to legacy splitting on spaces, commas, and colons for prepend_sys_path.  Consider adding path_separator=os to Alembic config.
  util.warn_deprecated(

23:11:31.258 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/pydantic/v2_validated_func.py:51: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  class DecoratorBaseModel(BaseModel):

23:11:31.259 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:157: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for name, field in self.model.__fields__.items()

23:11:31.259 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:160: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  non_var_fields = set(self.model.__fields__) - {self.v_args_name, self.v_kwargs_name}

23:11:31.259 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:536: PydanticDeprecatedSince20: The private method `_iter` will be removed and should no longer be used. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for k, v in model._iter()

23:11:31.259 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields_set__` attribute is deprecated, use `model_fields_set` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:31.259 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:31.268 | INFO    | prefect.engine - Created flow run 'amaranth-griffin' for flow 'curate_data'
2025-12-22 23:11:31 | INFO     | flows.curate_data:curate_data:84 - Starting curation flow for 2025-12-22
23:11:31.281 | INFO    | Flow run 'amaranth-griffin' - Created task run 'curate_and_validate_prices-0' for task 'curate_and_validate_prices'
23:11:31.281 | INFO    | Flow run 'amaranth-griffin' - Executing 'curate_and_validate_prices-0' immediately...
2025-12-22 23:11:31 | INFO     | flows.curate_data:curate_and_validate_prices:24 - Starting price curation for 2025-12-22
2025-12-22 23:11:31 | INFO     | curation.curate_prices:curate_daily_prices:52 - Reading 25 ticker files from /Users/nimratsandhu/repos/mosaic/data/raw/prices_stooq/2025/12/22
2025-12-22 23:11:31 | INFO     | curation.curate_prices:curate_daily_prices:70 - Combined 25 rows from 25 tickers
2025-12-22 23:11:31 | WARNING  | curation.curate_prices:curate_daily_prices:96 - No exact match for 2025-12-22, using latest available date 2025-12-19 (25 rows)
2025-12-22 23:11:31 | INFO     | curation.curate_prices:curate_daily_prices:131 - Saved curated prices for 1 date(s) including 2025-12-22 (25 rows for run_date, 25 tickers)
2025-12-22 23:11:31 | INFO     | curation.validate_prices:validate_daily_prices:127 - Validation passed for 25 rows
2025-12-22 23:11:31 | WARNING  | db.load_curated:load_curated_prices_to_db:39 - Curated prices file not found: /Users/nimratsandhu/repos/mosaic/data/curated/daily_prices/2025/12/22/2025-12-22.parquet
2025-12-22 23:11:31 | INFO     | flows.curate_data:curate_and_validate_prices:50 - Completed price curation for 2025-12-22
23:11:31.314 | INFO    | Task run 'curate_and_validate_prices-0' - Finished in state Completed()
23:11:31.319 | INFO    | Flow run 'amaranth-griffin' - Created task run 'curate_fundamentals-0' for task 'curate_fundamentals'
23:11:31.319 | INFO    | Flow run 'amaranth-griffin' - Executing 'curate_fundamentals-0' immediately...
2025-12-22 23:11:31 | INFO     | flows.curate_data:curate_fundamentals:59 - Starting fundamentals curation for 2025-12-22
2025-12-22 23:11:31 | WARNING  | curation.curate_fundamentals:curate_quarterly_fundamentals:50 - No raw fundamentals data found for 2025/Q4
2025-12-22 23:11:31 | WARNING  | flows.curate_data:curate_fundamentals:65 - No fundamentals data to curate for 2025-12-22
23:11:31.333 | INFO    | Task run 'curate_fundamentals-0' - Finished in state Completed()
2025-12-22 23:11:31 | INFO     | flows.curate_data:curate_data:92 - Completed curation flow for 2025-12-22
23:11:31.339 | INFO    | Flow run 'amaranth-griffin' - Finished in state Completed('All states completed.')
2025-12-22 23:11:31 | INFO     | __main__:backfill_data:117 - Completed curation for 85 dates
2025-12-22 23:11:31 | INFO     | __main__:backfill_data:121 - ============================================================
2025-12-22 23:11:31 | INFO     | __main__:backfill_data:122 - Step 4: Running feature building
2025-12-22 23:11:31 | INFO     | __main__:backfill_data:123 - ============================================================
23:11:31.348 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/pydantic/v2_validated_func.py:51: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  class DecoratorBaseModel(BaseModel):

2025-12-22 23:11:31 | INFO     | __main__:backfill_data:131 - Building features for 2025-12-22 (has 85 days of history)
23:11:31.352 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/alembic/config.py:598: DeprecationWarning: No path_separator found in configuration; falling back to legacy splitting on spaces, commas, and colons for prepend_sys_path.  Consider adding path_separator=os to Alembic config.
  util.warn_deprecated(

23:11:31.367 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/_internal/pydantic/v2_validated_func.py:51: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  class DecoratorBaseModel(BaseModel):

23:11:31.368 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:157: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for name, field in self.model.__fields__.items()

23:11:31.368 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/pydantic/v1/decorator.py:160: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  non_var_fields = set(self.model.__fields__) - {self.v_args_name, self.v_kwargs_name}

23:11:31.368 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:536: PydanticDeprecatedSince20: The private method `_iter` will be removed and should no longer be used. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  for k, v in model._iter()

23:11:31.368 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields_set__` attribute is deprecated, use `model_fields_set` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:31.369 | WARNING | py.warnings - /Users/nimratsandhu/repos/mosaic/venv/lib/python3.11/site-packages/prefect/flows.py:537: PydanticDeprecatedSince20: The `__fields__` attribute is deprecated, use the `model_fields` class property instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
  if k in model.__fields_set__ or model.__fields__[k].default_factory

23:11:31.377 | INFO    | prefect.engine - Created flow run 'serious-hippo' for flow 'build_features'
2025-12-22 23:11:31 | INFO     | flows.build_features:build_features:122 - Starting feature engine flow for 2025-12-22
23:11:31.390 | INFO    | Flow run 'serious-hippo' - Created task run 'calculate_features-0' for task 'calculate_features'
23:11:31.390 | INFO    | Flow run 'serious-hippo' - Executing 'calculate_features-0' immediately...
2025-12-22 23:11:31 | INFO     | flows.build_features:calculate_features:25 - Calculating features for 2025-12-22
2025-12-22 23:11:31 | INFO     | db.duckdb_client:__init__:24 - Connected to DuckDB: /Users/nimratsandhu/repos/mosaic/data/marts/duckdb/mosaic.duckdb
2025-12-22 23:11:31 | INFO     | db.duckdb_client:close:105 - DuckDB connection closed
2025-12-22 23:11:31 | WARNING  | features.price_features:calculate_price_features:111 - No price data found for date range ending 2025-12-22
2025-12-22 23:11:31 | INFO     | features.fundamental_features:calculate_yoy_revenue_growth_proxy:34 - Fundamental features not yet implemented - would calculate YoY revenue growth by parsing SEC filings for 2025-12-22
23:11:31.410 | INFO    | Task run 'calculate_features-0' - Finished in state Completed()
23:11:31.415 | INFO    | Flow run 'serious-hippo' - Created task run 'score_and_save_signals-0' for task 'score_and_save_signals'
23:11:31.416 | INFO    | Flow run 'serious-hippo' - Executing 'score_and_save_signals-0' immediately...
2025-12-22 23:11:31 | INFO     | flows.build_features:score_and_save_signals:45 - Scoring signals for 2025-12-22
2025-12-22 23:11:31 | WARNING  | features.signal_scorer:score_signals:56 - Empty price features DataFrame provided
2025-12-22 23:11:31 | WARNING  | flows.build_features:score_and_save_signals:60 - No signals to save for 2025-12-22
2025-12-22 23:11:31 | WARNING  | features.signal_scorer:save_signal_scores:168 - Saving empty signal scores file for 2025-12-22
2025-12-22 23:11:31 | INFO     | features.signal_scorer:save_signal_scores:171 - Saved signal scores to /Users/nimratsandhu/repos/mosaic/data/marts/signal_scores/2025-12-22.parquet (0 rows)
2025-12-22 23:11:31 | INFO     | db.duckdb_client:__init__:24 - Connected to DuckDB: /Users/nimratsandhu/repos/mosaic/data/marts/duckdb/mosaic.duckdb
2025-12-22 23:11:31 | INFO     | db.duckdb_client:create_schema:33 - Schema 'marts' ready
2025-12-22 23:11:31 | INFO     | db.duckdb_client:create_schema:33 - Schema 'marts' ready
2025-12-22 23:11:31 | INFO     | db.duckdb_client:load_parquet_to_table:84 - Loaded 0 rows into marts.signal_scores from /Users/nimratsandhu/repos/mosaic/data/marts/signal_scores/2025-12-22.parquet
2025-12-22 23:11:31 | INFO     | db.load_marts:load_signal_scores_to_db:57 - Loaded signal scores for 2025-12-22 into DuckDB table 'marts.signal_scores'
2025-12-22 23:11:31 | INFO     | db.duckdb_client:close:105 - DuckDB connection closed
2025-12-22 23:11:31 | INFO     | flows.build_features:score_and_save_signals:71 - Completed signal scoring for 2025-12-22
23:11:31.445 | INFO    | Task run 'score_and_save_signals-0' - Finished in state Completed()
23:11:31.449 | INFO    | Flow run 'serious-hippo' - Created task run 'generate_and_save_positions-0' for task 'generate_and_save_positions'
23:11:31.450 | INFO    | Flow run 'serious-hippo' - Executing 'generate_and_save_positions-0' immediately...
2025-12-22 23:11:31 | INFO     | flows.build_features:generate_and_save_positions:83 - Generating positions for 2025-12-22
2025-12-22 23:11:31 | WARNING  | features.position_generator:generate_positions:39 - No valid signals found for 2025-12-22 (empty or missing columns)
2025-12-22 23:11:31 | WARNING  | features.position_generator:save_positions:105 - Saving empty positions file for 2025-12-22
2025-12-22 23:11:31 | INFO     | features.position_generator:save_positions:108 - Saved positions to /Users/nimratsandhu/repos/mosaic/data/marts/positions/2025-12-22.parquet (0 rows)
2025-12-22 23:11:31 | INFO     | db.duckdb_client:__init__:24 - Connected to DuckDB: /Users/nimratsandhu/repos/mosaic/data/marts/duckdb/mosaic.duckdb
2025-12-22 23:11:31 | INFO     | db.duckdb_client:create_schema:33 - Schema 'marts' ready
2025-12-22 23:11:31 | INFO     | db.duckdb_client:create_schema:33 - Schema 'marts' ready
2025-12-22 23:11:31 | INFO     | db.duckdb_client:load_parquet_to_table:84 - Loaded 0 rows into marts.positions from /Users/nimratsandhu/repos/mosaic/data/marts/positions/2025-12-22.parquet
2025-12-22 23:11:31 | INFO     | db.load_marts:load_positions_to_db:106 - Loaded positions for 2025-12-22 into DuckDB table 'marts.positions'
2025-12-22 23:11:31 | INFO     | db.duckdb_client:close:105 - DuckDB connection closed
2025-12-22 23:11:31 | WARNING  | flows.build_features:generate_and_save_positions:107 - No positions generated for 2025-12-22
23:11:31.478 | INFO    | Task run 'generate_and_save_positions-0' - Finished in state Completed()
2025-12-22 23:11:31 | INFO     | flows.build_features:build_features:135 - Completed feature engine flow for 2025-12-22
23:11:31.484 | INFO    | Flow run 'serious-hippo' - Finished in state Completed('All states completed.')
2025-12-22 23:11:31 | INFO     | __main__:backfill_data:139 - ============================================================
2025-12-22 23:11:31 | INFO     | __main__:backfill_data:140 - Backfill completed!
2025-12-22 23:11:31 | INFO     | __main__:backfill_data:141 - ============================================================
